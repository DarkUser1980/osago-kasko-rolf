!function(e){e.module("KaskoApp",["ui.router","ui.mask","ngSanitize","ngDialog","angularFileUpload","kaskoTemplates","calculatorC","formationPolicyC","brandingC","AddingDocumentsC","calculatorStepsC","brandingConfigs","utils","dictionary","policyOrdering","priceFormatter","inputOnly","ngThumb","jDatePicker","calculator","person","dropdown","UIElements","appMessage","priceSlider","dadata","mainContent","baseModule","carFilter","preCalculator","postCalculator","calculatorSteps","calculatorC","formationPolicyC","brandingC","AddingDocumentsC","calculatorStepsC"]),e.module("KaskoApp").value("moduleType","kasko"),e.module("baseModule",[]),e.module("calculator",[])}(angular),function(e){e.module("OsagoApp",["ui.router","ui.mask","ngSanitize","ngDialog","angularFileUpload","kaskoTemplates","brandingConfigs","utils","dictionary","policyOrdering","priceFormatter","inputOnly","ngThumb","jDatePicker","calculator","person","dropdown","UIElements","appMessage","priceSlider","dadata","mainContent","baseModule","carFilter","preCalculator","postCalculator","calculatorSteps","calculatorO","formationPolicy","AddingDocuments","branding","personalData","calculatorStepsO"]),e.module("OsagoApp").value("moduleType","osago"),e.module("baseModule",[]),e.module("calculator",[])}(angular),function(e){"use strict";e.module("baseModule").controller("baseController",["CONSTS","$rootScope","brandingService",function(e,t,i){t.currentBrandName=e.currentBrand,t.currentBrand=i[t.currentBrandName]}])}(angular),function(e){"use strict";e.module("baseModule").config(["DictionaryProvider","CONSTS","jdatepickerProvider","calculatorProvider","$compileProvider","$locationProvider",function(e,t,i,a,r,n){e.setConstants(t),window.location.port&&80!==window.location.port||r.debugInfoEnabled(!1),n.hashPrefix("!"),i.setDefaults({dateFormat:"dd.mm.yy",pDateFormat:"yy-mm-dd",mDateFormat:"yy-mm-dd",replacedSymbols:{"/":".",",":"."},inputRule:function(e){var t,i,a=/([\d]{0,2})(\.?)([\d]{0,2})(\.?)([\d]{0,4})/;return i=a.exec(e),t=e,i&&(t="",i[1]&&(t=i[1],(2==i[1].length||i[3])&&(t+=".")),i[3]&&(t+=i[3],(2==i[3].length||i[5])&&(t+=".")),t+=i[5]),t}})}])}(angular),function(e){"use strict";e.module("baseModule").constant("CONSTS",function(){var t={host:"",hostApi:"",prefixPath:"",proxyPath:"",proxyPathC:"",currentBrand:""};return AngularAppConfig&&(AngularAppConfig.host&&(t.host=AngularAppConfig.host),AngularAppConfig.hostApi&&(t.hostApi=AngularAppConfig.hostApi),AngularAppConfig.prefixPath&&(t.prefixPath=AngularAppConfig.prefixPath),AngularAppConfig.proxyPath&&(t.proxyPath=AngularAppConfig.proxyPath),t.proxyPathC=AngularAppConfig.proxyPathC||t.proxyPath,AngularAppConfig.currentBrand?t.currentBrand=AngularAppConfig.currentBrand:t.currentBrand="other"),e.extend(t,{pathToSource:t.prefixPath+"js/",pathToModules:t.prefixPath+"js/modules.",urlPrefix:t.host+"/rest/v1/",urlPrefixDefault:t.host+"/rest/default/",urlPrefixV3:t.host+"/rest/v3/default/",urlPrefixV4:t.host+"/rest/v4/",urlPrefixV3Client:t.host+"/rest/v1/client/",urlPrefixCalc:t.host+"/rest/full/",urlPrefixPolicy:t.host+"/policy/rest/",urlPrefixApi:t.hostApi+"/api/"}),t}())}(angular);var jQueryApp=jQuery.noConflict();!function(e){"use strict";e.module("baseModule").service("resources",["CONSTS",function(e){this.deal=e.urlPrefix+"deal/deal",this.person=e.urlPrefix+"client/person",this.customer=e.urlPrefix+"client/customer",this.obtainToken=e.urlPrefix+"accounts/obtain-token",this.legalPerson=e.urlPrefix+"client/legal-person",this.customerCar=e.urlPrefix+"client/car",this.currentUser=e.urlPrefix+"accounts/user/current",this.calculation=e.urlPrefixCalc+"calculation/",this.resultPolicy=e.urlPrefixPolicy+"result_policy/",this.naturalPerson=e.urlPrefix+"client/natural-person",this.insuredObject=e.urlPrefixDefault+"client/insured-object-create",this.insuredObjectOsago=e.urlPrefixDefault+"client/insured-object-osago-create",this.calculationV3=e.urlPrefixV3+"calculation/",this.userActivation=e.urlPrefix+"registration/activation",this.calculationList=e.urlPrefixV3+"calculation/list/",this.insuredObectList=e.urlPrefix+"client/insured-object",this.insuredObjectCRM=e.urlPrefix+"client/insured-object",this.notificationSend=e.urlPrefix+"notification/send",this.userRegistration=e.urlPrefix+"registration/registration",this.insuranceProduct=e.urlPrefix+"deal/insurance-product",this.savedCars=e.urlPrefix+"client/car",this.savedNaturalPersons=e.urlPrefix+"client/natural-person",this.savedLegalPersons=e.urlPrefix+"client/legal-person"}])}(angular),function(e){"use strict";e.module("baseModule").config(["$stateProvider","$parseProvider","$urlRouterProvider","CONSTS",function(e,t,i,a){var r=a.pathToModules,n="/kasko/",s="";778==window.location.port&&(s="",n+="{calculationId:[0-9]*}"),i.otherwise(function(){return n?s+n:"/"}),e.state("index",{url:"?interface&sms",abstract:!0,views:{"":{controller:"baseController",templateUrl:r+"shared/mainContent/views/main_content.html"}},resolve:{calcType:["$rootScope","moduleType",function(e,t){e.calcType=t}]}}).state("index.calculator",{url:s,abstract:!0,reloadOnSearch:!0,controller:"calculatorCtrl",templateUrl:r+"shared/calculator/views/calculator.html"}).state("index.preCalculator",{url:"/pre",controller:"preCalculatorCtrl",templateUrl:r+"shared/preCalculator/views/pre_calculator.rolf.html"}).state("index.postCalculator",{url:"/get-best-offer",controller:"postCalculatorCtrl",templateUrl:r+"shared/postCalculator/views/post_calculator.rolf.html"}).state("index.calculator.kasko",{url:n,views:{"":{controller:"calculatorCascoCtrl",templateUrl:r+"kasko/calculatorC/views/calculation.form.html"},"step_2@index.calculator.kasko":{templateUrl:r+"kasko/calculatorC/views/kasko/calculation.step_2.html"},"step_3@index.calculator.kasko":{templateUrl:r+"kasko/calculatorC/views/kasko/calculation.step_3.html"},"step_6@index.calculator.kasko":{templateUrl:r+"kasko/calculatorC/views/kasko/calculation.step_6.html"}}}).state("index.calculator.osago",{url:"/osago/",views:{"":{controller:"calculatorOsagoCtrl",templateUrl:r+"osago/calculatorO/views/calculation.form.html"},"step_2@index.calculator.osago":{templateUrl:r+"osago/calculatorO/views/osago/calculation.step_2.html"},"step_3@index.calculator.osago":{templateUrl:r+"osago/calculatorO/views/osago/calculation.step_3.html"},"step_4@index.calculator.osago":{templateUrl:r+"osago/calculatorO/views/osago/calculation.step_4.html"},"step_5@index.calculator.osago":{templateUrl:r+"osago/calculatorO/views/osago/calculation.step_5.html"},"step_6@index.calculator.osago":{templateUrl:r+"osago/calculatorO/views/osago/calculation.step_6.html"}}})}])}(angular),function(e,t){"use strict";e.module("baseModule").run(["$rootScope","$state","$injector","$http","CONSTS","$location","ngDialog",function(t,i,a,r,n,s,l){var o,c=s.path;_.mixin({isPromise:function(e){return e&&_.isFunction(e.then)},getYearByDate:function(e){var t=new Date,i=new Date(e);if(i.getTime())return new Date(t-i).getFullYear()-1970}}),t.$on("$stateChangeStart",function(e,i,a,r,n){t.lastState=i,t.lastState.toParams=a}),t.$on("$stateChangeSuccess",function(e,i,a,r){t.$previousState=r,t.$activeState=i,o&&(l.close(o),o=null)}),t.$on("ngDialog.opened",function(e,t){o=t.attr("id")}),t.cancellerRequests=[],t.cancelAllRequests=function(){e.forEach(t.cancellerRequests,function(e){e.resolve()}),t.cancellerRequests.length=0},s.path=function(e,a){if(a===!1)var r=i.current,n=t.$on("$stateChangeSuccess",function(){i.current=r,n()});return c.apply(s,[e])},t.prefixPath=n.prefixPath}])}(angular,jQueryApp),function(e){e.module("kaskoTemplates",[])}(angular),function(e){e.module("calculatorC",[])}(angular),function(e,t){"use strict";e.module("calculatorC").controller("calculatorCascoCtrl",["$scope","$q","calculatorService","CONSTS","$stateParams","Dictionary","$filter","formationPolicyService","formationPolicyStep1Service","$rootScope","ngDialog","Person","calculatorStepsService","brandingConfigs",function(t,i,a,r,n,s,l,o,c,d,u,p,m,g){function v(i){P=i.insurance_type,$=e.copy(i),t.params.drivers_count=i.driver_set.length,t.params.drivers_count_full=i.driver_set.length,i.insured_object?k(i.insured_object):f()}function f(){h()}function h(i){var a=e.copy(T);a.driver_license=c.getDefaultObject("defaultDriverLicenseObject");var r=new p(e.extend({},a,i));t.drivers.push(r)}function b(i){var a=new p(e.extend({},j,i));t.persons.push(a)}function y(e){_.forEach(e,function(e){var t=new Date(e.birth_date),i=new Date(e.driving_experience_started);t.setDate(t.getDate()+2),i.setDate(i.getDate()+2);var a=_.getYearByDate(t),r=_.getYearByDate(i);a=a>=18&&a<23?19:a>=23&&a<29?24:a>=29&&a<35?30:a>=35&&a<40?36:a>=40&&a<65?41:66,r=r>=0&&r<2?1:r>=2&&r<5?3:r>=5&&r<10?6:11,e.age=a,e.expirience=r})}function w(){return(t.calculation.engine_power>9&&t.calculation.engine_power<=999||!t.calculation.engine_power)&&t.calculation.car_mark&&t.calculation.car_model&&t.calculation.car_manufacturing_year}function x(t,i){return e.isObject(t)?e.equals(t,i):null===t||null===i?Boolean(t)==Boolean(i):t==i}function k(t){return o.getInsuredObject(t).then(function(t){return I=e.copy(t),C(t)})}function C(i){var a=e.copy(i.person);return t.persons.length=0,t.drivers.length=0,i.object.vin_number?(t.osagoParams.vin_number=i.object.vin_number,t.osagoParams.vin_is_visible=!0):t.osagoParams.vin_is_visible=!1,e.forEach(a,function(i){var a=i.natural_person?"natural_person":"legal_person";i[a].selectedPerson=i[a].external_id,"natural_person"===a?(i[a].age=l("calcAge")(i[a].birth_date),i[a].expirience=l("calcAge")(i[a].driving_experience_started)):(t.osagoParams.legal_person.inn=i[a].inn,t.osagoParams.legal_person.title=i[a].title,t.osagoParams.legal_person.insurant_is_legal_person=!0),i[a].personType=a,c.setPersonCredential(i[a]),c.setPersonAddress(i[a]),i.role.length&&_.forEach(i.role,function(e){i[a]["is"+e.slice(0,1).toUpperCase()+e.slice(1,e.length)]=!0}),"natural_person"===a&&b(e.copy(i[a]))}),e.forEach(i.drivers,function(e){e.personType="natural_person",e.isDriver=!0,c.setPersonCredential(e),h(e)}),t.persons.length||t.drivers.length||b(),t.drivers.length&&(i.person.length&&(t.drivers[0].person=i.person[0].id),t.persons.length=0),t.cachedDrivers=e.copy(t.drivers),S={drivers:e.copy(t.drivers),persons:e.copy(t.persons)},i}var P,S,I,D=a.getPromises(),$={},T={credential:[],address:[],contact:[],first_name:"",last_name:"",patronymic:"",isDriver:!0,personType:"natural_person",birth_date:"",gender:"M",driving_experience_started:"",driver_license:c.getDefaultObject("defaultDriverLicenseObject")},j={is_same_address:!0,credential:[],isOwner:!0,personType:"natural_person",isDriver:!1,isInsurant:!1,first_name:"",last_name:"",patronymic:"",gender:"M",birth_date:"",passport:c.getDefaultObject("defaultPassportObject"),address_registration:{address_type:1,postal_index:"Нет",country:"Россия",city:"Не указан",street:"Не указана",house:"Не указан",housing:"Не указан",flat:"Не указан",kladr:""}},M=[];t.dicts={},t.dynamicDicts={},t.persons=[],t.drivers=[],t.params.field_was_clicked=!1,t.osagoParams={vin_number:"",vin_is_visible:!0,legal_person:{isOwner:!0,isInsurant:!1,inn:"",title:"",address_registration:{address_type:1,postal_index:"Нет",country:"Россия",city:"Не указан",street:"Не указана",house:"Не указан",housing:"Не указан",flat:"Не указан",kladr:""},is_same_address:!0,personType:"legal_person"}},t.getCurrentCalcType=function(){return m.getCurrentCalcType()},a.calculationFormIsValid=function(){return!0},t.templates.program_list=g.templates.program_list||r.pathToModules+"kasko/calculatorC/views/calculation.program_list.html",t.templates.navigation=g.templates.navigation||r.pathToModules+"shared/calculator/views/navigation.html",t.validation={},t.isVisible=function(e,i,a){var r;+t.calculation.car_type;return a=a||t.calculation,r||(a[e]=i||null),r},t.isDisabled=function(e,i,a){var r;+t.calculation.car_type;return a=a||t.calculation,r&&(a[e]=i||null),r},_.isPromise(D.getCalculation)?D.getCalculation.then(v,f):t.calculation.id?a.getCalculation(t.calculation.id).then(v,f):f(),t.calculateKasko=function(){if(!t.params.recalculateButtonIsDisabled)return t.params.recalculateButtonIsDisabled=!0,t.params.isCalculationProgress=!0,t.root.messages.length=0,t.calculation.is_calculate_osago=!1,delete t.calculation.insurance_type,delete t.calculation.insured_object,"tumen"===d.currentBrandName&&y(t.calculation.driver_set),t.postCalculateParams.second&&(t.calculation.contributory_scheme=t.params.contributory_scheme||19,t.calculation.payment_form=t.params.payment_form?[t.params.payment_form]:null),t.calculation.deductible_value=t.params.deductible_value,t.calculation.is_deductible=!!parseInt(t.calculation.deductible_value,10),t.calculate(function(i){t.cachedDrivers=e.copy(t.drivers),t.disabledFormationPolicyButtonIsActive=!0,$=e.copy(i)})},t.disabledSubmitButton=function(){return t.root.isSubmitButtonDisabled=!w()||!!t.params.isCalculationProgress,t.root.isSubmitButtonDisabled},t.addressIsValid=function(e){return e.city&&e.house&&e.street},t.getYearRange=function(e,t){var i,a,r=new Date;return e=e||0,t=void 0===t?90:t,a=r.getFullYear()-t,i=r.getFullYear()-e,a+":"+i},t.params.brandedDeductibleValues=i.when(_.map(d.currentBrand.deductible_values,function(e){return{id:e,title:e}})),function(){var i=["insuranceDuration","ownerRegistration"];e.forEach(i,function(i){t.dicts[i]=s.getItems(i).then(function(t){return t=t.results?t.results:t,M[i]=e.copy(t),t})}),t.dicts.trueFalse=[{title:"Да",id:!0},{title:"Нет",id:!1}],t.dicts.isLegalEntity=[{title:"Физическое лицо",id:!1},{title:"Юридическое лицо",id:!0}],t.dicts.insuranceDuration=t.dicts.insuranceDuration.then(function(e){return _.filter(e,function(e){return"1 год"===e.title})})}(),t.driversCountChanged=function(){var e=t.drivers.length,i=t.params.drivers_count_full;if(t.calculation.is_multidrive=!i,i&&"0"!==i?(t.persons.length=0,t.osagoParams.vin_is_visible=!1,t.osagoParams.vin_number=""):(t.persons.length=0,b(),t.osagoParams.vin_is_visible=!0),i>e)for(var a=0;i-e>a;a++)h();else t.drivers.length=+i},t.driversCountChangedSimple=function(){var i=t.calculation.driver_set.length,r=t.params.drivers_count;if(t.params.field_was_clicked){if(r>i)for(var n=0;r-i>n;n++)t.calculation.driver_set.push(e.copy(a.defaultCalcDriver));else t.calculation.driver_set.length=+r;t.calculation.is_multidrive=!!r}},t.disabledFormationPolicyButton=function(){var e,i;if(i=["created_at","id","deductible_value","drivers_count","is_new_car"],$){$.car_cost=parseInt($.car_cost,10)+"",t.calculation.car_cost=parseInt(t.calculation.car_cost,10)+"";for(e in t.calculation)if(t.calculation.hasOwnProperty(e)&&i.indexOf(e)===-1&&!x(t.calculation[e],$[e]))return t.root.isFormationPolicyButtonDisabled=!0,!0}return t.root.isFormationPolicyButtonDisabled=!1,!1},t.resetPerson=function(e){c.resetPerson(e)}}])}(angular,jQueryApp),function(e,t){"use strict";e.module("calculatorC").controller("calculatorCtrl",["$scope","$state","$rootScope","$stateParams","Dictionary","calculatorService","calculatorStepsService","CONSTS","$q","$location","Messages","formationPolicyStep1Service","brandingConfigs","addingDocumentsService",function(i,a,r,n,s,l,o,c,d,u,p,m,g,v){function f(){i.calculationResult.sort(function(e,t){return parseFloat(e.program.sum)>parseFloat(t.program.sum)?1:-1})}var h,b={},y=30829,w=30854;i.calculationResult=[],i.params=l.calculatorOtherParams,i.templates={program_list_manager:g.templates.program_list_manager||c.pathToModules+"shared/carFilter/views/program_list.manager.html"},i.bigSteps=o.bigSteps,i.postCalculateParams={first:!1,second:!1,third:!1,is_visible:!1,manager__client_phone:"",manager__client_name:"",button_is_disabled:!1},i.toManager=function(){i.calculation.client_phone?i.sendToManager():i.postCalculateParams.third=!0},i.sendToManager=function(){var e=new FormData,t="",a=i.postCalculateParams.manager__client_name||i.calculation.client_name,r=i.postCalculateParams.manager__client_phone||i.calculation.client_phone;i.postCalculateParams.button_is_disabled=!0,t+="Клиент просит ему перезвонить.\n\n",t+="Имя клиента: "+a+"\n",t+="Телефон клиента: "+r+"\n\n",t+="Ссылка на расчет: http://enter.b2bpolis.ru/#/calculator/"+i.calculation.id,e.append("message",t),v.send(e).then(function(){i.postCalculateParams.button_is_disabled=!1,i.postCalculateParams.is_visible=!1,p.success("Ваш запрос принят. Мы свяжемся с вами в ближайшее время.",6e3)},function(){i.postCalculateParams.button_is_disabled=!1,p.error("Не удалось отправить запрос.",6e3)})},s.getItems("contributoryScheme").then(function(e){e=e.results?e.results:e,i.params.contributoryScheme=_.forEach(e,function(e){19!==e.id&&"Единовременно"!==e.title||(e.title="Единовременно")}),_.head(r.currentBrand.contributory_schemas)&&(i.params.contributoryScheme=_.map(r.currentBrand.contributory_schemas,function(e){return _.find(i.params.contributoryScheme,function(t){return t.id===e})}))}),i.paymentForm=r.currentBrand.payment_forms,i.getResultWithKbm=function(){var e=_.find(i.calculationResult,function(e){return e.insurance_company.id===y});return e||(e=_.find(i.calculationResult,function(e){return e.insurance_company.id===w})),e},i.setStep=function(e){i.step=e},i.root={messages:[],selectedResult:l.getSelectedResult()},i.calculation=l.calculation;var x=a.params.calculationId||i.calculation&&i.calculation.id;i.disabledSecondStep=!!i.calculation.id,i.calculateType=function(){return r.calcType},i.root.insuranceTypeTitle=function(){return"Калькулятор ОСАГО"},x?(x!=i.calculation.id&&l.resetCalculation(),b.getCalculation=l.getCalculation(x).then(function(){h=e.copy(i.calculation)}),b.getResult=l.getResult(x).then(function(e){return e&&e.length&&e?(i.calculationResult=_.filter(_.forEach(e,l.parseResult),function(e){return parseInt(e.program.sum)&&_.head(e.program.option_set)}),i.postCalculateParams.is_visible=!0,i.params.resultsAreVisible=!0,void f()):void i.root.messages.push("Ошибка со стороны страховой компании.")})):l.resetCalculation(),i.selectResult=function(e){var t=_.find(i.calculationResult,function(t){return t.id==e})||null;l.setSelectedResult(t),i.root.selectedResult=l.getSelectedResult(),t&&(i.bigSteps.setBigStep("fourth"),l.setResultAsSelected(t))},i.getYearRange=function(e,t){var i,a,r;return i=new Date,e=e||0,t=void 0===t?90:t,r=i.getFullYear()-t,a=i.getFullYear()-e,r+":"+a},i.resetCalculation=function(){i.calculation.id?p.success('Данные по расчету очищены, ваш расчет сохранен в разделе <a href="#/calculator/archive">Расчеты</a>.',7e3):p.success("Данные по расчету очищены.",4e3),l.resetCalculation(),m.resetAll(),i.calculationResult.length=0,u.search("policy",null),u.path("/calculator/"+r.calcType+"/",!1)},i.calculate=function(r){i.prevCalculationResult=e.copy(i.calculationResult),i.calculationResult.length=0,i.selectResult(null),i.calculation.created_by_user=null,l.createCalculation().then(function(n){var s=[],o=0;i.root.messages.length=0,console.log("%c createCalculationSuccess ","color: green"),h=e.copy(i.calculation),a.go(a.current,{calculationId:i.calculation.id},{notify:!1}),l.companiesInProgress.length&&_.forEach(l.companiesInProgress,function(e){var t=l.createResult(e.id).then(function(e){_.forEach(e,function(e){e.is_default&&parseInt(e.program.sum)&&(i.calculationResult.push(l.parseResult(e)),f(),o++,o>=5&&(i.params.recalculateButtonIsDisabled=!1))}),i.postCalculateParams.is_visible=!0});s.push(t)}),"function"==typeof r&&r(n),d.all(s).then(function(e){var a,r=_.flatten(e);return console.log("%c createResultSuccess ","color: green"),i.params.resultsAreCreated=!0,i.params.recalculateButtonIsDisabled=!1,r&&r.length?(a=t(".js-kasko-result").offset(),void(a&&jQueryApp("html,body").animate({scrollTop:a.top},"fast"))):(i.root.messages.push("Ошибка на стороне сервера."),void(i.params.isCalculationProgress=!1))},function(e){console.log("%c createResultError: ","color: red"),console.warn(e)}).then(function(e){i.params.recalculateButtonIsDisabled=!1,i.params.isCalculationProgress=!1})},function(e){console.log("%c createCalculationError: ","color: red"),console.warn(e),i.root.messages.push("Не удалось создать расчет. Пожалуйста, попробуйте позже."),i.params.isCalculationProgress=!1})}}])}(angular,jQueryApp),function(e,t){"use strict";e.module("calculatorC").service("calculatorService",["$http","$q","CONSTS","$rootScope","resources","calculator","$filter","requester",function(i,a,r,n,s,l,o,c){function d(e){var i=t(".ui-datepicker-year").val();return(e=new Date(e))?(e.setFullYear(i),o("date")(e,"yyyy-MM-dd")):""}var u=l.getDefaults(),p=function(e){return e=e||new Date,o("date")(e,"yyyy-MM-dd")},m={full_year:null,field_was_clicked:!1,drivers_count:1,drivers_count_full:1,signalization_type:"",show_empty_fields:!1,resultsAreCreated:!1,deductible_value:0,contributory_scheme:19,payment_form:107,recalculateButtonIsDisabled:!1,isCalculationProgress:!1,resultsAreVisible:!n.currentBrand.with_sms,multidriveForm:{birth_date:null,driving_experience_started:null}};this.parseResult=function(e){return e.company_logo="http://enter.b2bpolis.ru/"+e.insurance_company.logo,e},this.currentResult=null,this.getOtherCompanies=function(){return[{id:41243,title:"Росгосстрах",insurance_company:{logo:"media/logo_main_ins/Logo_24.png"}},{id:41465,title:"Ренессанс",insurance_company:{logo:"media/logo_main_ins/Logo_47.png"}}]},this.calculation=e.copy(u),this.companiesInProgress=[],this.getDefaultCalculation=function(){return u},this.selectedResult=null,this.setSelectedResult=function(e){this.selectedResult=e},this.getSelectedResult=function(){return this.selectedResult},this.calculationFormIsValid=_.noop,this._promises={},this.getPromises=function(){return this._promises},this.calculatorOtherParams=e.copy(m),this.resetCalculation=function(t){var i=e.copy(this.getDefaultCalculation());this.companiesInProgress.length=0,t=t||n.calcType;for(var a in this.calculation)this.calculation.hasOwnProperty(a)&&delete this.calculation[a];for(var r in i)i.hasOwnProperty(r)&&(this.calculation[r]=i[r]);for(var s in this.calculatorOtherParams)this.calculatorOtherParams.hasOwnProperty(s)&&(this.calculatorOtherParams[s]=m[s]);return this["to_defaults_"+t]&&this["to_defaults_"+t](),this},this.to_defaults_osago=function(){var t=new Date;t.setDate(t.getDate()+1),this.calculation.insurance_duration=82,this.calculation.driver_set=[e.copy(this.defaultCalcDriver)],this.calculation.car_type=1,this.calculation.drivers_count=1,this.calculation.calculation_at_date=p(t)},this.to_defaults_kasko=function(){var t=new Date;t.setDate(t.getDate()+1),this.calculation.insurance_duration=82,this.calculation.driver_set=[e.copy(this.defaultCalcDriver)],this.calculation.car_type=1,this.calculation.drivers_count=1,this.calculation.calculation_at_date=p(t),this.calculation.deductible_currency=23},this.defaultCalcDriver={is_married:!1,gender:"M",expirience:null,age:null,has_children:!1},this.createCalculation=function(t){return t=t||this.calculation,this.companiesInProgress.length=0,t=this.correctCalculation(t),delete t.token,c.post(s.calculation+"?token",t).then(function(t){var i,a=t.data,r=["driver_set"];this.calculationToken=a.token,this.companiesInProgress=a.available_insurance_departments,delete a.available_insurance_departments;for(i in a)a.hasOwnProperty(i)&&r.indexOf(i)===-1&&(e.equals(this.calculation[i],a[i])||(this.calculation[i]=a[i]));return t.data}.bind(this))},this.getCalculation=function(e){return e=e||this.calculation.id,e==this.calculation.id?a.when(this.calculation):(this._promises.getCalculation=c.get(s.calculation+e+"/").then(function(e){var t;e=e.data;for(t in e)"user"!==t&&(this.calculation[t]=e[t]);return this.calculation}.bind(this)),this._promises.getCalculation)},this.getResult=function(e){return e=e||this.calculation.id,c.get(s.calculationV3+e+"/result/?insurance_company=1&messages=1&variables=1&options=1").then(function(e){return this.companiesInProgress=e.data,this.currentResult=e.data,e.data}.bind(this))},this.createResult=function(e,t){var a=this.calculationToken;return t=t||this.calculation.id,i({url:"http://enter.b2bpolis.ru"+s.calculationV3+t+"/result/"+e+"/?insurance_company=1&messages=1&variables=1&options=1",method:"POST",headers:{"X-Calculation-Token":a}}).then(function(e){return this.companiesInProgress=e.data,this.currentResult=e.data,e.data}.bind(this))},this.setResultAsSelected=function(t,a){var r=this.calculationToken;return a=a||this.calculation.id,i({url:"http://enter.b2bpolis.ru"+s.calculationV3+a+"/result/"+t.insurance_company.version+"/?insurance_company=1&messages=1&variables=1&options=1",method:"PUT",headers:{"X-Calculation-Token":r},data:e.extend({},t,{is_selected:!0,is_default:!0})}).then(function(e){return e.data})},this.getCredentialList=function(e){return i.get(r.urlPrefixDefault+"client/natural-person/"+e+"/credential").then(function(e){return e.data})},this.getAddressList=function(e){return i.get(r.urlPrefixDefault+"client/natural-person/"+e+"/address").then(function(e){return e.data})},this.correctCalculation=function(e){return e=e||this.calculation},this.personDateChanged=function(e,t,i){t=t||"birth_date",t.indexOf(".")!==-1?(t=t.split("."),e[t[0]][t[1]]=d(e[t])):e[t]=d(e[t])},this.validateDrivers=function(){var e,t,i=this.calculation.driver_set.length;if(this.calculation.is_multidrive,0===i)return!0;for(e=0;e<i;e++)if(t=this.calculation.driver_set[e],t.age-t.expirience<17)return!1;return!0}}])}(angular,jQueryApp),function(e){e.module("formationPolicyC",[])}(angular),function(e){"use strict";e.module("formationPolicyC").service("formationPolicyService",["$http","CONSTS","$q","$rootScope","$filter","resources","requester",function(t,i,a,r,n,s,l){function o(){return null}function c(e){return e=e||new Date,n("date")(e,"yyyy-MM-dd")}function d(e){var t;return t="legal_person"===e.personType?["title","title_eng","id","inn","ogrn","kpp","representative_first_name","representative_last_name","representative_patronymic","representative_post","representative_credential_type","representative_number","representative_issue_date"]:["id","first_name","last_name","patronymic","first_name_eng","last_name_eng","patronymic_eng","birth_date","gender","driving_experience_started","is_individual_entrepreneur","is_foreigner"],_.pick(e,t)}var u={object:{credential:[{issue_date:"2016-02-04",creator:10585,series:"3456",number:"45",object_id:1751,issue_point:"",credential_type:10,content_type:480,expiration_date:null,external_id:"9374",id:5449}],keys_count:2,manufacturing_date:"2015-01-01",engine_power:"200.00",car_modification:null,creator:10585,car_model:7687,engine_displacement:"2.00",car_body_number:null,mileage:null,number_plate:"",car_mark:303,vin_number:"55TTEEE5E5R5R6TT7",external_id:"7628",id:1751,cost:null},object_type:"car",person:[]},p=null,m=null,g={clear:function(){m=null},resetCurrentPolicy:function(){p=null},updateCustomer:function(e){var i=a.defer(),r=o();return this.getCustomer(r).then(function(a){a.natural_persons=a.natural_persons.concat(e.natural_persons),a.natural_persons=_.uniq(a.natural_persons),t.put(s.customer+"/"+r,a).then(function(e){i.resolve(e.data)},function(e){i.reject(e)})},function(e){i.reject(e)}),i.promise},getCustomer:function(e){return e=e||o(),t.get(s.customer+"/"+e).then(function(e){return e.data})},getCustomerCars:function(e){return e=e||o(),t.get(s.customerCar,{params:{owner:e}}).then(function(e){return e.data})},getCarCredential:function(e){return t.get(s.customerCar+"/"+e+"/credential").then(function(e){return e.data})},getCustomerFull:function(e){var i=a.defer();return this.getCustomer(e).then(function(e){t.get(s.person+"/"+e.person).then(function(a){var r=a.data,n="naturalPerson",l=r.natural_person;r.legal_person&&(n="legalPerson",l=r.legal_person),t.get(s[n]+"/"+l).then(function(t){var a=t.data;i.resolve({person:a,drivers:e.natural_persons})},function(e){i.reject(e)})},function(e){i.reject(e)})},function(e){i.reject(e)}),i.promise},saveCar:function(i){var r=o(),n=a.defer(),l=_.pick(i,["id","mileage","car_mark","car_model","car_modification","owner","manufacturing_date","vin_number","number_plate","engine_displacement","engine_power","cost","keys_count"]),c="post",d=s.customerCar;return l.owner=l.owner||r,l.id&&(c="put",d+="/"+l.id),t[c](d,l).then(function(r){var l=r.data,o=_.map(i.credential,function(e){return _.pick(e,["id","number","series","credential_type","issue_date","issue_point","expiration_date"])}),c=[];e.forEach(o,function(e){var i="post",a=s.customerCar+"/"+l.id+"/credential";e.id&&(i="put",a+="/"+e.id),c.push(t[i](a,e).then(function(e){return e.data}))}),a.all(c).then(function(e){n.resolve({car:l,credential:e})},function(e){n.reject(e)})},function(e){n.reject(e)}),n.promise},createDeal:function(i){var r=a.defer();return t.post(s.deal,e.extend({deal_status:1,customer:o()},i)).then(function(e){var a=e.data;a.car=i.car,t.put(s.deal+"/"+a.id,a).then(function(e){r.resolve(e.data)},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise},getDeal:function(e){return t.get(s.deal+"/"+e)},createInsuranceProduct:function(e,i){return t.post(s.deal+"/"+e+"/insurance-product/from-calculation",i).then(function(e){return e.data})},updateInsuranceProduct:function(e,i,a){return t.put(s.deal+"/"+e+"/insurance-product/"+i,a).then(function(e){return e.data})},createInvoice:function(e,i){return t.post(s.deal+"/"+e+"/insurance-product/"+i+"/invoice/generate").then(function(e){return e.data})},createPersonContainer:function(e,i){var a={};return i="legal_person"===i?"legal_person":"natural_person",a[i]=e,t.post(s.person,a).then(function(e){return e.data})},saveBSO:function(e,i){return t.post(s.resultPolicy+"/"+e+"/enter_bso/",i).then(function(e){return e.data})},createInsuredObjectByIds:function(e){return t.post("/rest/default/client/insured-object",e).then(function(e){return e.data})},createInsuredObjectOsago:function(t){var i={object:{car_mark:t.car.car_mark,car_model:t.car.car_model,car_model_group:t.car.car_model_group||null,car_modification:t.car.car_modification||null,cost:+t.car.cost,engine_displacement:t.car.engine_displacement,engine_power:t.car.engine_power,credential:t.car.credential,external_id:t.car.id||this.generateId(),vin_number:t.car.vin_number,number_plate:t.car.number_plate,manufacturing_date:t.car.manufacturing_date,keys_count:t.car.keys_count,mileage:t.car.mileage,car_body_number:t.car.car_body_number,engine_power_kilowatt:t.car.engine_power_kilowatt,chassis_number:t.car.chassis_number},object_type:"car",person:[],drivers:[]};return e.forEach(i.object.credential,function(e){e.external_id=e.id||this.generateId()},this),e.forEach(t.persons,function(t,a){var r,n,s={},l=[],o=t.id||this.generateId(),u=t.address_registration?[t.address_registration]:[],p=d(t),m=t.personType;u&&u.lendth&&(u[0].address_type=1),"natural_person"===m?(n=t.credential,e.forEach(n,function(e){e&&(e.issue_date=c(e.issue_date),e.external_id=e.id||this.generateId())},this),!t.is_same_address&&t.address_residential&&(u.push(t.address_residential),u[1].content_type=482,u[1].address_type=2),t.birth_date=c(t.birth_date),t.driving_experience_started=c(t.driving_experience_started)):n=null,e.forEach(["owner","insurant"],function(e){var i="is"+e[0].toUpperCase()+e.substr(1);t[i]&&l.push(e)}),l.length>0&&(s.role=l,s.external_id=o,s.id=t.person_id,s[m]=p,s[m].external_id=o,s[m].credential=n,s[m].address=u,i.person.push(s)),t.isDriver&&(r=e.copy(p),r.external_id=o,r.credential=[],r.credential.push(_.find(n,function(e){return 3===e.credential_type})),r.credential.push(_.find(n,function(e){return 1===e.credential_type})),r.credential[1]||(r.credential.length=1),i.drivers.push(r))},this),l.post(s.insuredObjectOsago,i).then(function(t){return m=e.copy(t.data),t.data})},sendPhone:function(e){return t.post("/policy/rest/result_policy/"+e.policy_id+"/token",_.pick(e,"phone")).then(function(e){return e.data})},confirmPhone:function(e){return t.post("/policy/rest/result_policy/"+e.policy_id+"/token-verified",_.pick(e,"token")).then(function(e){return e.data})},toPay:function(e){return t.post("/payment/"+e+"/ ").then(function(e){return e.data})},createInsuredObject:function(t){var i,a;
return t.car?(i={object:{car_mark:t.car.car_mark,car_model:t.car.car_model,car_model_group:t.car.car_model_group||null,car_modification:t.car.car_modification||null,cost:t.car.cost,engine_displacement:t.car.engine_displacement,engine_power:t.car.engine_power,credential:t.car.credential,external_id:t.car.id||this.generateId(),vin_number:t.car.vin_number,number_plate:t.car.number_plate,manufacturing_date:t.car.manufacturing_date,keys_count:t.car.keys_count,mileage:t.car.mileage,is_new_car:t.car.is_new_car,is_temporary:t.car.is_temporary,chassis_number:t.car.chassis_number},object_type:"car",person:[],drivers:[]},a=["owner","insurant","beneficiary"],e.forEach(i.object.credential,function(e){e.external_id=e.id||this.generateId()},this)):(i=u,a=["owner","insurant"]),e.forEach(t.persons,function(t,r){var n,s,l={},o=[],u=t.id||this.generateId(),p=[t.address_registration],m=_.filter(t.contact,function(e){return e.data}),g=d(t),v=t.personType;"legal_person"===v?s=null:(s=t.credential,e.forEach(s,function(e){e.issue_date=c(e.issue_date),e.external_id=e.id||this.generateId()},this),t.is_same_address||p.push(t.address_residential),t.is_temporary_registration&&p.push(t.address_temporary_registration),t.birth_date=c(new Date(t.birth_date)),t.driving_experience_started=t.driving_experience_started?c(new Date(t.driving_experience_started)):null),e.forEach(a,function(e){var i="is"+e[0].toUpperCase()+e.substr(1);t[i]&&o.push(e)}),e.forEach(p,function(e){e&&!e.country&&(e.country="Россия")}),o.length>0&&(l.role=o,l.external_id=u,l.id=t.person_id,l[v]=g,l[v].external_id=u,l[v].contact=m,l[v].credential=s,l[v].address=p,i.person.push(l)),t.isDriver&&(n=e.copy(g),n.external_id=u,n.address=p,n.credential=_.filter(s,function(e){return 3===e.credential_type}),i.drivers.push(n))},this),l.post(s.insuredObject,i).then(function(t){return m=e.copy(t.data),t.data})},getInsuredObject:function(t){return l.get(s.insuredObject+"/"+t).then(function(t){return m=e.copy(t.data),t.data})},getInsuredObjectOsago:function(t){return l.get(s.insuredObjectOsago+"/"+t).then(function(t){return m=e.copy(t.data),t.data})},getPolicyFile:function(e,i){return i=i?"?type="+i:"",t({method:"GET",url:s.resultPolicy+e+"/template/"+i,headers:{}}).then(function(e){return e.data})},createInsuredObjectCRM:function(e){return t.post(s.insuredObjectCRM,e).then(function(e){return e.data})},createPolicy:function(i){return t.post(s.resultPolicy,e.extend({external_id:o()},i)).then(function(e){return p=e.data})},savePolicy:function(i){var a="post",r=s.resultPolicy;return i.id&&(a="put",r=s.resultPolicy+i.id+"/"),t[a](r,e.extend({external_id:o()},i)).then(function(e){return p=e.data})},getPolicy:function(e){return t.get(s.resultPolicy+e+"/",{params:{external_id:o()}}).then(function(e){return p=e.data})},getSavedNaturalPersons:function(e){return t.get(s.savedNaturalPersons,{params:e}).then(function(e){return e.data})},getSavedLegalPersons:function(e){return t.get(s.savedLegalPersons,{params:e}).then(function(e){return e.data})},getSavedCars:function(e){return t.get(s.savedCars,{params:e}).then(function(e){return e.data})},getInsObjList:function(e){return t.get(s.insuredObectList,{params:e}).then(function(e){return console.log(e),e.data})},getCurrentPolicy:function(){return p},getCurrentInsuredObject:function(){return m},sendNotification:function(e){return t.post(s.notificationSend,e).then(function(e){return e.data})},generateId:function(){return~~(9900*Math.random()+100)},getPolicyActionsParameters:function(e){return t.get(s.resultPolicy+e+"/actions_parameters/",{params:{external_id:o()}}).then(function(e){return e.data})},executePolicyAction:function(e,a,r){return t.post(i.urlPrefixPolicy+"result_policy/"+e+"/"+a+"/",r).then(function(e){return e.data})},getPolicyDocsArchive:function(e){return t.get(i.urlPrefixPolicy+"result_policy/"+e+"/zip/").then(function(e){return e.data})},getPolicyAttachments:function(e){return t.get(s.resultPolicy+e+"/attachment/").then(function(e){return e.data})},deletePolicyAttachment:function(e,i){return t.delete(s.resultPolicy+e+"/attachment/"+i).then(function(e){return e.data})},issueToSavedPolicy:function(e){return t.post(s.resultPolicy+e+"/issue_to_saved_policy/").then(function(e){return e})},setPersonValidationDates:function(e){e.isDriver?(e.birthDateRange={min:function(){var t=new Date;return t.setFullYear(t.getFullYear()-e.age-1),c(t)}(),max:function(){var t=new Date;return t.setFullYear(t.getFullYear()-e.age),c(t)}()},e.expirienceRange={min:function(){var t=new Date;return t.setFullYear(t.getFullYear()-e.expirience-1),c(t)}(),max:function(){var t=new Date;return t.setFullYear(t.getFullYear()-e.expirience),c(t)}()}):(e.birthDateRange={min:function(){var e=new Date;return e.setFullYear(e.getFullYear()-90),c(e)}(),max:function(){var e=new Date;return e.setFullYear(e.getFullYear()-18),c(e)}()},e.expirienceRange={min:function(){var e=new Date;return e.setFullYear(e.getFullYear()-72),c(e)}(),max:function(){return c(new Date)}()}),e.birthDateRange.yearRange=new Date(e.birthDateRange.min).getFullYear()+":"+new Date(e.birthDateRange.max).getFullYear(),e.expirienceRange.yearRange=new Date(e.expirienceRange.min).getFullYear()+":"+new Date(e.expirienceRange.max).getFullYear(),e.dateChanged=function(t,i){var a=new Date(t).getFullYear(),r=new Date(i).getFullYear();e.invalidDates=a-r>=18}}};return g}])}(angular),function(e,t){"use strict";e.module("formationPolicyC").service("formationPolicyStep1Service",["$filter","$rootScope","formationPolicyService","Person","calculatorService","$q",function(t,i,a,r,n,s){function l(){return C=e.copy(A)}function o(t,i){i=i||C;var a=_.filter(t,function(e){return e.credential_type===M.credential_type}),r=_.filter(t,function(e){return e.credential_type===O.credential_type});i.vehicle_registration=_.maxBy(a,function(e){return e.id})||e.copy(M),i.vehicle_certificate=_.maxBy(r,function(e){return e.id})||e.copy(O)}function c(t){if(_.head(t.credential)&&"natural_person"===t.personType){var i=_.filter(t.credential,function(e){return e.credential_type==j.credential_type}),a=_.filter(t.credential,function(e){return e.credential_type==T.credential_type});t.driver_license=_.maxBy(i,function(e){return e.id}),t.passport=_.maxBy(a,function(e){return e.id})||e.copy(T)}return t}function d(t){return e.isArray(t.contact)&&t.contact.length>0&&(t.contact=_.sortBy(_.uniqBy(t.contact,function(e){return e.contact_type}),function(e){return e.contact_type})),t}function u(e){var t=new Date,i=new Date(e);if(i.getTime())return new Date(t-i).getFullYear()-1970}function p(e){e.full=e.city+", "+e.street+", д."+e.house}function m(t){if(e.isArray(t.address)&&t.address.length>0){var i=_.filter(t.address,function(e){return 1===e.address_type});i=_.maxBy(i,function(e){return e.id});var a=_.filter(t.address,function(e){return 2===e.address_type});a=_.maxBy(a,function(e){return e.id});var r=_.filter(t.address,function(e){return 3===e.address_type});r=_.maxBy(r,function(e){return e.id}),t.is_same_address=!a,t.is_temporary_registration=Boolean(r),i&&(t.address_registration=i,p(i)),a&&(t.address_residential=a,p(a)),r&&(t.address_temporary_registration=r,p(r))}return t}function g(e,t){return t=t||i.calcType,E[t](e,C)}function v(e){return e=e||i.calcType,B[e]()}function f(e,t,a,r){return r=r||i.calcType,R[r](e,t,a)}function h(e,t){return t=t||i.calcType,N[t](e,t)}function b(e){return V.allTypes(e)}function y(e){return e=e||i.calcType,q[e]()}function w(e){return U.allTypes(e)}function x(){P.length=0,l()}function k(e){return e=e||i.calcType,Y[e](e)}var C,P=[],S=n.calculation,I="yyyy-MM-dd",D=function(e){return t("date")(e,I)},$={address_type:1,postal_index:null,content_type:482,country:"Россия",city:"",street:"",house:"",housing:"",flat:"",kladr:""},T={credential_type:1,series:"",number:"",issue_date:"",issue_point:"",expiration_date:""},j={credential_type:3,series:"",number:"",issue_date:"",issue_point:"РФ",expiration_date:""},M={credential_type:4,series:"",number:"",issue_date:"",issue_point:"",expiration_date:""},O={credential_type:7,series:"",number:"",issue_date:"",issue_point:"",expiration_date:""},F={is_same_address:!0,person_type:"natural_person",credential:[],isOwner:!1,isDriver:!1,isInsurant:!1,first_name:"",last_name:"",patronymic:"",gender:null,birth_date:"",passport:e.copy(T),address_registration:e.copy($),address_residential:e.extend(e.copy($),{address_type:2})},A={car_mark:null,car_model:null,car_modification:null,cost:0,vin_number:"",chassis_number:"",number_plate:"",engine_displacement:"",engine_power:"",engine_power_kilowatt:"",keys_count:S.driver_set.length||1,mileage:"",manufacturing_date:null,selectedCar:"",vehicle_registration:e.copy(M),vehicle_certificate:e.copy(O),document_issue_date:"",mode:"edit"};l();var R={osago:function(t,i,n){var s,l=new Date,o=18,c=new r(e.extend(e.copy(F),{personType:i||"natural_person",isOwner:!1,isInsurant:!1,isDriver:!1,selectedPerson:"",mode:"edit"}));return t=t||{},"legal_person"===i?(c.extend({title:"",isDriver:!1,inn:"",ogrn:""}),c.address_registration=c.addAddress(e.copy($))):(s=t.expirience||0===t.expirience?t.expirience:null,null===s&&(s=u(t.driving_experience_started)),c.extend({age:t.age||o,expirience:s,gender:"M",birth_date:t.birth_date||"",is_same_address:!0,is_temporary_registration:!1,driving_experience_started:t.driving_experience_started||""}),c.passport=c.addCredential(e.copy(T)),c.driver_license=c.addCredential(e.copy(j)),c.address_registration=c.addAddress(e.copy($)),c.address_residential=c.addAddress(e.copy($)),c.address_temporary_registration=c.addAddress(e.copy($)),c.driving_experience_started||(l=new Date,l.setFullYear(l.getFullYear()-c.expirience),c.driver_license.issue_date=D(l),c.driving_experience_started=D(l))),c.extend(t),a.setPersonValidationDates(c),c.hasRole=function(){return c.isInsurant||c.isOwner},n||P.push(c),c}},B={osago:function(){function t(){return S.id||(S.insured_object=11920),S.insured_object?a.getInsuredObject(S.insured_object):s.when({})}return t().then(function(t){t&&t.id?g(t):_.forEach(S.driver_set,function(t){var i={isDriver:!0,showFioFields:!0};f(e.extend(i,t))}),e.extend(C,{car_mark:S.car_mark,car_model:S.car_model,car_modification:S.car_modification,cost:Math.floor(S.car_cost),car_body_number:"",vin_number:null,number_plate:"",engine_displacement:null,engine_power:S.engine_power,mileage:null,manufacturing_date:S.car_manufacturing_year+"-01-01",vehicle_registration:e.copy(M),vehicle_certificate:e.copy(O),credential:[]}),e.extend(C,t.object),C.id=null;var a=_.head(P);if(S.is_legal_entity&&"false"!==S.is_legal_entity&&(a.address_registration=e.copy($)),S.is_legal_entity&&i.currentUser){a.isInsurant=!1;var r=f({isInsurant:!0,isOwner:!1,isDriver:!1,title:i.currentUser.last_name,inn:i.currentUser.inn,ogrn:i.currentUser.ogrn},"legal_person");i.currentUser.address&&(e.extend(r.address_registration,i.currentUser.address),p(r.address_registration))}else a&&i.currentUser&&i.currentUser.id&&(a.passport&&!a.passport.series&&(a.passport.series=i.currentUser.passport_series,a.passport.number=i.currentUser.passport_number),a.address_registration&&!a.address_registration.city&&i.currentUser.address&&(e.extend(a.address_registration,i.currentUser.address),p(a.address_registration))),a.isInsurant=!0;a.isOwner=!0})}},E={osago:function(i){var a;P.length=0,C=i.object,o(C.credential),C.engine_power_kilowatt=+(.7355*S.engine_power).toFixed(2),C.engine_power=S.engine_power,_.forEach(i.person,function(e){var i=e.natural_person?"natural_person":"legal_person";e[i].personType=i,e[i].person=e.id,c(e[i]),m(e[i]),e[i].selectedPerson=e[i].external_id,"natural_person"===i&&(e[i].age=t("calcAge")(e[i].birth_date)),e.role.length&&_.forEach(e.role,function(t){e[i]["is"+t[0].toUpperCase()+t.substr(1)]=!0}),f(e[i])}),a=_.forEach(i.drivers,function(e){e.personType="natural_person",e.isDriver=!0,c(e),m(e)}),_.forEach(a,function(t){var i;_.forEach(P,function(a,r){t.external_id===a.external_id&&(i=!0,e.extend(a,t),a.isDriver=!0)}),t.driver_license=_.find(t.credential,function(e){return 3===e.credential_type})||e.copy(j),i||f(t)})}},N={osago:function(e){var t=P.indexOf(e),i=t-1>=0?t-1:t+1;e.isOwner&&(P[i].isOwner=!0),e.isInsurant&&(P[i].isInsurant=!0),t!==-1&&P.splice(t,1)}},q={osago:function(){e.forEach(P,function(e){e.address=[],e.credential=[],e.birth_date=D(e.birth_date),"natural_person"===e.personType&&((e.isInsurant||e.isOwner)&&(e.passport.credential_type=1,e.credential.push(e.passport)),e.isDriver&&(e.driver_license&&e.credential.push(e.driver_license),e.driving_experience_started=D(e.driving_experience_started)))});var t=_.find(P,function(e){return e.isOwner}),i=_.find(P,function(e){return e.isInsurant}),r=_.map(_.filter(P,function(e){return e.isDriver}),"id"),n={owner:t.person,beneficiary:t.person,insurant:i.person,drivers:r,object_type:"car",object_id:C.id};return C.credential=[],C.vehicle_registration&&C.credential.push(C.vehicle_registration),C.vehicle_certificate&&C.credential.push(C.vehicle_certificate),a.createInsuredObjectByIds(n)}},U={allTypes:function(t){return function(i){return e.isObject(i)&&(b(t),t.extend(i),t.getCredentialList().then(function(){c(t)}),t.getAddressList().then(function(){m(t)}),t.getContactList().then(function(){d(t)})),!0}}},V={allTypes:function(t){return e.extend(t,{id:null,age:t.selectedPerson?18:t.age,birth_date:"",last_name:"",first_name:"",patronymic:"",last_name_eng:"",first_name_eng:"",patronymic_eng:"",is_same_address:!0,driving_experience_started:"",selectedPerson:"",document:{credential_type:1,series:"Не указан",number:"",issue_date:""},title:"",title_eng:"",inn:"",ogrn:"",kpp:"",representative_first_name:"",representative_last_name:"",representative_patronymic:"",representative_post:"",representative_credential_type:"",representative_number:"",representative_issue_date:"",rsa_check_id:null,person:null,is_verified:null,is_current_user:!1}),t.pT=t.pT||t.personType,t.passport=t.addCredential(e.copy(T)),t.ogrntip=t.addCredential(e.copy(T)),t.driver_license=t.addCredential(e.copy(j)),t.address_registration=t.addAddress(e.copy($)),t.address_residential=t.addAddress(e.copy($)),t.address_temporary_registration=t.addAddress(e.copy($)),t.contact=[{contact_type:1,data:""},{contact_type:2,data:""}],t.address_registration.country=null,t.address_residential.country=null,t.address_temporary_registration.country=null,t.credential.length=0,t.address.length=0,t.contact.length=0,t}},Y={osago:function(){var e={isInsurant:!1,isOwner:!1,all:!1};return _.forEach(P,function(t){t.isInsurant&&(e.isInsurant=!0),t.isOwner&&(e.isOwner=!0)}),e.all=e.isInsurant&&e.isOwner,e}};return{addPerson:f,resetPerson:b,initFromCalculation:v,initFromInsuredObject:g,removePerson:h,persons:P,getPersons:function(){return P},createInsuredObject:y,resetAll:x,showSavedPersonsCallback:w,resetCar:l,getCar:function(){return C},setCarCredentials:o,getDefaultObject:function(t){var i={defaultAddressObject:$,defaultPassportObject:T,defaultDriverLicenseObject:j,defaultVehicleRegistrationObject:M};return e.copy(i[t])},setPersonCredential:c,setPersonAddress:m,setFullAddress:p,personCheckUsed:k}}])}(angular,jQueryApp),function(e){e.module("brandingC",[])}(angular),function(e){"use strict";e.module("brandingC").service("brandingService",["CONSTS","$stateParams","brandingConfigs",function(t,i,a){var r={},n={};return r[t.currentBrand]=e.extend(n,a),r}])}(angular),function(e){e.module("AddingDocumentsC",[])}(angular),function(e){"use strict";e.module("AddingDocumentsC").service("addingDocumentsService",["$q","CONSTS",function(e,t){function i(){var e;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=!1}}return e||"undefined"==typeof XMLHttpRequest||(e=new XMLHttpRequest),e}this.send=function(a,r){var n,s=e.defer();return n=i(),n.open("POST",t.proxyPathC+"mail.php",!0),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?s.resolve(n.responseText):s.reject(r?r(n.responseText):n.responseText))},n.send(a),s.promise},this.uploader=null}])}(angular),function(e){e.module("calculatorStepsC",[])}(angular),function(e){e.module("calculatorO",[])}(angular),function(e){"use strict";e.module("calculatorO").controller("calculatorCascoCtrl",["$state",function(e){}])}(angular),function(e,t){"use strict";e.module("calculatorO").controller("calculatorCtrl",["$scope","$state","$rootScope","$stateParams","Dictionary","calculatorService","CONSTS","$q","$location","Messages","formationPolicyStep1Service","calculatorStepsService","brandingConfigs",function(i,a,r,n,s,l,o,c,d,u,p,m,g){var v,f={},h=30829,b=30854;i.calculationResult=[],i.params=l.calculatorOtherParams,i.templates={navigation:g.templates.navigation||o.pathToModules+"shared/calculator/views/navigation.html"},i.getResultWithKbm=function(){var e=_.find(i.calculationResult,function(e){return e.insurance_company.id===h});return e&&e.variables.KBM&&e.variables.KBM.length&&e.variables.kbm||(e=_.find(i.calculationResult,function(e){return e.insurance_company.id===b})),e},i.bigSteps=m.bigSteps,i.setSumWithOtherKbm=function(e){var t,a=i.getResultWithKbm(),r=e.variables.S_orig||e.program.sum,n=0;return!a||!a.variables||e.variables.KBM&&e.variables.KBM.length||a.variables.kbm?r:(e.variables.S_orig&&(n=e.program.sum-e.variables.S_orig),a.variables?(t=_.isArray(a.variables.KBM)?_.max(a.variables.KBM):_.isArray(a.variables.KBM_WITH_DOCUMENT)?_.maxBy(a.variables.KBM_WITH_DOCUMENT,function(e){return+e.kbm}):a.variables.kbm?a.variables.kbm:1,r*t+n):void 0)},i.setStep=function(e){i.step=e},i.root={messages:[],selectedResult:l.getSelectedResult()},i.calculation=l.calculation;var y=a.params.calculationId||i.calculation&&i.calculation.id;i.disabledSecondStep=!!i.calculation.id,i.calculateType=function(){return r.calcType},i.root.insuranceTypeTitle=function(){return"Калькулятор ОСАГО"},i.getCurrentCalcType=function(){return m.getCurrentCalcType()},y?(y!=i.calculation.id&&l.resetCalculation(),f.getCalculation=l.getCalculation(y).then(function(){v=e.copy(i.calculation)}),f.getResult=l.getResult(y).then(function(e){return e&&e.length&&e?void(i.calculationResult=_.forEach(e,l.parseResult)):void i.root.messages.push("Ошибка со стороны страховой компании.")})):l.resetCalculation(),i.selectResult=function(e){var t=_.find(i.calculationResult,function(t){return t.id==e});t=t||null,l.setSelectedResult(t),i.root.selectedResult=l.getSelectedResult()},i.getYearRange=function(e,t){var i,a,r;return i=new Date,e=e||0,t=void 0===t?90:t,r=i.getFullYear()-t,a=i.getFullYear()-e,r+":"+a},i.resetCalculation=function(){i.calculation.id?u.success('Данные по расчету очищены, ваш расчет сохранен в разделе <a href="#/calculator/archive">Расчеты</a>.',7e3):u.success("Данные по расчету очищены.",4e3),l.resetCalculation(),p.resetAll(),i.calculationResult.length=0,d.search("policy",null),d.path("/calculator/"+r.calcType+"/",!1)},i.calculate=function(r){i.prevCalculationResult=e.copy(i.calculationResult),i.calculationResult.length=0,i.selectResult(null),i.calculation.created_by_user=null,l.createCalculation().then(function(n){var s=[];i.root.messages.length=0,console.log("%c createCalculationSuccess ","color: green"),v=e.copy(i.calculation),a.go(a.current,{calculationId:i.calculation.id},{notify:!1}),l.companiesInProgress.length&&_.forEach(l.companiesInProgress,function(e){s.push(l.createResult(e.id).then(function(e){e=_.head(e),parseInt(e.program.sum)&&i.calculationResult.push(l.parseResult(e))}))}),"function"==typeof r&&r(n),c.all(s).then(function(e){var a,r=_.flatten(e);return console.log("%c createResultSuccess ","color: green"),i.params.resultsAreCreated=!0,r&&r.length?(a=t(".js-kasko-result").offset(),void(a&&jQueryApp("html,body").animate({scrollTop:a.top},"fast"))):(i.root.messages.push("Ошибка на стороне сервера."),void(i.params.isCalculationProgress=!1))},function(e){console.log("%c createResultError: ","color: red"),console.warn(e)}).then(function(e){i.params.isCalculationProgress=!1})},function(e){console.log("%c createCalculationError: ","color: red"),console.warn(e),i.root.messages.push("Не удалось создать расчет. Пожалуйста, попробуйте позже."),i.params.isCalculationProgress=!1})}}])}(angular,jQueryApp),function(e,t){"use strict";e.module("calculatorO").controller("calculatorOsagoCtrl",["$scope","calculatorService","CONSTS","$stateParams","Dictionary","$filter","formationPolicyService","formationPolicyStep1Service","$rootScope","ngDialog","Person","calculatorStepsService",function(t,i,a,r,n,s,l,o,c,d,u,p){function m(i){C=i.insurance_type,D=e.copy(i),t.params.drivers_count=i.driver_set.length,t.params.drivers_count_full=i.driver_set.length,i.insured_object?y(i.insured_object):g()}function g(){v()}function v(i){var a=e.copy($);a.driver_license=o.getDefaultObject("defaultDriverLicenseObject");var r=new u(e.extend({},a,i));t.drivers.push(r)}function f(i){var a=new u(e.extend({},T,i));t.persons.push(a)}function h(){return(t.calculation.engine_power>9&&t.calculation.engine_power<=999||!t.calculation.engine_power)&&t.calculation.car_mark&&t.calculation.car_model&&t.calculation.car_manufacturing_year}function b(t,i){return e.isObject(t)?e.equals(t,i):null===t||null===i?Boolean(t)==Boolean(i):t==i}function y(t){return l.getInsuredObject(t).then(function(t){return S=e.copy(t),w(t)})}function w(i){var a=e.copy(i.person);return t.persons.length=0,t.drivers.length=0,i.object.vin_number?(t.osagoParams.vin_number=i.object.vin_number,t.osagoParams.vin_is_visible=!0):t.osagoParams.vin_is_visible=!1,e.forEach(a,function(i){var a=i.natural_person?"natural_person":"legal_person";i[a].selectedPerson=i[a].external_id,"natural_person"===a?(i[a].age=s("calcAge")(i[a].birth_date),i[a].expirience=s("calcAge")(i[a].driving_experience_started)):(t.osagoParams.legal_person.inn=i[a].inn,t.osagoParams.legal_person.title=i[a].title,t.osagoParams.legal_person.insurant_is_legal_person=!0),i[a].personType=a,o.setPersonCredential(i[a]),o.setPersonAddress(i[a]),i.role.length&&_.forEach(i.role,function(e){i[a]["is"+e.slice(0,1).toUpperCase()+e.slice(1,e.length)]=!0}),"natural_person"===a&&f(e.copy(i[a]))}),e.forEach(i.drivers,function(e){e.personType="natural_person",e.isDriver=!0,o.setPersonCredential(e),v(e)}),t.persons.length||t.drivers.length||f(),t.drivers.length&&(i.person.length&&(t.drivers[0].person=i.person[0].id),t.persons.length=0),t.cachedDrivers=e.copy(t.drivers),P={drivers:e.copy(t.drivers),persons:e.copy(t.persons)},i}function x(){var e=t.drivers.length?t.drivers:t.persons,i={car:{car_mark:t.calculation.car_mark,car_model:t.calculation.car_model,car_model_group:t.calculation.car_model_group||null,manufacturing_date:t.calculation.car_manufacturing_year+"-01-01",engine_power:t.calculation.engine_power,cost:0,vin_number:t.osagoParams.vin_number},persons:e};return l.createInsuredObjectOsago(i)}function k(e){return e=e||new Date,s("date")(e,"yyyy-MM-dd")}var C,P,S,I=i.getPromises(),D={},$={credential:[],address:[],contact:[],first_name:"",last_name:"",patronymic:"",isDriver:!0,personType:"natural_person",birth_date:"",gender:"M",driving_experience_started:"",driver_license:o.getDefaultObject("defaultDriverLicenseObject")},T={is_same_address:!0,credential:[],isOwner:!0,personType:"natural_person",isDriver:!1,isInsurant:!1,first_name:"",last_name:"",patronymic:"",gender:"M",birth_date:"",passport:o.getDefaultObject("defaultPassportObject"),address_registration:{address_type:1,postal_index:"Нет",country:"Россия",city:"Не указан",street:"Не указана",house:"Не указан",housing:"Не указан",flat:"Не указан",kladr:""}},j=[];t.dicts={},t.dynamicDicts={},t.persons=[],t.drivers=[],t.params.field_was_clicked=!1,t.osagoParams={vin_number:"",vin_is_visible:!0,legal_person:{isOwner:!0,isInsurant:!1,inn:"",title:"",address_registration:{address_type:1,postal_index:"Нет",country:"Россия",city:"Не указан",street:"Не указана",house:"Не указан",housing:"Не указан",flat:"Не указан",kladr:""},is_same_address:!0,personType:"legal_person"}},i.calculationFormIsValid=function(){return!0},t.templates.program_list=a.pathToModules+"osago/calculatorO/views/osago/calculation.program_list.html",t.validation={},t.isVisible=function(e,i,a){var r;+t.calculation.car_type;return a=a||t.calculation,"vin_number"===e&&(r=!Number(t.params.drivers_count_full)||t.calculation.is_legal_entity&&"false"!==t.calculation.is_legal_entity,a=t.osagoParams),r||(a[e]=i||null),r},t.isDisabled=function(e,i,a){var r;+t.calculation.car_type;return a=a||t.calculation,r&&(a[e]=i||null),r},_.isPromise(I.getCalculation)?I.getCalculation.then(m,g):t.calculation.id?i.getCalculation(t.calculation.id).then(m,g):g(),t.fieldChanged=function(e){"is_legal_entity"===e&&t.calculation.is_legal_entity&&"true"!==t.calculation.is_legal_entity&&(t.params.drivers_count=0,t.params.drivers_count_full=0,t.params.field_was_clicked=!1,t.driversCountChanged(),t.calculation.driver_set.length=0,t.calculation.is_multidrive=!0)},t.calculateOsago=function(){function i(){return t.calculate(function(i){t.cachedDrivers=e.copy(t.drivers),t.disabledFormationPolicyButtonIsActive=!0,D=e.copy(i)})}var a=[],r=[];if(!t.params.isCalculationProgress){if(t.params.isCalculationProgress=!0,t.root.messages.length=0,t.calculation.is_calculate_osago=!0,t.calculation.car_cost="0",t.calculation.drivers_count=t.params.drivers_count,delete t.calculation.insurance_type,delete t.calculation.insured_object,t.calculation.is_legal_entity&&"false"!==t.calculation.is_legal_entity?t.calculation.calculation_type=45427:t.calculation.calculation_type=45426,"full"!==p.getCurrentCalcType())return i();t.calculation.drivers_count=t.params.drivers_count_full,t.calculation.driver_set.length=0,e.forEach(t.drivers,function(i){var n=s("calcAge")(i.birth_date),l=s("calcAge")(i.driving_experience_started);i.isDriver=!0,i.personType="natural_person",t.calculation.driver_set.push({age:n||18,expirience:l,is_married:!1,has_children:!1}),a.push(n),r.push(l),i.birth_date=k(i.birth_date),i.driving_experience_started=k(i.driving_experience_started),i.driver_license.credential_type=3,i.credential=[e.copy(i.driver_license)]}),e.forEach(t.persons,function(e){e.birth_date=k(e.birth_date),e.isDriver=!1,e.credential=[e.passport]}),!t.drivers.length&&t.calculation.is_legal_entity&&"false"!==t.calculation.is_legal_entity&&(t.persons=[t.osagoParams.legal_person]),t.calculation.drivers_minimal_age=Math.min.apply(Math,a),t.calculation.drivers_minimal_experience=Math.min.apply(Math,r),P={drivers:e.copy(t.drivers),persons:e.copy(t.persons)},x().then(function(e){t.calculation.insured_object=e.id||null,i()},function(){t.root.messages.push("Ошибка при сохранении объекта страхования."),t.params.isCalculationProgress=!1})}},t.disabledSubmitButton=function(){return t.root.isSubmitButtonDisabled=!h()||!!t.params.isCalculationProgress,t.root.isSubmitButtonDisabled},t.addressIsValid=function(e){return e.city&&e.house&&e.street},t.getYearRange=function(e,t){var i,a,r=new Date;return e=e||0,t=void 0===t?90:t,a=r.getFullYear()-t,i=r.getFullYear()-e,a+":"+i},function(){var i=["insuranceDuration","driversCountOsagoFull","driversCountOsagoSimple","ownerRegistration"];e.forEach(i,function(i){t.dicts[i]=n.getItems(i).then(function(t){return t=t.results?t.results:t,j[i]=e.copy(t),t})}),t.dicts.trueFalse=[{title:"Да",id:!0},{title:"Нет",id:!1}],t.dicts.isLegalEntity=[{title:"Физическое лицо",id:!1},{title:"Юридическое лицо",id:!0}],t.dicts.insuranceDuration=t.dicts.insuranceDuration.then(function(e){return _.filter(e,function(e){return"1 год"===e.title})})}(),t.driversCountChanged=function(){var e=t.drivers.length,i=t.params.drivers_count_full;if(t.calculation.is_multidrive=!i,i&&"0"!==i?(t.persons.length=0,t.osagoParams.vin_is_visible=!1,t.osagoParams.vin_number=""):(t.persons.length=0,f(),t.osagoParams.vin_is_visible=!0),i>e)for(var a=0;i-e>a;a++)v();else t.drivers.length=+i},t.driversCountChangedSimple=function(){var a=t.calculation.driver_set.length,r=t.params.drivers_count;if(t.params.field_was_clicked){if(r>a)for(var n=0;r-a>n;n++)t.calculation.driver_set.push(e.copy(i.defaultCalcDriver));else t.calculation.driver_set.length=+r;t.calculation.is_multidrive=!t.calculation.driver_set.length}},t.driversDateChanged=function(e){var t=new Date(e.birth_date),i=new Date(e.driving_experience_started),a=(new Date).setFullYear((new Date).getFullYear()-77),r=i<a,n=5679936e5;t.setDate(t.getDate()+1),e.dateIsInvalid=i-t<n||r},t.disabledFormationPolicyButton=function(){var e,i;if(i=["created_at","id","deductible_value","drivers_count","is_new_car"],D){D.car_cost=parseInt(D.car_cost,10)+"",t.calculation.car_cost=parseInt(t.calculation.car_cost,10)+"";for(e in t.calculation)if(t.calculation.hasOwnProperty(e)&&i.indexOf(e)===-1&&!b(t.calculation[e],D[e]))return t.root.isFormationPolicyButtonDisabled=!0,!0}return t.root.isFormationPolicyButtonDisabled=!1,!1},t.resetPerson=function(e){o.resetPerson(e)}}])}(angular,jQueryApp),function(e,t){"use strict";e.module("calculatorO").service("calculatorService",["$http","$q","CONSTS","$rootScope","resources","calculator","$filter","requester",function(i,a,r,n,s,l,o,c){function d(e){var i=t(".ui-datepicker-year").val();return(e=new Date(e))?(e.setFullYear(i),o("date")(e,"yyyy-MM-dd")):""}var u=l.getDefaults(),p=function(e){return e=e||new Date,o("date")(e,"yyyy-MM-dd")},m={full_year:null,field_was_clicked:!1,drivers_count:1,drivers_count_full:1,signalization_type:"",show_empty_fields:!1,resultsAreCreated:!1};this.parseResult=function(e){return e.company_logo="http://enter.b2bpolis.ru/"+e.insurance_company.logo,e},this.currentResult=null,this.getOtherCompanies=function(){return[{id:41243,title:"Росгосстрах",insurance_company:{logo:"media/logo_main_ins/Logo_24.png"}},{id:41465,title:"Ренессанс",insurance_company:{logo:"media/logo_main_ins/Logo_47.png"}}]},this.calculation=e.copy(u),this.companiesInProgress=[],this.getDefaultCalculation=function(){return u},this.selectedResult=null,this.setSelectedResult=function(e){this.selectedResult=e},this.getSelectedResult=function(){return this.selectedResult},this.calculationFormIsValid=_.noop,this._promises={},this.getPromises=function(){return this._promises},this.calculatorOtherParams=e.copy(m),this.resetCalculation=function(t){var i=e.copy(this.getDefaultCalculation());this.companiesInProgress.length=0,t=t||n.calcType;for(var a in this.calculation)this.calculation.hasOwnProperty(a)&&delete this.calculation[a];for(var r in i)i.hasOwnProperty(r)&&(this.calculation[r]=i[r]);for(var s in this.calculatorOtherParams)this.calculatorOtherParams.hasOwnProperty(s)&&(this.calculatorOtherParams[s]=m[s]);return this["to_defaults_"+t]&&this["to_defaults_"+t](),this},this.to_defaults_osago=function(){var t=new Date;t.setDate(t.getDate()+1),this.calculation.insurance_duration=82,this.calculation.driver_set=[e.copy(this.defaultCalcDriver)],this.calculation.car_type=1,this.calculation.drivers_count=1,this.calculation.calculation_at_date=p(t)},this.defaultCalcDriver={is_married:!1,gender:"M",expirience:null,age:null,has_children:!1},this.createCalculation=function(t){return t=t||this.calculation,this.companiesInProgress.length=0,t=this.correctCalculation(t),delete t.token,c.post(s.calculation+"?token",t).then(function(t){var i,a=t.data,r=["optional_equipment"];this.calculationToken=a.token,this.companiesInProgress=a.available_insurance_departments,delete a.available_insurance_departments;for(i in a)a.hasOwnProperty(i)&&r.indexOf(i)===-1&&(e.equals(this.calculation[i],a[i])||(this.calculation[i]=a[i]));return t.data}.bind(this))},this.getCalculation=function(e){return e=e||this.calculation.id,e==this.calculation.id?a.when(this.calculation):(this._promises.getCalculation=c.get(s.calculation+e+"/").then(function(e){var t;e=e.data;for(t in e)"user"!==t&&(this.calculation[t]=e[t]);return this.calculation}.bind(this)),this._promises.getCalculation)},this.getResult=function(e){return e=e||this.calculation.id,c.get(s.calculationV3+e+"/result/?insurance_company=1&messages=1&variables=1").then(function(e){return this.companiesInProgress=e.data,this.currentResult=e.data,e.data}.bind(this))},
this.createResult=function(e,t){var a=this.calculationToken;return t=t||this.calculation.id,i({url:"http://enter.b2bpolis.ru"+s.calculationV3+t+"/result/"+e+"/?insurance_company=1&messages=1&variables=1",method:"POST",headers:{"X-Calculation-Token":a}}).then(function(e){return this.companiesInProgress=e.data,this.currentResult=e.data,e.data}.bind(this))},this.getCredentialList=function(e){return i.get(r.urlPrefixDefault+"client/natural-person/"+e+"/credential").then(function(e){return e.data})},this.getAddressList=function(e){return i.get(r.urlPrefixDefault+"client/natural-person/"+e+"/address").then(function(e){return e.data})},this.correctCalculation=function(e){return e=e||this.calculation},this.personDateChanged=function(e,t,i){t=t||"birth_date",t.indexOf(".")!==-1?(t=t.split("."),e[t[0]][t[1]]=d(e[t])):e[t]=d(e[t])},this.validateDrivers=function(){var e,t,i=this.calculation.driver_set.length;if(this.calculation.is_multidrive,0===i)return!0;for(e=0;e<i;e++)if(t=this.calculation.driver_set[e],t.age-t.expirience<17)return!1;return!0}}])}(angular,jQueryApp),function(e){e.module("formationPolicy",[])}(angular),function(e){"use strict";e.module("formationPolicy").service("formationPolicyService",["$http","CONSTS","$q","$rootScope","$filter","resources","requester",function(t,i,a,r,n,s,l){function o(){return null}function c(e){return e=e||new Date,n("date")(e,"yyyy-MM-dd")}function d(e){var t;return t="legal_person"===e.personType?["title","title_eng","id","inn","ogrn","kpp","representative_first_name","representative_last_name","representative_patronymic","representative_post","representative_credential_type","representative_number","representative_issue_date"]:["id","first_name","last_name","patronymic","first_name_eng","last_name_eng","patronymic_eng","birth_date","gender","driving_experience_started","is_individual_entrepreneur","is_foreigner"],_.pick(e,t)}var u={object:{credential:[{issue_date:"2016-02-04",creator:10585,series:"3456",number:"45",object_id:1751,issue_point:"",credential_type:10,content_type:480,expiration_date:null,external_id:"9374",id:5449}],keys_count:2,manufacturing_date:"2015-01-01",engine_power:"200.00",car_modification:null,creator:10585,car_model:7687,engine_displacement:"2.00",car_body_number:null,mileage:null,number_plate:"",car_mark:303,vin_number:"55TTEEE5E5R5R6TT7",external_id:"7628",id:1751,cost:null},object_type:"car",person:[]},p=null,m=null,g={clear:function(){m=null},resetCurrentPolicy:function(){p=null},updateCustomer:function(e){var i=a.defer(),r=o();return this.getCustomer(r).then(function(a){a.natural_persons=a.natural_persons.concat(e.natural_persons),a.natural_persons=_.uniq(a.natural_persons),t.put(s.customer+"/"+r,a).then(function(e){i.resolve(e.data)},function(e){i.reject(e)})},function(e){i.reject(e)}),i.promise},getCustomer:function(e){return e=e||o(),t.get(s.customer+"/"+e).then(function(e){return e.data})},getCustomerCars:function(e){return e=e||o(),t.get(s.customerCar,{params:{owner:e}}).then(function(e){return e.data})},getCarCredential:function(e){return t.get(s.customerCar+"/"+e+"/credential").then(function(e){return e.data})},getCustomerFull:function(e){var i=a.defer();return this.getCustomer(e).then(function(e){t.get(s.person+"/"+e.person).then(function(a){var r=a.data,n="naturalPerson",l=r.natural_person;r.legal_person&&(n="legalPerson",l=r.legal_person),t.get(s[n]+"/"+l).then(function(t){var a=t.data;i.resolve({person:a,drivers:e.natural_persons})},function(e){i.reject(e)})},function(e){i.reject(e)})},function(e){i.reject(e)}),i.promise},saveCar:function(i){var r=o(),n=a.defer(),l=_.pick(i,["id","mileage","car_mark","car_model","car_modification","owner","manufacturing_date","vin_number","number_plate","engine_displacement","engine_power","cost","keys_count"]),c="post",d=s.customerCar;return l.owner=l.owner||r,l.id&&(c="put",d+="/"+l.id),t[c](d,l).then(function(r){var l=r.data,o=_.map(i.credential,function(e){return _.pick(e,["id","number","series","credential_type","issue_date","issue_point","expiration_date"])}),c=[];e.forEach(o,function(e){var i="post",a=s.customerCar+"/"+l.id+"/credential";e.id&&(i="put",a+="/"+e.id),c.push(t[i](a,e).then(function(e){return e.data}))}),a.all(c).then(function(e){n.resolve({car:l,credential:e})},function(e){n.reject(e)})},function(e){n.reject(e)}),n.promise},createDeal:function(i){var r=a.defer();return t.post(s.deal,e.extend({deal_status:1,customer:o()},i)).then(function(e){var a=e.data;a.car=i.car,t.put(s.deal+"/"+a.id,a).then(function(e){r.resolve(e.data)},function(e){r.reject(e)})},function(e){r.reject(e)}),r.promise},getDeal:function(e){return t.get(s.deal+"/"+e)},createInsuranceProduct:function(e,i){return t.post(s.deal+"/"+e+"/insurance-product/from-calculation",i).then(function(e){return e.data})},updateInsuranceProduct:function(e,i,a){return t.put(s.deal+"/"+e+"/insurance-product/"+i,a).then(function(e){return e.data})},createInvoice:function(e,i){return t.post(s.deal+"/"+e+"/insurance-product/"+i+"/invoice/generate").then(function(e){return e.data})},createPersonContainer:function(e,i){var a={};return i="legal_person"===i?"legal_person":"natural_person",a[i]=e,t.post(s.person,a).then(function(e){return e.data})},saveBSO:function(e,i){return t.post(s.resultPolicy+"/"+e+"/enter_bso/",i).then(function(e){return e.data})},createInsuredObjectByIds:function(e){return t.post("/rest/default/client/insured-object",e).then(function(e){return e.data})},createInsuredObjectOsago:function(t){var i={object:{car_mark:t.car.car_mark,car_model:t.car.car_model,car_model_group:t.car.car_model_group||null,car_modification:t.car.car_modification||null,cost:+t.car.cost,engine_displacement:t.car.engine_displacement,engine_power:t.car.engine_power,credential:t.car.credential,external_id:t.car.id||this.generateId(),vin_number:t.car.vin_number,number_plate:t.car.number_plate,manufacturing_date:t.car.manufacturing_date,keys_count:t.car.keys_count,mileage:t.car.mileage,car_body_number:t.car.car_body_number,engine_power_kilowatt:t.car.engine_power_kilowatt,chassis_number:t.car.chassis_number},object_type:"car",person:[],drivers:[]};return e.forEach(i.object.credential,function(e){e.external_id=e.id||this.generateId()},this),e.forEach(t.persons,function(t,a){var r,n,s={},l=[],o=t.id||this.generateId(),u=t.address_registration?[t.address_registration]:[],p=d(t),m=t.personType;u&&u.lendth&&(u[0].address_type=1),"natural_person"===m?(n=t.credential,e.forEach(n,function(e){e&&(e.issue_date=c(e.issue_date),e.external_id=e.id||this.generateId())},this),!t.is_same_address&&t.address_residential&&(u.push(t.address_residential),u[1].content_type=482,u[1].address_type=2),t.birth_date=c(t.birth_date),t.driving_experience_started=c(t.driving_experience_started)):n=null,e.forEach(["owner","insurant"],function(e){var i="is"+e[0].toUpperCase()+e.substr(1);t[i]&&l.push(e)}),l.length>0&&(s.role=l,s.external_id=o,s.id=t.person_id,s[m]=p,s[m].external_id=o,s[m].credential=n,s[m].address=u,i.person.push(s)),t.isDriver&&(r=e.copy(p),r.external_id=o,r.credential=[],r.credential.push(_.find(n,function(e){return 3===e.credential_type})),r.credential.push(_.find(n,function(e){return 1===e.credential_type})),r.credential[1]||(r.credential.length=1),i.drivers.push(r))},this),l.post(s.insuredObjectOsago,i).then(function(t){return m=e.copy(t.data),t.data})},sendPhone:function(e){return t.post("/policy/rest/result_policy/"+e.policy_id+"/token",_.pick(e,"phone")).then(function(e){return e.data})},confirmPhone:function(e){return t.post("/policy/rest/result_policy/"+e.policy_id+"/token-verified",_.pick(e,"token")).then(function(e){return e.data})},toPay:function(e){return t.post("/payment/"+e+"/ ").then(function(e){return e.data})},createInsuredObject:function(t){var i,a;return t.car?(i={object:{car_mark:t.car.car_mark,car_model:t.car.car_model,car_model_group:t.car.car_model_group||null,car_modification:t.car.car_modification||null,cost:t.car.cost,engine_displacement:t.car.engine_displacement,engine_power:t.car.engine_power,credential:t.car.credential,external_id:t.car.id||this.generateId(),vin_number:t.car.vin_number,number_plate:t.car.number_plate,manufacturing_date:t.car.manufacturing_date,keys_count:t.car.keys_count,mileage:t.car.mileage,is_new_car:t.car.is_new_car,is_temporary:t.car.is_temporary,chassis_number:t.car.chassis_number},object_type:"car",person:[],drivers:[]},a=["owner","insurant","beneficiary"],e.forEach(i.object.credential,function(e){e.external_id=e.id||this.generateId()},this)):(i=u,a=["owner","insurant"]),e.forEach(t.persons,function(t,r){var n,s,l={},o=[],u=t.id||this.generateId(),p=[t.address_registration],m=_.filter(t.contact,function(e){return e.data}),g=d(t),v=t.personType;"legal_person"===v?s=null:(s=t.credential,e.forEach(s,function(e){e.issue_date=c(e.issue_date),e.external_id=e.id||this.generateId()},this),t.is_same_address||p.push(t.address_residential),t.is_temporary_registration&&p.push(t.address_temporary_registration),t.birth_date=c(new Date(t.birth_date)),t.driving_experience_started=t.driving_experience_started?c(new Date(t.driving_experience_started)):null),e.forEach(a,function(e){var i="is"+e[0].toUpperCase()+e.substr(1);t[i]&&o.push(e)}),e.forEach(p,function(e){e&&!e.country&&(e.country="Россия")}),o.length>0&&(l.role=o,l.external_id=u,l.id=t.person_id,l[v]=g,l[v].external_id=u,l[v].contact=m,l[v].credential=s,l[v].address=p,i.person.push(l)),t.isDriver&&(n=e.copy(g),n.external_id=u,n.address=p,n.credential=_.filter(s,function(e){return 3===e.credential_type}),i.drivers.push(n))},this),l.post(s.insuredObject,i).then(function(t){return m=e.copy(t.data),t.data})},getInsuredObject:function(t){return l.get(s.insuredObject+"/"+t).then(function(t){return m=e.copy(t.data),t.data})},getInsuredObjectOsago:function(t){return l.get(s.insuredObjectOsago+"/"+t).then(function(t){return m=e.copy(t.data),t.data})},getPolicyFile:function(e,i){return i=i?"?type="+i:"",t({method:"GET",url:s.resultPolicy+e+"/template/"+i,headers:{}}).then(function(e){return e.data})},createInsuredObjectCRM:function(e){return t.post(s.insuredObjectCRM,e).then(function(e){return e.data})},createPolicy:function(i){return t.post(s.resultPolicy,e.extend({external_id:o()},i)).then(function(e){return p=e.data})},savePolicy:function(i){var a="post",r=s.resultPolicy;return i.id&&(a="put",r=s.resultPolicy+i.id+"/"),t[a](r,e.extend({external_id:o()},i)).then(function(e){return p=e.data})},getPolicy:function(e){return t.get(s.resultPolicy+e+"/",{params:{external_id:o()}}).then(function(e){return p=e.data})},getSavedNaturalPersons:function(e){return t.get(s.savedNaturalPersons,{params:e}).then(function(e){return e.data})},getSavedLegalPersons:function(e){return t.get(s.savedLegalPersons,{params:e}).then(function(e){return e.data})},getSavedCars:function(e){return t.get(s.savedCars,{params:e}).then(function(e){return e.data})},getInsObjList:function(e){return t.get(s.insuredObectList,{params:e}).then(function(e){return console.log(e),e.data})},getCurrentPolicy:function(){return p},getCurrentInsuredObject:function(){return m},sendNotification:function(e){return t.post(s.notificationSend,e).then(function(e){return e.data})},generateId:function(){return~~(9900*Math.random()+100)},getPolicyActionsParameters:function(e){return t.get(s.resultPolicy+e+"/actions_parameters/",{params:{external_id:o()}}).then(function(e){return e.data})},executePolicyAction:function(e,a,r){return t.post(i.urlPrefixPolicy+"result_policy/"+e+"/"+a+"/",r).then(function(e){return e.data})},getPolicyDocsArchive:function(e){return t.get(i.urlPrefixPolicy+"result_policy/"+e+"/zip/").then(function(e){return e.data})},getPolicyAttachments:function(e){return t.get(s.resultPolicy+e+"/attachment/").then(function(e){return e.data})},deletePolicyAttachment:function(e,i){return t.delete(s.resultPolicy+e+"/attachment/"+i).then(function(e){return e.data})},issueToSavedPolicy:function(e){return t.post(s.resultPolicy+e+"/issue_to_saved_policy/").then(function(e){return e})},setPersonValidationDates:function(e){e.isDriver?(e.birthDateRange={min:function(){var t=new Date;return t.setFullYear(t.getFullYear()-e.age-1),c(t)}(),max:function(){var t=new Date;return t.setFullYear(t.getFullYear()-e.age),c(t)}()},e.expirienceRange={min:function(){var t=new Date;return t.setFullYear(t.getFullYear()-e.expirience-1),c(t)}(),max:function(){var t=new Date;return t.setFullYear(t.getFullYear()-e.expirience),c(t)}()}):(e.birthDateRange={min:function(){var e=new Date;return e.setFullYear(e.getFullYear()-90),c(e)}(),max:function(){var e=new Date;return e.setFullYear(e.getFullYear()-18),c(e)}()},e.expirienceRange={min:function(){var e=new Date;return e.setFullYear(e.getFullYear()-72),c(e)}(),max:function(){return c(new Date)}()}),e.birthDateRange.yearRange=new Date(e.birthDateRange.min).getFullYear()+":"+new Date(e.birthDateRange.max).getFullYear(),e.expirienceRange.yearRange=new Date(e.expirienceRange.min).getFullYear()+":"+new Date(e.expirienceRange.max).getFullYear(),e.dateChanged=function(t,i){var a=new Date(t).getFullYear(),r=new Date(i).getFullYear();e.invalidDates=a-r>=18}}};return g}])}(angular),function(e,t){"use strict";e.module("formationPolicy").service("formationPolicyStep1Service",["$filter","$rootScope","formationPolicyService","Person","calculatorService","$q",function(t,i,a,r,n,s){function l(){return C=e.copy(A)}function o(t,i){i=i||C;var a=_.filter(t,function(e){return e.credential_type===M.credential_type}),r=_.filter(t,function(e){return e.credential_type===O.credential_type});i.vehicle_registration=_.maxBy(a,function(e){return e.id})||e.copy(M),i.vehicle_certificate=_.maxBy(r,function(e){return e.id})||e.copy(O)}function c(t){if(_.head(t.credential)&&"natural_person"===t.personType){var i=_.filter(t.credential,function(e){return e.credential_type==j.credential_type}),a=_.filter(t.credential,function(e){return e.credential_type==T.credential_type});t.driver_license=_.maxBy(i,function(e){return e.id}),t.passport=_.maxBy(a,function(e){return e.id})||e.copy(T)}return t}function d(t){return e.isArray(t.contact)&&t.contact.length>0&&(t.contact=_.sortBy(_.uniqBy(t.contact,function(e){return e.contact_type}),function(e){return e.contact_type})),t}function u(e){var t=new Date,i=new Date(e);if(i.getTime())return new Date(t-i).getFullYear()-1970}function p(e){e.full=e.city+", "+e.street+", д."+e.house}function m(t){if(e.isArray(t.address)&&t.address.length>0){var i=_.filter(t.address,function(e){return 1===e.address_type});i=_.maxBy(i,function(e){return e.id});var a=_.filter(t.address,function(e){return 2===e.address_type});a=_.maxBy(a,function(e){return e.id});var r=_.filter(t.address,function(e){return 3===e.address_type});r=_.maxBy(r,function(e){return e.id}),t.is_same_address=!a,t.is_temporary_registration=Boolean(r),i&&(t.address_registration=i,p(i)),a&&(t.address_residential=a,p(a)),r&&(t.address_temporary_registration=r,p(r))}return t}function g(e,t){return t=t||i.calcType,E[t](e,C)}function v(e){return e=e||i.calcType,B[e]()}function f(e,t,a,r){return r=r||i.calcType,R[r](e,t,a)}function h(e,t){return t=t||i.calcType,N[t](e,t)}function b(e){return V.allTypes(e)}function y(e){return e=e||i.calcType,q[e]()}function w(e){return U.allTypes(e)}function x(){P.length=0,l()}function k(e){return e=e||i.calcType,Y[e](e)}var C,P=[],S=n.calculation,I="yyyy-MM-dd",D=function(e){return t("date")(e,I)},$={address_type:1,postal_index:null,content_type:482,country:"Россия",city:"",street:"",house:"",housing:"",flat:"",kladr:""},T={credential_type:1,series:"",number:"",issue_date:"",issue_point:"",expiration_date:""},j={credential_type:3,series:"",number:"",issue_date:"",issue_point:"РФ",expiration_date:""},M={credential_type:4,series:"",number:"",issue_date:"",issue_point:"",expiration_date:""},O={credential_type:7,series:"",number:"",issue_date:"",issue_point:"",expiration_date:""},F={is_same_address:!0,person_type:"natural_person",credential:[],isOwner:!1,isDriver:!1,isInsurant:!1,first_name:"",last_name:"",patronymic:"",gender:null,birth_date:"",passport:e.copy(T),address_registration:e.copy($),address_residential:e.extend(e.copy($),{address_type:2})},A={car_mark:null,car_model:null,car_modification:null,cost:0,vin_number:"",chassis_number:"",number_plate:"",engine_displacement:"",engine_power:"",engine_power_kilowatt:"",keys_count:S.driver_set.length||1,mileage:"",manufacturing_date:null,selectedCar:"",vehicle_registration:e.copy(M),vehicle_certificate:e.copy(O),document_issue_date:"",mode:"edit"};l();var R={osago:function(t,i,n){var s,l=new Date,o=18,c=new r(e.extend(e.copy(F),{personType:i||"natural_person",isOwner:!1,isInsurant:!1,isDriver:!1,selectedPerson:"",mode:"edit"}));return t=t||{},"legal_person"===i?(c.extend({title:"",isDriver:!1,inn:"",ogrn:""}),c.address_registration=c.addAddress(e.copy($))):(s=t.expirience||0===t.expirience?t.expirience:null,null===s&&(s=u(t.driving_experience_started)),c.extend({age:t.age||o,expirience:s,gender:"M",birth_date:t.birth_date||"",is_same_address:!0,is_temporary_registration:!1,driving_experience_started:t.driving_experience_started||""}),c.passport=c.addCredential(e.copy(T)),c.driver_license=c.addCredential(e.copy(j)),c.address_registration=c.addAddress(e.copy($)),c.address_residential=c.addAddress(e.copy($)),c.address_temporary_registration=c.addAddress(e.copy($)),c.driving_experience_started||(l=new Date,l.setFullYear(l.getFullYear()-c.expirience),c.driver_license.issue_date=D(l),c.driving_experience_started=D(l))),c.extend(t),a.setPersonValidationDates(c),c.hasRole=function(){return c.isInsurant||c.isOwner},n||P.push(c),c}},B={osago:function(){function t(){return S.id||(S.insured_object=11920),S.insured_object?a.getInsuredObject(S.insured_object):s.when({})}return t().then(function(t){t&&t.id?g(t):_.forEach(S.driver_set,function(t){var i={isDriver:!0,showFioFields:!0};f(e.extend(i,t))}),e.extend(C,{car_mark:S.car_mark,car_model:S.car_model,car_modification:S.car_modification,cost:Math.floor(S.car_cost),car_body_number:"",vin_number:null,number_plate:"",engine_displacement:null,engine_power:S.engine_power,mileage:null,manufacturing_date:S.car_manufacturing_year+"-01-01",vehicle_registration:e.copy(M),vehicle_certificate:e.copy(O),credential:[]}),e.extend(C,t.object),C.id=null;var a=_.head(P);if(S.is_legal_entity&&"false"!==S.is_legal_entity&&(a.address_registration=e.copy($)),S.is_legal_entity&&i.currentUser){a.isInsurant=!1;var r=f({isInsurant:!0,isOwner:!1,isDriver:!1,title:i.currentUser.last_name,inn:i.currentUser.inn,ogrn:i.currentUser.ogrn},"legal_person");i.currentUser.address&&(e.extend(r.address_registration,i.currentUser.address),p(r.address_registration))}else a&&i.currentUser&&i.currentUser.id&&(a.passport&&!a.passport.series&&(a.passport.series=i.currentUser.passport_series,a.passport.number=i.currentUser.passport_number),a.address_registration&&!a.address_registration.city&&i.currentUser.address&&(e.extend(a.address_registration,i.currentUser.address),p(a.address_registration))),a.isInsurant=!0;a.isOwner=!0})}},E={osago:function(i){var a;P.length=0,C=i.object,o(C.credential),C.engine_power_kilowatt=+(.7355*S.engine_power).toFixed(2),C.engine_power=S.engine_power,_.forEach(i.person,function(e){var i=e.natural_person?"natural_person":"legal_person";e[i].personType=i,e[i].person=e.id,c(e[i]),m(e[i]),e[i].selectedPerson=e[i].external_id,"natural_person"===i&&(e[i].age=t("calcAge")(e[i].birth_date)),e.role.length&&_.forEach(e.role,function(t){e[i]["is"+t[0].toUpperCase()+t.substr(1)]=!0}),f(e[i])}),a=_.forEach(i.drivers,function(e){e.personType="natural_person",e.isDriver=!0,c(e),m(e)}),_.forEach(a,function(t){var i;_.forEach(P,function(a,r){t.external_id===a.external_id&&(i=!0,e.extend(a,t),a.isDriver=!0)}),t.driver_license=_.find(t.credential,function(e){return 3===e.credential_type})||e.copy(j),i||f(t)})}},N={osago:function(e){var t=P.indexOf(e),i=t-1>=0?t-1:t+1;e.isOwner&&(P[i].isOwner=!0),e.isInsurant&&(P[i].isInsurant=!0),t!==-1&&P.splice(t,1)}},q={osago:function(){e.forEach(P,function(e){e.address=[],e.credential=[],e.birth_date=D(e.birth_date),"natural_person"===e.personType&&((e.isInsurant||e.isOwner)&&(e.passport.credential_type=1,e.credential.push(e.passport)),e.isDriver&&(e.driver_license&&e.credential.push(e.driver_license),e.driving_experience_started=D(e.driving_experience_started)))});var t=_.find(P,function(e){return e.isOwner}),i=_.find(P,function(e){return e.isInsurant}),r=_.map(_.filter(P,function(e){return e.isDriver}),"id"),n={owner:t.person,beneficiary:t.person,insurant:i.person,drivers:r,object_type:"car",object_id:C.id};return C.credential=[],C.vehicle_registration&&C.credential.push(C.vehicle_registration),C.vehicle_certificate&&C.credential.push(C.vehicle_certificate),a.createInsuredObjectByIds(n)}},U={allTypes:function(t){return function(i){return e.isObject(i)&&(b(t),t.extend(i),t.getCredentialList().then(function(){c(t)}),t.getAddressList().then(function(){m(t)}),t.getContactList().then(function(){d(t)})),!0}}},V={allTypes:function(t){return e.extend(t,{id:null,age:t.selectedPerson?18:t.age,birth_date:"",last_name:"",first_name:"",patronymic:"",last_name_eng:"",first_name_eng:"",patronymic_eng:"",is_same_address:!0,driving_experience_started:"",selectedPerson:"",document:{credential_type:1,series:"Не указан",number:"",issue_date:""},title:"",title_eng:"",inn:"",ogrn:"",kpp:"",representative_first_name:"",representative_last_name:"",representative_patronymic:"",representative_post:"",representative_credential_type:"",representative_number:"",representative_issue_date:"",rsa_check_id:null,person:null,is_verified:null,is_current_user:!1}),t.pT=t.pT||t.personType,t.passport=t.addCredential(e.copy(T)),t.ogrntip=t.addCredential(e.copy(T)),t.driver_license=t.addCredential(e.copy(j)),t.address_registration=t.addAddress(e.copy($)),t.address_residential=t.addAddress(e.copy($)),t.address_temporary_registration=t.addAddress(e.copy($)),t.contact=[{contact_type:1,data:""},{contact_type:2,data:""}],t.address_registration.country=null,t.address_residential.country=null,t.address_temporary_registration.country=null,t.credential.length=0,t.address.length=0,t.contact.length=0,t}},Y={osago:function(){var e={isInsurant:!1,isOwner:!1,all:!1};return _.forEach(P,function(t){t.isInsurant&&(e.isInsurant=!0),t.isOwner&&(e.isOwner=!0)}),e.all=e.isInsurant&&e.isOwner,e}};return{addPerson:f,resetPerson:b,initFromCalculation:v,initFromInsuredObject:g,removePerson:h,persons:P,getPersons:function(){return P},createInsuredObject:y,resetAll:x,showSavedPersonsCallback:w,resetCar:l,getCar:function(){return C},setCarCredentials:o,getDefaultObject:function(t){var i={defaultAddressObject:$,defaultPassportObject:T,defaultDriverLicenseObject:j,defaultVehicleRegistrationObject:M};return e.copy(i[t])},setPersonCredential:c,setPersonAddress:m,setFullAddress:p,personCheckUsed:k}}])}(angular,jQueryApp),function(e){e.module("AddingDocuments",[])}(angular),function(e){"use strict";e.module("AddingDocuments").service("addingDocumentsService",["$q","CONSTS",function(e,t){function i(){var e;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=!1}}return e||"undefined"==typeof XMLHttpRequest||(e=new XMLHttpRequest),e}this.send=function(a,r){var n,s=e.defer();return n=i(),n.open("POST",t.proxyPath+"mail.php",!0),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?s.resolve(n.responseText):s.reject(r(n.responseText)))},n.send(a),s.promise},this.uploader=null}])}(angular),function(e){"use strict";e.module("AddingDocuments").controller("AddingDocumentsCtrl",["$scope","FileUploader","CONSTS","addingDocumentsService",function(e,t,i,a){e.typeInput="personalData",e.isSaveDataProgress=!1,e.uploader=a.uploader||new t({url:"/some_url",formData:[{attachment_type:1,description:""}]}),a.uploader=e.uploader,e.confirmationList={},e.addingDocumentsTemplates={uploader:i.pathToModules+"osago/AddingDocuments/views/adding_documents.uploader.html",form:i.pathToModules+"osago/personalData/views/personal_data.html",currentTemplate:"uploader",selectTemplate:function(t){e.addingDocumentsTemplates.currentTemplate=t}}}])}(angular),function(e){e.module("branding",[])}(angular),function(e){"use strict";e.module("branding").service("brandingService",["CONSTS","brandingConfigs",function(t,i){var a={},r={};return a[t.currentBrand]=e.extend(r,i),a}])}(angular),function(e){"use strict";e.module("personalData",[])}(angular),function(e){"use strict";e.module("personalData").controller("personalDataCtrl",["$scope","CONSTS","Person","formationPolicyStep1Service","formationPolicyService","$filter","$state",function(t,i,a,r,n,s,l){function o(e){return s("date")(e,"dd.MM.yyyy")}function c(e,t){var i="";return e.city&&(i+=t+": ",i+=e.city+" "+e.street+" д."+e.house+" ",e.housing&&(i+="Корпус "+e.housing+" "),e.flat&&(i+="Кв./офис "+e.flat+" "),i+="\n"),i}t.params={person_type:null,number_type:"vin_number",car_document_type:"vehicle_registration"},t.persons=r.persons,t.car=r.getCar(),r.initFromCalculation(),t.addressIsValid=function(e){return e.city&&e.house&&e.street},t.savePersonalData=function(){var e="";_.forEach(t.persons,function(t,i){e+=i+1+"-й участник договора"+(t.isDriver?" (Водитель): ":": ")+"\n",t.isOwner&&(e+="Собственник. "),t.isInsurant&&(e+="Страхователь. "),e+="\n","legal_person"===t.personType?(t.isOwner||t.isInsurant)&&(e+="Название: "+t.title+" ИНН:"+t.inn+" ОГРН:"+t.ogrn+"\n"):(e+="ФИО: "+t.last_name+" "+t.first_name+" "+(t.patronymic||"")+"\n",e+="Дата рождения: "+o(t.birth_date)+"\n",(t.isInsurant||t.isOwner)&&(e+="Серия и номер паспорта: "+t.passport.series+" "+t.passport.number+"\nДата получения: "+o(t.passport.issue_date)+"\nКем выдан: "+t.passport.issue_point+"\n"),t.isDriver&&(e+="Дата начала стажа: "+o(t.driving_experience_started)+"г.\n",e+="Водительское удостоверение: "+t.driver_license.series+" "+t.driver_license.number+"\n")),(t.isInsurant||t.isOwner)&&(e+=c(t.address_registration,"Адрес регистрации"),t.is_same_address||(e+=c(t.address_residential,"Адрес проживания"))),e+="\n"}),"vin_number"==t.params.number_type&&(e+="VIN-номер: "+t.car.vin_number+"\n"),"car_body_number"==t.params.number_type&&(e+="Номер кузова: "+t.car.car_body_number+"\n"),"chassis_number"==t.params.number_type&&(e+="Номер шасси: "+t.car.chassis_number+"\n"),e+="Гос. рег. знак: "+t.car.number_plate+"\n",e+="Пробег: "+t.car.mileage+"\n",e+="Мощность в кВт: "+t.car.engine_power_kilowatt+"\n","vehicle_registration"==t.params.car_document_type&&(e+="СТС серия:"+t.car.vehicle_registration.series+"номер: "+t.car.vehicle_registration.number+"\n"),"vehicle_registration"==t.params.car_document_type&&(e+="ПТС серия:"+t.car.vehicle_certificate.series+"номер: "+t.car.vehicle_certificate.number+"\n"),e+="Дата получения: "+o(t.car.document_issue_date)+"г.\n",e+="Объем двигателя: "+t.car.engine_displacement+"\n",n.personalData=e,console.log(n.personalData),l.go("index.ordering")},t.setPersonAs=function(i,a){i[a]=!0,"isOwner"===a&&(i.isBeneficiary=!0),e.forEach(t.persons,function(e){i.$$hashKey!==e.$$hashKey&&(e[a]=!1,i.isBeneficiary=!1)})},t.setPersonType=function(e,i){e[i]?t.setPersonAs(e,i):e[i]=!1},t.addPerson=function(e,i){i=i||"natural_person",t.params.person_type=null,r.addPerson(e,i)},t.removePerson=function(e){r.removePerson(e)},t.insurantTypes=[{id:"natural_person",title:"Физическое лицо"},{id:"legal_person",title:"Юридическое лицо"}],t.allDriversAreChanged=function(){var e=_.filter(t.persons,function(e){return e.isDriver});return e&&e.length===t.calculation.driver_set.length},t.personCheckUsed=r.personCheckUsed,t.getYearRange=function(e,t){var i,a,r=new Date;return e=e||0,t=void 0===t?90:t,a=r.getFullYear()-t,i=r.getFullYear()-e,a+":"+i},t.templates={persons:i.pathToModules+"osago/personalData/views/personal_data.form.persons.html",person_block:i.pathToModules+"osago/personalData/views/personal_data.form.person_block.html",person_block_legal:i.pathToModules+"osago/personalData/views/personal_data.form.person_block_legal.html",addresses_block:i.pathToModules+"osago/personalData/views/personal_data.addresses_block.html",address_registration:i.pathToModules+"osago/personalData/views/personal_data.address_registration.html",address_residential:i.pathToModules+"osago/personalData/views/personal_data.address_residential.html",person_roles:i.pathToModules+"osago/personalData/views/personal_data.form.person_roles.html",car:i.pathToModules+"osago/personalData/views/personal_data.form.car.html"}}])}(angular),function(e){e.module("calculatorStepsO",[])}(angular),function(e){e.module("utils",[])}(angular),function(e){"use strict";e.module("utils").directive("compile",["$compile",function(e){return function(t,i,a){t.$watch(function(e){return e.$eval(a.compile)},function(a){i.html(a),e(i.contents())(t)})}}])}(angular),function(e,t){"use strict";e.module("utils").directive("focusing",[function(){return{restrict:"A",link:function(e,i,a,r){function n(e){return e=e||c,e.find(".field input").filter(":visible")}function s(e){var i,a,r=n(),s=t(e.target);s.hasClass("ng-invalid")||13===e.keyCode&&(i=r.eq(r.index(e.target)+1),i.length?i.focus():(a=t("."+(+d+1)+"-is-focusing"),a.length?n(a).eq(0).focus():t("#id-after-focusing").focus()))}var l,o,c=t(i),d=_.uniqueId();c.addClass("is-focusing "+d+"-is-focusing"),setTimeout(function(){l=n(),o=l.filter(".focusing-first"),o.length?o.eq(0).focus():l.eq(1).focus(),l.on("keypress",s)},300)}}}])}(angular,jQueryApp),function(e){"use strict";e.module("utils").directive("ngMax",[function(){function t(t){return e.isUndefined(t)||""===t||null===t||t!==t}return{restrict:"A",require:"ngModel",link:function(e,i,a,r){var n=function(e){var i=a.ngMax||0;return!t(e)&&e>i?void r.$setValidity(a.name,!1):(r.$setValidity(a.name,!0),e)};r.$parsers.push(n),r.$formatters.push(n),e.$watch(function(){return a.ngMax},function(e,t){e!==t&&n(r.$viewValue)})}}}])}(angular),function(e){"use strict";e.module("utils").directive("ngMin",[function(){function t(t){return e.isUndefined(t)||""===t||null===t||t!==t}return{restrict:"A",require:"ngModel",link:function(e,i,a,r){var n=function(e){var i=a.ngMin||0;return!t(e)&&e<i?void r.$setValidity(a.name,!1):(r.$setValidity(a.name,!0),e)};r.$parsers.push(n),r.$formatters.push(n),e.$watch(function(){return a.ngMin},function(e,t){e!==t&&n(r.$viewValue)})}}}])}(angular),function(e){"use strict";e.module("utils").directive("noEmpty",[function(){function t(t){return e.isUndefined(t)||""===t||null===t||t!==t||"0"===t||0===t}return{restrict:"A",require:"ngModel",link:function(e,i,a,r){var n=function(e){return t(e)?(r.$setValidity(a.name,!1),e):(r.$setValidity(a.name,!0),e)};r.$parsers.push(n),r.$formatters.push(n)}}}])}(angular),function(e,t){"use strict";e.module("utils").directive("scrollTo",[function(){return{restrict:"A",link:function(e,i,a){function r(){setTimeout(function(){n=l.offset(),s=n&&n.top||0,t("html,body").animate({scrollTop:s},"fast")},o)}var n,s,l=t(i),o=a.scrollTo?+a.scrollTo:500;l.addClass("js-scroll-to"),r()}}}])}(angular,jQueryApp),function(e){"use strict";e.module("utils").filter("boolFormatter",[function(){return function(e){return e?"да":"нет"}}])}(angular),function(e){"use strict";e.module("utils").filter("calcAge",[function(){return function(e){var t=+new Date(e);return~~((Date.now()-t)/315576e5)}}])}(angular),function(e){"use strict";e.module("utils").filter("dateExpired",[function(){return function(t,i){var a=new Date(t);return!(e.isDate(a)&&!isNaN(a.getTime()))||!!i&&Math.abs((new Date-a)/864e5)>i}}])}(angular),function(e){"use strict";e.module("utils").filter("fioFormatter",[function(){return function(t,i){var a="";return e.isObject(t)?void 0!==t.last_name&&void 0!==t.first_name?(a=(t.last_name||"")+" "+(t.first_name||""),"full"===i&&t.patronymic&&(a+=" "+t.patronymic),a):void 0!==t.title?(a=t.title,"full"===i&&t.full_title&&(a=t.full_title),a):"":t}}])}(angular),function(e){e.module("utils").filter("fractionalFormatter",[function(){return function(e,t){var i,a=parseFloat(e);if(isNaN(a))return"";for(i=a%1,
t&&i&&(i=(i.toFixed(2)+"").substr(2,t)),i+="";i.length<t;)i+="0";return i}}])}(angular),function(e){"use strict";e.module("utils").filter("multiColumn",[function(){var t=[];return function(i,a){var r;if(!a||!e.isArray(i))return i;if(r=_.find(t,function(e){return JSON.stringify(e.items)===JSON.stringify(i)&&JSON.stringify(e.options)===JSON.stringify(a)}))return r.filtered;var n,s=a.columns||null,l=a.rows||null,o=[[]],c=0,d=0;if(!s&&!l)throw new Error("Number of rows or columns must be specified");if(s&&l)throw new Error("Number of rows and columns can not be used simultaneously");s=s>i.length?i.length:s,l=l>i.length?i.length:l,n=s?Math.ceil(i.length/s):l;for(var u=0,p=i.length;u<p;u++,c++)c===n&&(d++,c=0,o[d]=[]),o[d].push(i[u]);return t.push({items:i,options:a,filtered:o}),o}}])}(angular),function(e){"use strict";e.module("utils").filter("num",[function(){return function(e){var t=parseInt(e,10);return isNaN(t)?e:t}}])}(angular),function(e){"use strict";e.module("utils").service("requester",["$http","CONSTS",function(t,i){function a(e){return function(a,r){return t({url:i.proxyPathC+"proxy.php",method:e,data:r,headers:{"X-Itform-Forward":a,"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:0},params:{v:Math.floor(1e8*Math.random())}})}}return{get:a("GET"),post:a("POST"),put:a("PUT"),getOriginal:function(i,a){return t({method:"GET",url:i,params:e.extend({v:Math.floor(1e8*Math.random())},a)})}}}])}(angular),function(e){"use strict";e.module("utils").service("transformToFormData",function(){function e(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")}return e})}(angular),function(e){e.module("dictionary",[])}(angular),function(e){"use strict";e.module("dictionary").directive("dictionary",["Dictionary","$parse",function(t,i){return{template:"{{foundResult}}",scope:{dictionary:"@",dictionaryId:"=",dictionaryArray:"=",dictionaryProp:"@"},link:function(a){function r(){var r;i(a.dictionaryProp);if(a.foundResult="",e.isString(a.dictionary)&&""!==a.dictionary)t.findItem(a.dictionary,a.dictionaryId,a.dictionaryProp).then(function(e){return a.foundResult=e,a.foundResult});else if(e.isArray(a.dictionaryArray))return r=_.find(a.dictionaryArray,function(e){return e.id==a.dictionaryId}),r&&a.dictionaryProp?(a.foundResult=r[a.dictionaryProp],a.foundResult):(a.foundResult=r,r)}a.$watch("dictionaryId",function(e,t){e!==t&&r()}),a.$watch("dictionaryArray",function(e,t){e!==t&&r()}),r()}}}])}(angular),function(e,t){"use strict";e.module("dictionary").provider("Dictionary",function(){var i={},a=[],r=86400,n=["$q","$filter","requester",function(n,s,l){function o(t,i,a){var r,n,s,l={};if(t.results&&(t=t.results),r=_.find(t,function(e){return i==e.id}),void 0!==r){if(e.isArray(a))for(n=0,s=a.length;n<s;n++)l[a[n]]=r[a[n]];else l=e.isString(a)?r[a]:r;return l}}function c(i,a,r){var n,s,l={defaults:r||{},urlParams:{}},o=i,c=l.urlParams;return e.forEach(o.split(/\W/),function(t){if("hasOwnProperty"===t)throw e.$$minErr("$resource")("badname","hasOwnProperty is not a valid parameter name.");!new RegExp("^\\d+$").test(t)&&t&&new RegExp("(^|[^\\\\]):"+t+"(\\W|$)").test(o)&&(c[t]=!0)}),o=o.replace(/\\:/g,":"),a=a||{},e.forEach(l.urlParams,function(t,i){n=a.hasOwnProperty(i)?a[i]:l.defaults[i],e.isDefined(n)&&null!==n?(s=d(n),o=o.replace(new RegExp(":"+i+"(\\W|$)","g"),function(e,t){return s+t})):o=o.replace(new RegExp("(/?):"+i+"(\\W|$)","g"),function(e,t,i){return"/"==i.charAt(0)?i:t+i}),a.hasOwnProperty(i)&&delete a[i]}),/\/+$/.test(i)||(o=o.replace(/\/+$/,"")||"/"),o=o.replace(/\/\.(?=\w+($|\?))/,"."),o=o.replace(/\/\\\./,"/."),e.isObject(a)&&_.keys(a).length>0&&(o+="?"+t.param(a)),o}function d(e){return u(e,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function u(e,t){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,t?"%20":"+")}function p(e){if(void 0===e||""===e)throw new Error("Empty dictionary name");if(void 0===f[e])throw new Error("Invalid dictionary name: "+e);return f[e]instanceof m||(f[e]=new m(f[e]),f[e].dictName=e),!0}var m,g="http://enter.b2bpolis.ru"+i.urlPrefixV4,v={},f={cities:{url:i.urlPrefixCalc+"city/:id/"},tripPurpose:{url:i.urlPrefixCalc+"trip_purpose/"},validity:{url:i.urlPrefixCalc+"validity/"},insuranceSum:{url:i.urlPrefixCalc+"insurance_sum/"},credentialTypes:{url:i.urlPrefixDefault+"client/credential-type/:id"},carMarks:{url:g+"car-mark/:id",localStorage:!0},carModelGroups:{url:g+"car-model-group",localStorage:!0},carModelsByGroup:{url:g+"car-model/:id",localStorage:!0},carModels:{url:g+"car-model/:id",localStorage:!0},carModelPrices:{url:i.urlPrefixDefault+"car_mark/:markId/car_model/:modelId/?fields=prices&year=:year",localStorage:!1,resourceParams:{markId:"@markId",modelId:"@modelId",year:"@year"}},carModifications:{url:g+"car_mark/:markId/car_model/:modelId/car_modification/:id",resourceParams:{markId:"@markId",modelId:"@modelId",id:"@id"}},ownerRegistration:{url:g+"owner-registration",localStorage:!1},exploitationArea:{url:g+"exploitation-area",localStorage:!1,urlForProxy:"/rest/full/exploitation_area/"},carBody:{url:g+"car-body",localStorage:!1},insuranceDuration:{url:g+"insurance-duration",localStorage:!1},contractDurations:{url:i.urlPrefixCalc+"contract_duration/",localStorage:!1},antiThefts:{url:i.urlPrefixDefault+"antitheft/models/",localStorage:!1},carType:{url:i.urlPrefixCalc+"car_type/",localStorage:!1},contributoryScheme:{url:g+"contributory-scheme",localStorage:!1},paymentForm:{url:g+"payment-form",localStorage:!1},insCompanyCarModels:{url:i.host+"/car_groups/rest/groups/:id/items/"},deductibleTypes:{url:i.urlPrefixCalc+"deductible_type/",localStorage:!1},targetOfUsing:{url:i.urlPrefixCalc+"target_of_using/",localStorage:!1},coverageConditions:{url:i.urlPrefixCalc+"coverage_condition/",localStorage:!1},optionalEquipments:{url:i.urlPrefixCalc+"optional_equipment/",localStorage:!1},insuranceProductStatus:{url:i.urlPrefix+"deal/insurance-product-status/:id",localStorage:!1},insuranceType:{url:g+"insurance-type"},compensationWithoutReferences:{url:i.urlPrefixCalc+"compensation_without_references/"},deductibleHarmIncident:{url:i.urlPrefixCalc+"deductible_harm_incident/"},isProlongation:{getItems:function(){var e=n.defer();return this.items=[{title:"Новый",id:!1},{title:"Из предыдущих",id:!0}],e.resolve(this.items),e.promise}},personTypes:{getItems:function(){var e=n.defer();return this.items=[{id:2,title:"Физическое лицо",shortTitle:"Физ. лицо",code:"naturalPerson"},{id:1,title:"Юридическое лицо",shortTitle:"Юр. лицо",code:"legalPerson"}],e.resolve(this.items),e.promise}},policyAreas:{url:i.urlPrefixCalc+"policy_area/",localStorage:!1},driversCountOsagoFull:{getItems:function(){var e=n.defer();return this.items=_.map(_.range(1,11),function(e){return{id:e.toString(),title:e.toString()}}),this.items.unshift({id:0,title:"Без ограничений"}),e.resolve(this.items),e.promise}},driversCountOsagoSimple:{getItems:function(){return n.when(_.map(_.range(1,11),function(e){return{id:e.toString(),title:e.toString()}}))}},driversCount:{getItems:function(){var e=n.defer();return this.items=[{title:"",item_type:"divider",code:"nat"},{title:"Ограниченный список",item_type:"header",code:"nat|active"},{id:1,title:"1 водитель",code:"nat|active"},{id:2,title:"2 водителя",code:"nat|active"},{id:3,title:"3 водителя",code:"nat|active"},{id:4,title:"4 водителя",code:"nat|active"},{id:5,title:"5 водителей",code:"nat|active"},{title:"",item_type:"divider",code:"nat"},{title:"Без ограничений",id:100,code:"nat|leg|active"}],e.resolve(this.items),e.promise}},countries:{getItems:function(){var e=n.defer();return this.items=[{id:"Азербайджан",title:"Азербайджан"},{id:"Армения",title:"Армения"},{id:"Белоруссия",title:"Белоруссия"},{id:"Казахстан",title:"Казахстан"},{id:"Киргизия",title:"Киргизия"},{id:"Молдавия",title:"Молдавия"},{id:"Таджикистан",title:"Таджикистан"},{id:"Туркмения",title:"Туркмения"},{id:"Узбекистан",title:"Узбекистан"},{id:"Украина",title:"Украина"},{id:"Грузия",title:"Грузия"},{id:"Турция",title:"Турция"},{id:"Сирия",title:"Сирия"},{id:"Тунис",title:"Тунис"},{id:"Япония",title:"Япония"},{id:"Китай",title:"Китай"},{id:"Иные",title:"Иные"}],e.resolve(this.items),e.promise}},deductibleValue:{getItems:function(){var e=n.defer();return this.items=[{id:6e3,title:6e3},{id:12e3,title:12e3},{id:2e4,title:2e4},{id:25e3,title:25e3},{id:5e4,title:5e4}],e.resolve(this.items),e.promise}},civilLiabilityVoluntaryCost:{getItems:function(){var e=n.defer();return this.items=[{id:5e5,title:5e5},{id:1e6,title:1e6},{id:15e5,title:15e5}],e.resolve(this.items),e.promise}},paymentTypes:{getItems:function(){return t.when([{title:"Банковская карта",id:"AC",img_name:"visamastercard.png"},{title:"Альфа-Клик",id:"AB",img_name:"alfaclick.jpg"},{title:"Кошелек Яндекс.Денег",id:"PC",img_name:"yandex.png"},{title:"Наличные через терминал",id:"GP",img_name:"qiwi.png"},{title:"Интернет-банк Промсвязьбанка",id:"PB",img_name:"psb.jpg"},{title:"Кошелек WebMoney",id:"WM",img_name:"webmoney.png"}])}},yesNo:{getItems:function(){return n.when([{id:!0,title:"Да"},{id:!1,title:"Нет"}])}},policyStatus:{getItems:function(){var e=n.defer();return this.items=[{id:"saved",title:"Оформление договора",code:"saved"},{id:"payed",title:"Выдан",code:"payed"},{id:"annuled",title:"Аннулирован",code:"annuled"},{id:"issued",title:"Проект договора",code:"issued"},{id:"archived",title:"Архив заключенных договоров",code:"archived"},{id:"onapproval",title:"Требует согласования",code:"onapproval"},{id:"denied",title:"Отклонен",code:"denied"}],e.resolve(this.items),e.promise}},policyActions:{getItems:function(){var e=n.defer();return this.items=[{id:"status_policy",title:"Проверить статус"},{id:"save_policy",title:"Сохранить"},{id:"print_policy",title:"Печать"},{id:"annul_policy",title:"Аннулировать"},{id:"issue_policy",title:"Оформить"}],e.resolve(this.items),e.promise}},transmission:{getItems:function(){return n.when([{id:"Автомат",title:"Автомат"},{id:"Механика",title:"Механика"}])}},driveOfCar:{getItems:function(){return n.when([{id:"Полный",title:"Полный"},{id:"Передний",title:"Передний"},{id:"Задний",title:"Задний"}])}},driverLicenseAccessory:{getItems:function(){return n.when([{id:"РФ",title:"РФ"},{id:"Иное",title:"Иное"}])}},keysCount:{getItems:function(){var e=n.defer();return this.items=_.map(_.range(1,4),function(e){return{id:e,title:e}}),e.resolve(this.items),e.promise}},notificationTypes:{url:i.urlPrefix+"notification/message-type",localStorage:!1},invoiceStatus:{url:i.urlPrefix+"invoice/invoice-status/:id",localStorage:!1},cbmCasco:{url:i.urlPrefixCalc+"cbm_casco/:id",localStorage:!1},osagoLossesCount:{url:i.urlPrefixCalc+"osago_losses_count/:id",localStorage:!1},specialProgram:{url:i.urlPrefixCalc+"special_program/:id",localStorage:!1},carParkSize:{url:i.urlPrefixCalc+"car_park_size/:id",localStorage:!1},prolongations:{url:i.urlPrefixCalc+"prolongation/:id",localStorage:!1},signalizationType:{url:i.urlPrefixCalc+"signalization_type/",localStorage:!1},insurantType:{url:i.urlPrefixCalc+"insurant_type/",localStorage:!1},dealCount:{url:i.urlPrefixCalc+"deal_count/",localStorage:!1},carParkSizeItems:{url:i.urlPrefixCalc+"car_park_size/",localStorage:!1},creditBank:{url:i.urlPrefixDefault+"bank/",localStorage:!1},technicalInspectionType:{url:i.urlPrefixCalc+"technical_inspection_type/",localStorage:!1},osagoRegion:{url:i.urlPrefixCalc+"osago_region/",localStorage:!1},osagoCity:{url:i.urlPrefixCalc+"osago_city/:id",localStorage:!1}};return m=function(t){this.items=[],this.dictName="",this.url="",this.cache=!0,this.localStorage=!1,this.lastUpdate="",this.lifeTime=r,this.resourceParams={id:"@id"},this._loadStack={},e.extend(this,t),this.defaultUrl=c(this.url)},null===localStorage.getItem("lastUpdates")&&localStorage.setItem("lastUpdates",e.toJson({})),m.prototype.load=function(t,i){var a,r;return t=t||c(this.url,i),e.isArray(this._loadStack[t])&&this.cache?(a=n.defer(),0===this._loadStack[t].length?a.resolve(this.items[t]):this._loadStack[t].push(a),a.promise):(this.urlForProxy&&(t=this.urlForProxy),r=l[this.urlForProxy?"get":"getOriginal"](t),this.cache&&(this._loadStack[t]=[],this._loadStack[t].push(r)),r.then(function(i){var a=i.data;return this.cache&&(this.items[t]=a,this._loadStack[t].shift(),e.forEach(this._loadStack[t],function(e){e.resolve(a)}),this._loadStack[t].length=0),this.localStorage&&(localStorage.setItem(t,e.toJson(a)),this.setLastUpdate(t)),a}.bind(this),function(i){this.cache&&(this._loadStack[t].shift(),e.forEach(this._loadStack[t],function(e){e.reject(i)}),this._loadStack[t].length=0)}.bind(this)))},m.prototype.setLastUpdate=function(t,i){var a=e.fromJson(localStorage.getItem("lastUpdates"))||{};i=i||(new Date).getTime(),t=t||this.dictName,this.lastUpdate=i,a[t]=i,localStorage.setItem("lastUpdates",e.toJson(a))},m.prototype.getLastUpdate=function(t){var i;return t=t||this.dictName,localStorage.getItem("lastUpdates")&&(i=e.fromJson(localStorage.getItem("lastUpdates"))[t]),this.lastUpdate||i},m.prototype.checkLastUpdate=function(e){var t=this.getLastUpdate(e);return!isNaN(parseInt(t,10))&&t+1e3*this.lifeTime>(new Date).getTime()},m.prototype.getItems=function(t){var i,a=e.isObject(t)?c(this.url,t):this.defaultUrl,r=n.defer();return this.cache&&void 0!==this.items[a]?r.resolve(e.copy(this.items[a])):this.localStorage&&this.checkLastUpdate(a)&&(i=localStorage.getItem(a))?(i=e.fromJson(i),this.cache&&(this.items[a]=i),r.resolve(e.copy(i))):this.load(a,t).then(function(t){r.resolve(e.copy(t)||[])},function(e){r.reject(e)}),r.promise},m.prototype.filter=function(e){return this.getItems().then(function(t){return s("filter")(t,e)})},m.prototype.findItem=function(t,i){var a,r=n.defer();return e.isObject(t)&&(a=e.copy(t),t=t.id),this.getItems(a).then(function(e){r.resolve(o(e,t,i))},function(e){r.reject(e)}),r.promise},m.prototype.loadItem=function(t){var i,a=n.defer();return void 0===t||null===t||""===t?a.reject("The params is empty"):((e.isString(t)||e.isNumber(t))&&(t={id:t}),i=c(this.url,t),(e.isString(t)||e.isNumber(t))&&(t={id:t}),l.getOriginal(i).then(function(e){a.resolve(e.data)},function(e){a.reject(e)})),a.promise},v.getItems=function(e){var t,i;try{p(e)}catch(e){console.log(e.message)}return t=Array.prototype.slice.apply(arguments),t.splice(0,1),i=f[e],i.getItems.apply(i,t)},v.findItem=function(e,t,i){var a,r;try{p(e)}catch(e){console.log(e.message)}return a=Array.prototype.slice.apply(arguments),a.splice(0,1),r=f[e],r.findItem.apply(r,a)},v.loadItem=function(e,t){var i,a;try{p(e)}catch(e){console.log(e.message)}return i=Array.prototype.slice.apply(arguments),i.splice(0,1),a=f[e],a.loadItem.apply(a,i)},v.filter=function(e,t){var i,a;try{p(e)}catch(e){console.log(e.message)}return i=Array.prototype.slice.apply(arguments),i.splice(0,1),a=f[e],a.filter.apply(a,i)},e.forEach(a,function(e){v.getItems(e)}),v}];return{$get:n,setConstants:function(e){i=e},setLifeTime:function(e){r=e},preload:function(t){return e.isString(t)?void(a=[t]):void(e.isArray(t)&&(a=t))}}})}(angular,jQueryApp),function(e){e.module("policyOrdering",[])}(angular),function(e){"use strict";e.module("policyOrdering").controller("policyOrderingCtrl",["$scope","$rootScope","CONSTS","calculatorService","Dictionary","Messages","$timeout","addingDocumentsService","$filter","calculatorStepsService","formationPolicyService",function(e,t,i,a,r,n,s,l,o,c,d){function u(){return{payment_type:"Наличными",receipt_type:"delivery",client_phone:"",client_name:"",delivery_date:"",delivery_time:"",delivery_address:"",arrival_date:"",arrival_time:""}}e.carInfo={},e.policyInfo={};var p=a.calculation,m=p&&p.id||9093963;e.policyOrderingInProgress=!1,e.selectedResult=a.getSelectedResult(),e.dictionaryTitles={},e.formFields=u(),e.sendPolicyOrdering=function(){var i="",r=new FormData;return e.policyOrderingInProgress=!0,i+="Имя клиента: "+e.formFields.client_name+"\n",i+="Номер телефона клиента: +7"+e.formFields.client_phone+"\n\n",i+="Номер расчета: "+a.calculation.id+"\n",i+="Выбранная страховая компания: "+e.selectedResult.insurance_company.title+" ("+e.selectedResult.id+")\n\n",i+="Способ оплаты: "+e.formFields.payment_type+"\n",i+="Тип получения: "+("delivery"===e.formFields.receipt_type?"Доставка":"Получение в офисе")+"\n","delivery"===e.formFields.receipt_type?(i+="Место доставки: "+e.formFields.delivery_address+"\n",i+="Желаемая дата доставки: "+e.formFields.delivery_date+"\n",i+="Желаемое время доставки: "+e.formFields.delivery_time+"\n"):(i+="Дата оформления: "+e.formFields.arrival_date+"\n",i+="Время оформления: "+e.formFields.arrival_time+"\n"),i+="Автомобиль: "+e.carInfo.carMark.title+" "+e.carInfo.carModelGroup.title+" "+e.carInfo.carModel.title+" "+p.car_manufacturing_year+" г. выпуска, "+p.engine_power+" л.с. \n",["tumen"].indexOf(t.currentBrandName)!==-1&&(i+="Коробка передач: "+e.calculationInterParams.params.transmission+"\n",i+="Привод: "+e.calculationInterParams.params.drive_of_car+"\n",i+="Оплата: "+e.policyInfo.contributory_scheme+"\n",i+="Автомобиль на гарантии: "+e.carInfo.is_under_warranty+"\n",i+="Новое ТС: "+e.carInfo.is_new_car+"\n",i+="СТОА: "+e.policyInfo.is_under_warranty+"\n"),i+="Регион регистрации собственника: "+e.carInfo.owner_registration_title+"\n",i+="Страховая сумма: "+o("priceFormatter")(e.selectedResult.program.sum,2)+" рублей \n\n",d.personalData&&(i+=d.personalData),t.currentBrand.link_to_registration_in_email&&(i+="Ссылка на оформление: http://enter.b2bpolis.ru/#/calculator/"+a.calculation.id+"/result/"+e.selectedResult.id+"?s=b&fp=a"),r.append("message",i),l.uploader&&_.forEach(l.uploader.queue,function(e,t){r.append("file_"+t,e._file)}),l.send(r).then(function(){e.policyOrderingInProgress=!1,n.success("Ваш заказ принят. Мы свяжемся с вами в ближайшее время.",6e3),e.formFields=u()},function(){n.error("Не удалось отправить запрос.",6e3),e.policyOrderingInProgress=!1})},e.getYearRange=function(e,t){var i,a,r=new Date;return e=e||0,t=void 0===t?90:t,a=r.getFullYear()-t,i=r.getFullYear()-e,a+":"+i},e.paymentType=["Наличными","Банковской картой","Денежным переводом"],a.getCalculation(m).then(function(t){e.calculation=t,r.getItems("carModelGroups",{car_mark:t.car_mark}).then(function(i){e.carInfo.carModelGroup=_.find(i.results,function(e){return e.id==t.car_model_group})}),r.getItems("ownerRegistration").then(function(t){var i=_.find(t.results,function(t){return t.id==e.calculation.owner_registration});i&&(e.carInfo.owner_registration_title=i.title)}),r.getItems("contributoryScheme").then(function(t){var i=_.find(t.results,function(t){return t.id==e.calculationInterParams.contributory_scheme});i&&(e.policyInfo.contributory_scheme=i.title)}),r.getItems("yesNo").then(function(t){var i=_.find(t.results,function(t){return t.id==e.calculationInterParams.is_under_warranty});i&&(e.carInfo.is_under_warranty=i.title)}),r.getItems("yesNo").then(function(t){var i=_.find(t.results,function(t){return t.id==e.calculationInterParams.is_new_car});i&&(e.carInfo.is_new_car=i.title)}),r.getItems("paymentForm").then(function(t){var i=_.find(t.results,function(t){return t.id==e.calculationInterParams.is_under_warranty});i&&(e.policyInfo.is_under_warranty=i.title)}),r.getItems("carMarks",{id:t.car_mark}).then(function(t){t=t.results?t.results:t,e.carInfo.carMark=t}),r.getItems("carModels",{id:t.car_model}).then(function(t){t=t.results?t.results:t,e.carInfo.carModel=t}),t.insured_object&&d.getInsuredObject(t.insured_object).then(function(t){e.carInfo.drivers=t.drivers})}),a.getResult(m).then(function(t){e.calculationResult=t,e.selectedResult=e.selectedResult||t}),e.templates={navigation:i.pathToModules+"shared/calculator/views/navigation.html"}}])}(angular),function(e){e.module("priceFormatter",[])}(angular),function(e,t){"use strict";e.module("priceFormatter").directive("priceFormatter",["$filter",function(e){function i(e){if(!e.selectionStart&&document.selection){var t=document.selection.createRange().duplicate();return t.moveEnd("character",e.value.length),""===t.text?e.value.length:e.value.lastIndexOf(t.text)}return e.selectionStart}function a(e,t){if(e.setSelectionRange)e.setSelectionRange(t,t);else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",t),i.select()}return e}return{restrict:"A",require:"^ngModel",link:function(r,n,s,l){var o=s.priceFormatter||0,c=/[^0-9]/g;o&&(c=/[^0-9.]/g),n=t(n),l.$parsers.push(function(t){var r,s,l,d=t.replace(c,""),u=n.val().length,p=n.get(0);return t?(r=i(p),l=e("priceFormatter")(d,o,".",!0,!0)||"0",n.val(l),s=n.val().length,a(p,r+(s-u)),d):t=0}),l.$formatters.push(function(t){return e("priceFormatter")(t,o,".",!0,!0)})}}}])}(angular,jQueryApp),function(e){"use strict";e.module("priceFormatter").filter("priceFormatter",[function(){var e=function(e,t,i,a,r){if(t=t||0,a=a||".",i=i||" ",0===t&&isNaN(parseInt(e,10))||isNaN(parseFloat(e))||0===e)return 0;var n,s,l,o=e<0?"-":"",c=e.toString().replace(/\s/g,"").replace(/^0+/g,"").split("."),d=c[0],u=!!t&&c[1],p=d.length>3?d.length%3:0;return r&&c[1]&&0===parseInt(c[1],10)&&(u=!1),t&&e===c[0]+"."&&(u=!0),u&&c[1].length>t&&(c[1]=c[1].substr(0,t)),n=p?d.substr(0,p)+i:"",s=d.substr(p).replace(/(\d{3})(?=\d)/g,"$1"+i),l=u?a+c[1]:"",n||s||(n="0"),o+n+s+l};return function(t,i,a,r,n){return i=i||0,a=a||",",n="string"==typeof n?n:" ",e(t,i,n,a,r)}}])}(angular),function(e){e.module("inputOnly",[])}(angular),function(e){"use strict";e.module("inputOnly").directive("inputCapitalize",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,a){var r=function(e){void 0===e&&(e="");var t=e.toUpperCase();return t!==e&&(a.$setViewValue(t),a.$render()),t};a.$parsers.push(r),r(e[i.ngModel])}}}])}(angular),function(e){"use strict";e.module("inputOnly").directive("inputFloat",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,a){var r=i.maxPrecision?+i.maxPrecision+1:null;a.$parsers.push(function(e){var t,i="";if(""===e||void 0===e||null===e)return e;var n=(e+"").replace(/[^0-9.,]/g,"");return n=n.replace(",","."),n=n.replace(/(\.[0-9]*)(\.+)/g,"$1"),n=n.replace(/^\./g,""),r&&(t=n.indexOf("."),t!==-1&&(i=n.substr(t),i.length>r&&(n=n.slice(0,r-i.length)))),n!=e&&(a.$setViewValue(n),a.$render()),n})}}}])}(angular),function(e){"use strict";e.module("inputOnly").directive("inputInteger",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,i,a){a.$parsers.push(function(e){var t;return""===e||void 0===e||null===e?e:(t=(e+"").replace(/[^0-9]/g,""),t!=e&&(a.$setViewValue(t),a.$render()),t)})}}}])}(angular),function(e){"use strict";e.module("inputOnly").directive("inputOnly",[function(){return{restrict:"A",priority:2,require:"ngModel",link:function(e,t,i,a){var r=new RegExp(i.inputOnly,"g");r&&a.$parsers.push(function(e){var t,i="";return""===e||void 0===e||null===e?e:(t=(e+"").match(r),t&&(i=t.join("")),i!=e&&(a.$setViewValue(i),a.$render()),i)})}}}])}(angular),function(e,t){"use strict";e.module("inputOnly").directive("inputPhone",["$timeout",function(e){function i(e){if(!e.selectionStart&&document.selection){var t=document.selection.createRange().duplicate();return t.moveEnd("character",e.value.length),""===t.text?e.value.length:e.value.lastIndexOf(t.text)}return e.selectionStart}function a(e,t){if(e.setSelectionRange)e.setSelectionRange(t,t);else if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",t),i.select()}return e}return{restrict:"A",require:"ngModel",link:function(r,n,s,l){var o,c=/\+7\(\d{0,3}\)[\d]{0,3}-[\d]{0,4}/,d="+7()-";n=t(n),l.$parsers.push(function(t){var r,s,u,p=n.get(0);return null===t&&(t=""),r=c.exec(t+""),r=r?r[0]:o?o:d,o=r,s=i(p),r===d&&(u=3),6===s&&(u=7),10===s&&(u=11),11===s&&o.length>=r.length&&(u=10),7===s&&o.length>=r.length&&(u=6),void 0!==u&&e(function(){a(p,u)},0),r!=t&&(l.$setViewValue(r),l.$render()),r}),n.focus(function(){var i=t(this).val();i||(l.$setViewValue(d),l.$render(),r.$apply(function(){e(function(){a(n.get(0),3)},0)}))})}}}])}(angular,jQueryApp),function(e){"use strict";e.module("inputOnly").directive("inputReplace",[function(){return{priority:1e4,restrict:"A",require:"ngModel",link:function(t,i,a,r){var n=t.$eval(a.inputReplace);if(!e.isObject(n))throw new Error("input-replace is not a object!");r.$parsers.push(function(t){if(""===t||void 0===t||null===t)return t;var i=t;return e.forEach(n,function(e,t){i=i.replace(new RegExp(t,"g"),e)}),i!=t&&(r.$setViewValue(i),r.$render()),i})}}}])}(angular),function(e){"use strict";e.module("inputOnly").directive("inputVinNumber",["vinNumberService",function(e){return{restrict:"A",require:"ngModel",link:function(t,i,a,r){var n=e.mappedAlph;r.$parsers.push(function(t){var a,s;if(""===t||void 0===t||null===t)return t;a=t.split("");for(var l=0,o=a.length;o>l;l++)for(var c in n)n.hasOwnProperty(c)&&n[c]===a[l]&&(a[l]=c);return a=a.join("").toUpperCase().replace(/[^0-9A-HJ-NPR-Z]/g,""),a!==t&&(r.$setViewValue(a),r.$render()),s=e.vinIsValid(a),i[s?"removeClass":"addClass"]("js-vin-is-invalid"),i.parent()[s?"removeClass":"addClass"]("js-vin-is-invalid"),a})}}}])}(angular),function(e){"use strict";e.module("inputOnly").service("vinNumberService",[function(){function e(e){for(var t={A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,J:1,K:2,L:3,M:4,N:5,P:7,R:9,S:2,T:3,U:4,V:5,W:6,X:7,Y:8,Z:9,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,0:0},i=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2],a=0,r=0;r<e.length;r++)a+=t[e[r]]*i[r];var n=a%11;return 10==n&&(n="X"),n==e[8]}function t(t){var i="[a-hj-npr-z0-9]",a=new RegExp("^"+i+"{8}[0-9xX]"+i+"{8}$","i");return null!==t.match(a)&&e(t)}var i={q:"й",w:"ц",e:"у",r:"к",t:"е",y:"н",u:"г",i:"ш",o:"щ",p:"з",a:"ф",s:"ы",d:"в",f:"а",g:"п",h:"р",j:"о",k:"л",l:"д",z:"я",x:"ч",c:"с",v:"м",b:"и",n:"т",m:"ь",W:"Ц",E:"У",R:"К",T:"Е",Y:"Н",U:"Г",I:"Ш",O:"Щ",P:"З",A:"Ф",S:"Ы",D:"В",F:"А",G:"П",H:"Р",J:"О",K:"Л",L:"Д",Z:"Я",X:"ч",C:"С",V:"М",B:"И",N:"Т",M:"Ь"};return{vinIsValid:t,mappedAlph:i}}])}(angular),function(e){e.module("ngThumb",[])}(angular),function(e){"use strict";e.module("ngThumb").directive("ngThumb",["$window","ngThumb",function(t,i){var a={support:!(!t.FileReader||!t.CanvasRenderingContext2D),isFile:function(i){return e.isObject(i)&&i instanceof t.File},isImage:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(t)!==-1},isPdf:function(e){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|pdf|".indexOf(t)!==-1}},r=i.pdfIcon;return{restrict:"A",template:"<canvas/>",link:function(e,t,i){function n(e){var t=new Image;t.onload=s,t.src=a.isPdf(l.file)?r:e.target.result}function s(){var e=l.width||this.width/this.height*l.height,t=l.height||this.height/this.width*l.width;o.attr({width:e,height:t}),o[0].getContext("2d").drawImage(this,0,0,e,t)}if(a.support){var l=e.$eval(i.ngThumb);if(a.isFile(l.file)&&(a.isImage(l.file)||a.isPdf(l.file))){var o=t.find("canvas"),c=new FileReader;c.onload=n,c.readAsDataURL(l.file)}}}}}])}(angular),function(e,t){"use strict";e.module("ngThumb").provider("ngThumb",function(){var e="",t=[function(){return{pdfIcon:e}}];return{$get:t,setPdfIcon:function(t){e=t}}})}(angular,jQueryApp),function(e){e.module("jDatePicker",[])}(angular),function(e,t){"use strict";e.module("jDatePicker").directive("jdatepicker",["$parse","$timeout","jdatepicker",function(i,a,r){return{restrict:"A",priority:2,require:"ngModel",link:function(n,s,l,o){function c(i){var a,r=i,l=t.datepicker.dpDiv,d=l.find(".ui-datepicker-year").val();return e.isString(x)&&(e.isDate(i)||(r=t.datepicker.parseDate(y,i)),r=t.datepicker.formatDate(x,r),d!=t.datepicker._curInst.selectedYear)?(a=new Date(r),a.setFullYear(d),s.datepicker("setDate",a),c(a),void s.blur()):(o.$setViewValue(r),void n.$apply())}function d(t){var i,a;if(e.isDate(t)){if(I&&t>new Date)return!1;if(D&&t<(new Date).setDate((new Date).getDate()))return!1;if(g.yearRange&&$)return i=g.yearRange.split(":",2),a=t.getFullYear(),a>=i[0]&&a<=i[1]}return!0}function u(e){var t=new Date(l.jdatepickerMinDate).getTime(),i=new Date(l.jdatepickerMaxDate).getTime();if(new Date(e).getTime()){if(t&&t>e)return!1;if(i&&i<e)return!1}return!0}function p(e){var t=String.fromCharCode(null===e.charCode?e.keyCode:e.charCode);return e.ctrlKey||e.metaKey||t<" "||!_||_.indexOf(t)>-1||void 0!==P[t]}var m,_,g,v=r.getDefaults(),f=(new Date).getFullYear(),h=l.jdatepickerClass||v.class,b=void 0!==l.jdatepickerYearCount?parseInt(l.jdatepickerYearCount,10):v.yearCount,y=l.jdatepickerDateFormat||v.dateFormat,w=l.jdatepickerPDateFormat||v.pDateFormat||y,x=l.jdatepickerMDateFormat||v.mDateFormat,k=l.jdatepickerYearRange||v.yearRange||f-b+":"+f,C=l.jdatepickerValidator||null,P=void 0!==l.jdatepickerReplacedSymbols?l.jdatepickerReplacedSymbols:v.replacedSymbols,S=l.jdatepickerInputRule||v.inputRule,I=!!l.jdatepickerOnlyPast,D=!!l.jdatepickerOnlyFuture,$=void 0!==l.jdatepickerValidateYearRange?n.$eval(l.jdatepickerValidateYearRange):v.validateYearRange;s=t(s),t.datepicker.setDefaults(v),g={dateFormat:y,yearRange:k,onSelect:function(e,t){t.inline=!0,c(e)},showMonthAfterYear:!0,onClose:function(e,t){t.inline=!1}},e.isObject(P)&&(g.constrainInput=!1),e.isString(h)&&""!==h&&(g.beforeShow=function(){t("#ui-datepicker-div").addClass(h)}),a(function(){s.datepicker(g)},0),C&&(C=i(C),m=/\(([\dA-Za-z_$]*)(\)|,\s)/.exec(l.jdatepickerValidator),o.$parsers.unshift(function(e){var t={};return null!==m&&(t[m[1]]=e),o.$valid&&o.$setValidity(l.name,C(n,t)),e}),o.$formatters.unshift(function(e){var t={};return null!==m&&(t[m[1]]=e),o.$valid&&o.$setValidity(l.name,C(n,t)),e})),o.$parsers.unshift(function(e){return o.$setValidity(l.name,function(e){var i;try{i=t.datepicker.parseDate(y,e)}catch(a){try{i=t.datepicker.parseDate(w,e)}catch(e){return!1}return d(i)&&u(i)}return d(i)&&u(i)}(e)),e}),o.$formatters.unshift(function(i){return o.$setValidity(l.name,function(i){var a;if(e.isDate(i))return d(i);if(e.isString(i)){try{a=t.datepicker.parseDate(w,i)}catch(e){try{a=t.datepicker.parseDate(y,i)}catch(e){return!1}return d(a)&&u(a)}return d(a)&&u(a)}return!0}(i)),i}),o.$parsers.unshift(function(i){var a,r=w;try{a=t.datepicker.parseDate(y,i)}catch(e){return i}return e.isString(x)&&(r=x),t.datepicker.formatDate(r,a)}),o.$formatters.unshift(function(i){var a;if(e.isDate(i))return t.datepicker.formatDate(y,i);if(e.isString(i)){try{a=t.datepicker.parseDate(w,i)}catch(e){a=t.datepicker.parseDate(y,i)}return t.datepicker.formatDate(y,a)}return i}),e.isObject(P)&&(_=t.datepicker._possibleChars(y),s.on("keypress",p),o.$parsers.unshift(function(t){var i;return""===t||void 0===t||null===t?t:(i=t,e.forEach(P,function(e,t){i=i.replace(new RegExp(t,"g"),e)}),i!=t&&(o.$setViewValue(i),o.$render()),i)})),e.isFunction(S)&&s.on("keyup",function(e){var t,i=s.val(),a=[8,9,16,17,37,39,46];e.ctrlKey||e.metaKey||e.altKey||a.indexOf(e.keyCode)!==-1||(t=S(i),s.val(t),o.$setViewValue(t),s.datepicker("hide"))})}}}])}(angular,jQueryApp),function(e){"use strict";e.module("jDatePicker").provider("jdatepicker",[function(){var t={class:"",yearCount:6,dateFormat:"yy-mm-dd",pDateFormat:null,mDateFormat:null,yearRange:null,maxDate:null,minDate:null,closeText:"Закрыть",prevText:"&#x3C;Пред",nextText:"След&#x3E;",currentText:"Сегодня",monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["вск","пнд","втр","срд","чтв","птн","сбт"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Нед",changeMonth:!0,changeYear:!0,firstDay:1,isRTL:!1,showMonthAfterYear:!0,yearSuffix:"",replacedSymbols:null,selectOtherMonths:!0,showOtherMonths:!0,validateYearRange:!0};this.setDefaults=function(i){e.extend(t,i)},this.$get=function(){return{getDefaults:function(){return t}}}}])}(angular),function(e,t){"use strict";e.module("calculator").directive("goToCalculation",["$state","$rootScope","calculatorService","formationPolicyService","$timeout","formationPolicyStep1Service",function(e,i,a,r,n,s){
return{restrict:"AC",scope:{calcType:"@",params:"=goToCalculation",transitionParams:"=",options:"=transitionOptions"},link:function(l,o,c,d){var u=t(o);u.click(function(t){var o=l.options||{},c=o.calcType||i.calcType,d=l.params||{},p=l.transitionParams||{};return!u.hasClass("disabled")&&!u.is(":disabled")&&(t.preventDefault(),i.calcType=c,d.rsa=e.params.rsa,n(function(){(o.resetCalc||o.resetAll)&&(s.resetAll(),a.resetCalculation()),(o.resetPolicy||o.resetAll)&&(s.resetAll(),r.resetCurrentPolicy())},0),void e.go("index.calculator."+c,d,p))})}}}])}(angular,jQueryApp),function(e,t){"use strict";e.module("calculator").directive("moveToStep",["$timeout","calculatorStepsService",function(e,i){return{restrict:"A",template:'<div class="c-change-step"></div>',link:function(a,r,n){var s=t(r),l="forward"===n.moveToStep?"forward":"back";s.addClass("c-change-step--"+l),"back"===l&&s.html('<i class="icon-left-open-big"></i>'),s.click(function(t){return e(function(){i.toPrevSmallStep()},0),!1})}}}])}(angular,jQueryApp),function(e){"use strict";e.module("calculator").controller("calculatorNavigationCtrl",["$scope","$state","calculatorService","$rootScope","calculatorStepsService","moduleType",function(e,t,i,a,r,n){function s(e){return function(){return e.test(t.current.name)}}function l(){return r.bigSteps.getBigStep()}e.calculation=i.calculation,e.navigation=function(){var e=[{active:function(){return s(/index.calculator/)()&&"first"===l().name},link:"index.calculator."+a.calcType,title:"Ваш автомобиль",onClick:function(){r.bigSteps.setBigStep("first")},additional_conditions:{},icon:"car"},{active:function(){return s(/index.calculator/)()&&"second"===l().name},link:"index.calculator."+a.calcType,title:"Параметры расчета",onClick:function(){r.bigSteps.setBigStep("second")},condition_disabled:function(){var e=i.calculation;return!parseInt(e.car_cost)&&"third"!==l().name},additional_conditions:{},icon:"options"},{active:function(){return"third"===l().name},onClick:function(){r.bigSteps.setBigStep("third")},link:"index.addingDocuments",title:"Тариф",condition_disabled:function(){return["third","fourth"].indexOf(l().name)===-1&&!i.getSelectedResult()},additional_conditions:{},icon:"tasks"},{active:function(){return"fourth"===l().name},onClick:function(){r.bigSteps.setBigStep("fourth")},link:"index.ordering",title:"Заказ",condition_disabled:function(){return!i.getSelectedResult()},icon:"checked calendar"}];return"osago"===n&&(e=[{active:function(){return s(/index.calculator/)()&&"first"===l().name},title:"Рассчитайте тариф",onClick:function(){r.bigSteps.setBigStep("first")},icon:"options"},{active:function(){return s(/index.calculator/)()&&"second"===l().name},title:"Добавьте документы",onClick:function(){r.bigSteps.setBigStep("second")},condition_disabled:function(){var e=i.calculation;return!i.getSelectedResult()||!parseInt(e.car_cost)&&"fourth"!==l().name},icon:"file text outline"},{active:function(){return"fourth"===l().name},onClick:function(){r.bigSteps.setBigStep("fourth")},title:"Получите полис",condition_disabled:function(){return["fourth"].indexOf(l().name)===-1},icon:"shopping bag"}]),_.forEach(e,function(e){"function"!=typeof e.isHidden&&(e.isHidden=_.noop),"function"!=typeof e.condition_disabled&&(e.condition_disabled=_.noop),"function"!=typeof e.onClick&&(e.onClick=_.noop)}),e}(),e.goToStep=function(r){var n=i.getSelectedResult();t.go(e.navigation[r].link,{calculationId:e.calculation.id||t.params.calculationId,calcType:a.calcType||"osago",companyId:n&&n.id||t.params.companyId},{reload:!1})}}])}(angular),function(e){"use strict";e.module("calculator").provider("calculator",[function(){var t={id:null,car_cost:0,car_mark:null,car_model_group:null,car_model:null,car_manufacturing_year:null,exploitation_area:null,owner_registration:null,drivers_count:0,driver_set:[],drivers_minimal_age:null,drivers_minimal_experience:null,is_multidrive:!1,target_of_using:null,insurance_duration:null,contributory_scheme:null,payment_type:null,mileage:null,insurable_risk:null,claim_form:null,payment_form:null,deductible_value:null,civil_liability_voluntary_cost:null,car_type:null,insured_object:null,count_years_break_even_insurance:0,calculation_at_date:null,insurance_type:null,has_foreign_registration:!1,maximum_mass:null,seats_number:null,engine_power:null,engine_displacement:null,is_legal_entity:!1,has_trailer:!1,calculation_type:null,is_earlier_insurance:null};this.setDefaults=function(i){e.extend(t,i)},this.$get=function(){return{getDefaults:function(){return t}}}}])}(angular),function(e){"use strict";e.module("calculator").service("calculatorStepsService",["stepsService","calculatorService","CONSTS","$filter","brandingConfigs","moduleType",function(t,i,a,r,n,s){function l(){var e=u.bigSteps.getBigStep().name;return t.steps[e]||[]}function o(){return{age:26,expirience:2,is_married:!1,has_children:!1,gender:"M",birth_date:"",driving_experience_started:""}}var c=i.calculation,d={carModel:null,carModelGroup:null,carMark:null},u=this;this.brandSteps=t.steps;var p={first:{name:"first",templateUrl:n.templates.first_big_step||a.pathToModules+"shared/calculatorSteps/views/first_big_step.html"},second:{name:"second",templateUrl:function(){var e="C";return"osago"===s&&(e="O"),a.pathToModules+s+"/calculatorSteps"+e+"/views/second_big_step.html"}()},third:{name:"third",templateUrl:a.pathToModules+"shared/carFilter/views/third_big_step.html"},fourth:{name:"fourth",templateUrl:n.templates.fourth_big_step||a.pathToModules+"shared/carFilter/views/fourth_big_step.html"}};this.bigsStepsTepmplates=p;var m={year:{name:"year",clearStep:function(){c.car_manufacturing_year=null},toNextStep:function(){c.car_manufacturing_year=u.calculationInterParams.car_manufacturing_year},getLabelTitle:function(){return c.car_manufacturing_year?c.car_manufacturing_year+" г.в.":null},templateUrl:a.pathToModules+"shared/calculatorSteps/views/step.year.html"},car_mark:{name:"car_mark",clearStep:function(){c.car_mark=null,d.carMark=null},toNextStep:function(){c.car_mark=u.calculationInterParams.car_mark},getLabelTitle:function(){return d.carMark&&d.carMark.title},templateUrl:a.pathToModules+"shared/calculatorSteps/views/step.car_mark.html"},car_model_group:{name:"car_model_group",clearStep:function(){c.car_model_group=null,d.carModelGroup=null},toNextStep:function(){c.car_model_group=u.calculationInterParams.car_model_group},getLabelTitle:function(){return d.carModelGroup&&d.carModelGroup.title},templateUrl:a.pathToModules+"shared/calculatorSteps/views/step.car_model_group.html"},car_model:{name:"car_model",clearStep:function(){c.car_model=null,d.carModel=null},toNextStep:function(){c.car_model=u.calculationInterParams.car_model},getLabelTitle:function(){return d.carModel&&d.carModel.title},templateUrl:a.pathToModules+"shared/calculatorSteps/views/step.car_model.html"},engine_power:{name:"engine_power",clearStep:function(){c.engine_power=null},toNextStep:function(){c.engine_power=u.calculationInterParams.engine_power},getLabelTitle:function(){return c.engine_power?c.engine_power+" л.с.":null},templateUrl:n.templates.engine_power||a.pathToModules+"shared/calculatorSteps/views/step.engine_power.html"},exploitation_area:{name:"exploitation_area",clearStep:function(){c.exploitation_area=null},toNextStep:function(){c.exploitation_area=u.calculationInterParams.exploitation_area},getLabelTitle:function(){return c.exploitation_area?this.calculationInterParams.exploitation_area_title:null}.bind(this),templateUrl:a.pathToModules+"shared/calculatorSteps/views/step.exploitation_area.html"},car_cost:{name:"car_cost",clearStep:function(){c.car_cost=null},toNextStep:function(){c.car_cost=u.calculationInterParams.car_cost},getLabelTitle:function(){return c.car_cost?r("priceFormatter")(c.car_cost,0)+" руб.":null},templateUrl:n.templates.car_cost||a.pathToModules+"shared/calculatorSteps/views/step.car_cost.html"},mileage:{name:"mileage",clearStep:function(){c.mileage=null},toNextStep:function(){c.mileage=u.calculationInterParams.mileage},getLabelTitle:function(){return c.mileage?r("priceFormatter")(c.mileage,0)+" км.":null},templateUrl:n.templates.mileage||a.pathToModules+"shared/calculatorSteps/views/step.mileage.html"},owner_registration:{name:"owner_registration",clearStep:function(){c.owner_registration=null},toNextStep:function(){c.owner_registration=u.calculationInterParams.owner_registration},templateUrl:a.pathToModules+"shared/calculatorSteps/views/step.owner_registration.html"},drivers_count:{name:"drivers_count",clearStep:function(){c.drivers_count=null,u.calculationInterParams.drivers_count=null},toNextStep:function(){c.drivers_count=u.calculationInterParams.drivers_count.id},getLabelTitle:function(){return u.calculationInterParams.drivers_count&&u.calculationInterParams.drivers_count.title||null},templateUrl:a.pathToModules+"shared/calculatorSteps/views/step.drivers_count.html"},drivers:{name:"drivers",clearStep:function(){},toNextStep:function(){c.driver_set=u.calculationInterParams.drivers},templateUrl:n.templates.drivers||a.pathToModules+"shared/calculatorSteps/views/step.drivers.html"},is_multidrive:{name:"is_multidrive",clearStep:function(){c.is_multidrive=null,c.drivers_minimal_age=null,c.drivers_minimal_experience=null},toNextStep:function(){c.is_multidrive=!0,c.drivers_minimal_age=u.calculationInterParams.drivers_minimal_age,c.drivers_minimal_experience=u.calculationInterParams.drivers_minimal_experience},templateUrl:n.templates.is_multidrive||a.pathToModules+"shared/calculatorSteps/views/step.is_multidrive.html"},is_earlier_insurance:{name:"is_earlier_insurance",clearStep:function(){c.is_earlier_insurance=null},toNextStep:function(){c.is_earlier_insurance=u.calculationInterParams.is_earlier_insurance},getLabelTitle:function(){return _.isBoolean(c.is_earlier_insurance)?c.is_earlier_insurance?"Ранее был застрахован":"Ранее не страховался":""},templateUrl:a.pathToModules+"shared/calculatorSteps/views/step.is_earlier_insurance.html"},is_credit:{name:"is_credit",clearStep:function(){c.is_credit=null},toNextStep:function(){c.is_credit=u.calculationInterParams.is_credit},getLabelTitle:function(){return _.isBoolean(c.is_credit)?c.is_credit?"Куплен в кредит":"Без кредита":""},templateUrl:a.pathToModules+"shared/calculatorSteps/views/step.is_credit.html"},calculation_type:{name:"calculation_type",clearStep:function(){u.calculationInterParams.calculation_type=null},toNextStep:function(){},getLabelTitle:function(){return u.calculationInterParams.calculation_type&&("full"===u.calculationInterParams.calculation_type?"Точный с КБМ":"Примерный")},templateUrl:a.pathToModules+"shared/calculatorSteps/views/step.calculation_type.html"},"car_settings.tumen":{name:"car_settings.tumen",clearStep:function(){c.car_cost=null,c.mileage=null,c.engine_power=null,c.engine_displacement=null},toNextStep:function(){c.car_cost=u.calculationInterParams.car_cost,c.mileage=u.calculationInterParams.mileage,c.engine_power=u.calculationInterParams.engine_power,c.engine_displacement=u.calculationInterParams.engine_displacement},getLabelTitle:function(){},templateUrl:a.pathToModules+"shared/calculatorSteps/views/step.car_settings.tumen.html"},"policy_settings.tumen":{name:"policy_settings.tumen",clearStep:function(){c.contributory_scheme=null,c.is_under_warranty=null,c.payment_form=null,c.is_new_car=null},toNextStep:function(){c.contributory_scheme=u.calculationInterParams.contributory_scheme,c.is_under_warranty=u.calculationInterParams.is_under_warranty,c.payment_form=[u.calculationInterParams.payment_form],c.is_new_car=u.calculationInterParams.is_new_car},getLabelTitle:function(){},templateUrl:a.pathToModules+"shared/calculatorSteps/views/step.policy_settings.tumen.html"},calc:{name:"calc",clearStep:function(){},toNextStep:function(){}}};e.forEach(t.stepsHacks,function(t,i){m[i]&&(m[i]=e.extend({},m[i],t))}),this.getDefaultDriver=o,this.carAllSelected=d,this.getCurrentCalcType=function(){return this.calculationInterParams.calculation_type}.bind(this);var g={activeState:this.brandSteps.first[0],activeStateSecond:this.brandSteps.second[0],activeBigStep:"first"};this.getActiveStep=function(){return m[g.activeState]},this.getCurrentStepIndex=function(e){var t,i,a=u.bigSteps.getBigStep().name;if("first"===a)t=u.getActiveStep();else{if("second"!==a)return null;t=u.getActiveStepSecond()}return i=l(),_.findIndex(i,function(i){return u.getStepObjectByItem(i)===(e||t.name)})},this.getIndexByStep=function(e){var t=l();return e=u.getStepObjectByItem(e),_.findIndex(t,function(t){return t===e})},this._getToggledStep=function(e,t){var i,a=this.getCurrentStepIndex(t),r=(u.bigSteps.getBigStep().name,l());if(a===-1)throw new Error("The brand doesn't contain this step.");return i=r[a+e],this.getStepObjectByItem(i)},this.getCurrentStep=function(){return u._getToggledStep(0)},this.getNextStep=function(){return u._getToggledStep(1)},this._clearByStep=function(e){var i=this.bigSteps.getBigStep().name;_.findLast(t.steps[i],function(t){var i;return t=u.getStepObjectByItem(t),i=t===e,m[t].clearStep(),i})},this.getStepObjectByItem=function(e){return _.isFunction(e)&&e(c)||e},this._toggleSmallStep=function(e,t){var i=this.bigSteps.getBigStep().name,a=this._getToggledStep(e,t);if(a&&"calc"!==a){if("first"===i)return this.setActiveStep(a);if("second"===i)return this.setActiveStepSecond(a)}if(e<0){if("second"===i&&this.bigSteps.setBigStep("first"),"third"===i||"fourth"===i&&"osago"===s)return this.bigSteps.setBigStep("second");"fourth"===i&&this.bigSteps.setBigStep("third")}e>0&&("first"===i&&this.bigSteps.setBigStep("second"),"second"===i&&this.bigSteps.setBigStep("third"),"third"===i&&this.bigSteps.setBigStep("fourth"))},this.calculationInterParams=e.extend({},{engine_power:c.engine_power||120,exploitation_area:c.exploitation_area||null,calculation_type:null,car_cost:c.car_cost||null,drivers:c.driver_set.length?c.driver_set:[],drivers_count:null,drivers_minimal_age:18,drivers_minimal_experience:0,is_earlier_insurance:null,engine_displacement:1,lastDriverIndex:0,currentDriverIndex:0,contributory_scheme:0,payment_form:null,is_under_warranty:null,is_new_car:null,params:{transmission:"Автомат",drive_of_car:"Полный"}},n.calculationInterParamsDefaults),this.toNextSmallStep=this._toggleSmallStep.bind(this,1),this.toPrevSmallStep=this._toggleSmallStep.bind(this,-1),this.setActiveStep=function(e){var t=this.bigSteps.getBigStep().name;this._clearByStep(e),"first"===t&&(g.activeState=e),"second"===t&&(g.activeStateSecond=e)}.bind(this),this.getActiveStepSecond=function(){return m[g.activeStateSecond]},this.getAllSteps=function(){return m},this.setActiveStepSecond=function(e){g.activeStateSecond=e},this.bigSteps={getBigStep:function(){return p[g.activeBigStep]},setBigStep:function(e){g.activeBigStep=e}}}])}(angular),function(e){e.module("person",[])}(angular),function(e){"use strict";e.module("person").factory("Person",["resources","$q","$http","CONSTS",function(t,i,a,r){function n(e){var t;return t="legal_person"===e._personType?["title"]:["first_name","last_name","patronymic","birth_date","gender"],_.pick(e,t)}var s;return s=function(e){e=e||{},"legal_person"===e.personType?(this._personType="legal_person",this._resourcePrefix=t.legalPerson):(this._personType="natural_person",this._resourcePrefix=t.naturalPerson),this.credential=[],this.contact=[],this.address=[],this.extend(e)},s.prototype.extend=function(t){e.extend(this,t)},s.prototype.get=function(e,t){var i=e||this.id||null;if(null===i)throw new Error("id is null!");return a.get(this._resourcePrefix+"/"+e,t).then(function(e){return this.extend(e.data),e.data}.bind(this))},s.prototype.getCredentialList=function(){return this._getList("credential")},s.prototype.getContactList=function(){return this._getList("contact")},s.prototype.getAddressList=function(){return this._getList("address")},s.prototype._getList=function(e){var t;return this.id?a.get(this._resourcePrefix+"/"+this.id+"/"+e).then(function(t){return this[e]=t.data,this[e]}.bind(this)):(t=i.defer(),t.resolve(this[e]),t.promise)},s.prototype.addCredential=function(e){return this._addItem("credential",e)},s.prototype.addContact=function(e){return this._addItem("contact",e)},s.prototype.addAddress=function(e){return this._addItem("address",e)},s.prototype._addItem=function(t,i){if(!e.isArray(this[t]))throw new Error(t+" of person is not array");return this[t].push(i),i},s.prototype.saveCredentialList=function(){return this._saveList("credential")},s.prototype.saveContactList=function(){return this._saveList("contacts")},s.prototype.saveAddressList=function(){return this._saveList("address")},s.prototype._saveList=function(t,r,n){var s=[],l=this;if(this[t])return e.forEach(this[t],function(i){var o,c="post",d=l._resourcePrefix+"/"+l.id+"/"+t;i.id&&(c="put",d+="/"+i.id),o=a[c](d,i),o.then(function(t){return e.extend(i,t.data),t.data}),e.isFunction(r)&&o.then(r),e.isFunction(n)&&o.catch(n),s.push(o)}),i.all(s)},s.prototype.removeContact=function(e){return this._removeItem("contact",e)},s.prototype.removeAddress=function(e){return this._removeItem("address",e)},s.prototype.removeCredential=function(e){return this._removeItem("credential",e)},s.prototype._removeItem=function(e,t){var r=i.defer();return this[e]&&(t.id?a.delete(this._resourcePrefix+"/"+this.id+"/"+e+"/"+t.id).then(function(){this[e]=_.reject(this[e],function(e){return t===e}),r.resolve(this[e])}.bind(this),function(e){r.reject(e)}):(this[e]=_.reject(this[e],function(e){return t===e}),r.resolve(this[e]))),r.promise},s.prototype.save=function(){var e="post",t=this._resourcePrefix;return this.id&&(e="put",t+="/"+this.id),a[e](t,n(this)).then(function(e){return this.extend(e.data),e.data}.bind(this))},s.prototype.remove=function(){var e=i.defer();return this.id?a.delete(this._resourcePrefix+"/"+this.id):(e.reject("Person hasn't id"),e.promise)},s.prototype.saveAll=function(){var e=i.defer();return this.save().then(function(t){var a=[];a.push(this.saveCredentialList()),a.push(this.saveAddressList()),i.all(a).then(function(i){e.resolve({person:t,credential:i[0],address:i[1]})},function(t){e.reject(t)})}.bind(this),function(t){e.reject(t)}),e.promise},s}])}(angular),function(e){"use strict";e.module("person").service("personService",["$http","$q","CONSTS","resources",function(t,i,a,r){return{getNaturalPerson:function(e){return t.get(r.naturalPerson+"/"+e).then(function(e){return e.data})},getNaturalPersonData:function(e){var a={id:e},n=[];return n.push(t.get(r.naturalPerson+"/"+a.id+"/credential").then(function(e){return e.data})),n.push(t.get(r.naturalPerson+"/"+a.id+"/address").then(function(e){return e.data})),n.push(t.get(r.naturalPerson+"/"+a.id+"/contact").then(function(e){return e.data})),i.all(n).then(function(e){var t=e[0],i=e[1],r=e[2];return a.driver_license=_.find(t,function(e){return 3===e.credential_type}),a.passport=_.find(t,function(e){return 1===e.credential_type}),a.address_registration=_.find(i,function(e){return 1===e.address_type}),a.address_residential=_.find(i,function(e){return 2===e.address_type}),a.contactData=function(){var e=_.find(r,function(e){return 1===e.contact_type}),t=_.find(r,function(e){return 2===e.contact_type});return{phone:e,email:t}}(),a})},saveNaturalPersonFull:function(t){var a={},r=_.pick(t,["first_name","last_name","patronymic","birth_date","gender","id","driving_experience_started"]);return a.person=this.saveNaturalPerson(r),t.driver_license&&(e.extend(t.driver_license,{credential_type:3}),a.driver_license=this.saveNaturalPersonCredential(t.id,t.driver_license)),t.passport&&(e.extend(t.passport,{credential_type:1}),a.passport=this.saveNaturalPersonCredential(t.id,t.passport)),t.contactData&&t.contactData.phone&&t.contactData.phone.data&&(a.phone=this.saveNaturalPersonContact(t.id,e.extend(t.contactData.phone,{contact_type:1}))),t.contactData&&t.contactData.email&&t.contactData.email.data&&(a.email=this.saveNaturalPersonContact(t.id,e.extend(t.contactData.email,{contact_type:2}))),t.address_registration&&(e.extend(t.address_registration,{address_type:1}),a.address_registration=this.saveNaturalPersonAddress(t.id,t.address_registration)),t.address_residential&&(e.extend(t.address_residential,{address_type:1}),a.address_residential=this.saveNaturalPersonAddress(t.id,t.address_residential)),i.all(a).then(function(t){var i=e.extend(t.person,t);return delete i.person,i})},saveNaturalPerson:function(e){var i="post",a=r.naturalPerson;return e.id&&(i="put",a+="/"+e.id),t[i](a,e).then(function(e){return e.data})},saveNaturalPersonCredential:function(e,i){var a="post",n=r.naturalPerson+"/"+e+"/credential";return i.id&&(a="put",n+="/"+i.id),t[a](n,i).then(function(e){return e.data})},saveNaturalPersonAddress:function(e,i){var a="post",n=r.naturalPerson+"/"+e+"/address";return i.id&&(a="put",n+="/"+i.id),t[a](n,i).then(function(e){return e.data})},saveNaturalPersonContact:function(e,i){var a="post",n=r.naturalPerson+"/"+e+"/contact";return i.id&&(a="put",n+="/"+i.id),t[a](n,i).then(function(e){return e.data})}}}])}(angular),function(e){e.module("dropdown",[])}(angular),function(e,t){"use strict";e.module("dropdown").constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document",function(e){var t=null;this.open=function(r){t||(e.bind("click",i),e.bind("keydown",a)),t&&t!==r&&(t.isOpen=!1),t=r},this.close=function(r){t===r&&(t=null,e.unbind("click",i),e.unbind("keydown",a))};var i=function(e){if(t){var i=t.getToggleElement();e&&i&&i[0].contains(e.target)||t.$apply(function(){t.isOpen=!1})}},a=function(e){27===e.which&&(t.focusToggleElement(),i())}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate",function(t,i,a,r,n,s){var l,o=this,c=t.$new(),d=r.openClass,u=e.noop,p=i.onToggle?a(i.onToggle):e.noop;this.init=function(e){o.$element=e,i.isOpen&&(l=a(i.isOpen),u=l.assign,t.$watch(l,function(e){c.isOpen=!!e}))},this.toggle=function(e){return c.isOpen=arguments.length?!!e:!c.isOpen,c.isOpen},this.isOpen=function(){return c.isOpen},c.getToggleElement=function(){return o.toggleElement},c.focusToggleElement=function(){o.toggleElement&&o.toggleElement[0].focus()},c.$watch("isOpen",function(i,a){s[i?"addClass":"removeClass"](o.$element,d),i?(c.focusToggleElement(),n.open(c)):n.close(c),u(t,i),e.isDefined(i)&&i!==a&&p(t,{open:!!i})}),t.$on("$locationChangeSuccess",function(){c.isOpen=!1}),t.$on("$destroy",function(){c.$destroy()})}]).directive("dropdown",function(){return{controller:"DropdownController",link:function(e,t,i,a){a.init(t)}}}).directive("dropdownToggle",function(){return{require:"?^dropdown",link:function(e,t,i,a){if(a){a.toggleElement=t;var r=function(r){r.preventDefault(),t.hasClass("disabled")||i.disabled||e.$apply(function(){a.toggle()})};t.bind("click",r),t.attr({"aria-haspopup":!0,"aria-expanded":!1}),e.$watch(a.isOpen,function(e){t.attr("aria-expanded",!!e)}),e.$on("$destroy",function(){t.unbind("click",r)})}}}})}(angular,jQueryApp),function(e){e.module("UIElements",[])}(angular),function(e){"use strict";e.module("UIElements").provider("errorLabelProvider",[function(){var e={title:"Поле не заполнено"},t={fps1:{first_name:{title:"Имя не заполнено"},last_name:{title:"Фамилия не заполнена"},citizenship:{title:"Гражданство не выбрано"},person_document_issue_date:{title:"Дата выдачи документа не заполнена"},document:{title:"Тип документа не выбран"},address_registration:{title:"Не все обязательные поля адреса заполнены"},person_phone:{title:"Телефон не заполнен"}}};this.$get=function(){return{getLabel:function(i,a){return a&&t[i][a]||e}}}}])}(angular),function(e,t){"use strict";e.module("UIElements").directive("inputSlider",["$filter",function(i){function a(a,r,n,s){function l(e){p.slider({min:u?0:f,max:u||h,step:v,slide:function(t,i){e?s.$setViewValue(e[i.value].id):s.$setViewValue(Math.floor(i.value/v)*v)},create:function(){c(f,h),s.$viewValue&&o(s.$viewValue)}})}function o(e){b?b.then(function(t){e="null"===e?null:e,_.find(t,function(t,i){if(t.id==e)return p.slider("option","value",i),!0})}):p.slider("option","value",e)}function c(e,t){b||(p.slider("option","min",e),p.slider("option","max",t)),n.isSum&&(e=i("priceFormatter")(e),t=i("priceFormatter")(t)),m.text(e),g.text(t),p.removeClass("hidden")}function d(){f&&h?c(f,h):p.addClass("hidden")}var u,p=t(r),m=p.find(".js-slider-min"),g=p.find(".js-slider-max"),v=n.sliderStep?n.sliderStep>>0:1e3,f=n.defaultMin?n.defaultMin>>0:0,h=n.defaultMax?n.defaultMax>>0:1e6,b=n.slideItems?a.$eval(n.slideItems):null;p.addClass("b-input-slider"),_.isPromise(b)?(p.addClass("b-input-slider__range"),b.then(function(e){f=_.head(e).title,h=_.last(e).title,u=e.length-1,v=1,l(e)})):l(),a.$watch(function(){return a.$eval(n.inputSlider)},function(t,i){t&&!e.equals(t,i)&&(p.slider("option","value",t.sum),t.maxSum&&t.minSum?(p.slider("option","min",t.minSum),p.slider("option","max",t.maxSum),c(t.minSum,t.maxSum)):d())},!0),a.$watch(function(){return s.$viewValue},function(e,t){o(e)})}return{restrict:"EA",require:"ngModel",link:a,scope:!1,template:'<div class="b-input-slider_range"><span class="b-input-slider_min js-slider-min"></span><span class="b-input-slider_max js-slider-max"></span></div>'}}])}(angular,jQueryApp),function(e,t){"use strict";e.module("UIElements").directive("semCheckbox",["$compile",function(i){var a=100;return{restrict:"EA",require:"ngModel",replace:!0,scope:!1,template:'<div class="ui checkbox"><input type="checkbox" tabindex="0" class="hidden sem-checkbox"><label></label></div>',compile:function(r,n,s){var l,o=t(r),c=o.find(".sem-checkbox"),d=o.find("label"),u=n.semId,p="sem-id-"+a++;return o.removeAttr("sem-checkbox"),e.forEach(n.$attr,function(e,t){["class","semType","style"].indexOf(t)===-1?(c.attr(e,n[t]),o.removeAttr(e)):n[t]&&o.addClass(n[t])}),"radio"===n.semType&&c.attr("type","radio"),u?(d.attr("for",u),c.attr("id",u)):(d.attr("for",p),c.attr("id",p)),d.html(n.semLabel),l=i(o),{pre:function(e){l(e)}}}}}])}(angular,jQueryApp),function(e,t){"use strict";e.module("UIElements").directive("semDropdown",["$timeout","$q",function(i,a){return{restrict:"EA",require:"^ngModel",replace:!0,template:'<div><input type="hidden"><i class="dropdown icon"></i><div class="text"><span ng-bind="placeholder"></span></div><div class="menu"></div></div>',scope:{items:"=semDropdownItems",placeholder:"@semDropdownPlaceholder"},link:function(i,r,n,s){function l(t){g.empty(),!i.placeholder||v||f||g.append(d({id:"",title:i.placeholder})),e.forEach(t,function(e){var t={id:e.id,title:e.title,item_type:e.item_type};h&&(t={id:e,title:e}),g.append(d(t))}),t&&t.length||u.addClass("disabled js-was-empty")}function o(e,t){function i(t){var i,a=_.find(t,function(t){var i=h?t:t.id;return i==e});return i=a?h?a:a.id:null,c(i),i}return t?i(t):p.promise.then(i)}function c(t){var i;i=e.isArray(t)?_.map(t,function(e){return e+""}):void 0==t?"":t+"",u.dropdown("set selected",i)}function d(e){var t=e.item_type||"item";return'<div class="'+t+'" data-value="'+e.id+'"><span>'+e.title+"</span></div>"}var u=t(r),p=a.defer(),m=[],g=u.find(".menu"),v=u.hasClass("multiple"),f=u.hasClass("placeholder-is-not-item"),h=!!n.semDropdownSimple;i.items||console.log("У этого элемента нет поля items ",r[0]),i.items&&(_.isPromise(i.items)?i.items.then(p.resolve):_.isArray(i.items)?p.resolve(i.items):_.isFunction(i.items)&&i.items().then(function(t){return m=t,p.resolve(m.items),i.$watch(function(){return m.changingCondition()},function(t,i){var a,r;if(!e.equals(t,i))return a=m.items,m.action({items:a},t),r=a&&a[0]&&a[0].id,l(a),u.dropdown("refresh"),r&&u.hasClass("js-was-empty")&&(u.removeClass("disabled"),o(s.$viewValue)),"null"!==n.semDropdownDefaultValue&&r?o(s.$viewValue,a)||c(r):void c(null)},!0),t})),u.hasClass("selection")||u.find(".icon.dropdown").remove(),p.promise.then(function(e){l(e),u.dropdown({selectOnKeydown:!1,fullTextSearch:!0,forceSelection:!1,match:"text",onChange:function(e){var t=e;"false"!==e&&"true"!==e||(t=JSON.parse(e)),s.$setViewValue(t)},message:{addResult:"Добавить <b>{term}</b>",count:"{count} выбрано",maxSelections:"Доступно {maxCount}",noResults:"Совпадений не найдено."},className:{label:"ui red label"},action:n.semDropdownAction}),c(s.$viewValue)}),i.items&&(e.isFunction(i.items)||e.isFunction(i.items.then))||i.$watch("items",function(e,t){e&&e.length&&(1!==p.promise.$$state.status?p.resolve(e):l(e),u.hasClass("js-was-empty")&&(u.removeClass("disabled"),o(s.$viewValue)))},!0),i.$watch(function(){return s.$viewValue},function(t,i){var a=u.dropdown("get value");t==a&&!_.isBoolean(t)&&!_.isNumber(t)||e.equals(t,a)||(void 0==t||v?c(s.$viewValue):o(t))})}}}])}(angular,jQueryApp),function(e,t){"use strict";e.module("UIElements").directive("semErrorLabel",["errorLabelProvider",function(e){function i(i,a,r){function n(e){o.text(e.title),e.class&&o.addClass(e.class),o.addClass("sem-error-label")}var s,l,o=t(a),c=r.labelNamespace;if(!c)throw new Error("Не задана область видимости");s=function(){var e=o.siblings("input"),t="attr";return e.length||(e=o.siblings(".ui.input").find("input").eq(0),e.length||(e=o.siblings(".dropdown"),t="data",e.length||(e=o.siblings(".js-label-target")))),e[t]("name")}(),l=e.getLabel(c,s),n(l)}return{restrict:"EA",link:i,replace:!0,template:'<div class="ui top pointing basic label"></div>'}}])}(angular,jQueryApp),function(e,t){"use strict";e.module("UIElements").directive("semPopup",[function(){return{restrict:"EA",scope:{content:"@semPopupContent",title:"@semPopupTitle",variation:"@semPopupVariation",position:"@semPopupPosition"},compile:function(){return{pre:function(e,i,a,r){var n=t(i),s={content:e.content,title:e.title,variation:e.variation,position:e.position?e.position:"top center"};"UNPUT"===i.tagName&&(s.on="focus"),n.popup(s)}}}}}])}(angular,jQueryApp),function(e){e.module("appMessage",[])}(angular),function(e){e.module("appMessage").factory("Messages",["$rootScope","$timeout",function(e,t){function i(i,n,s,l){var o={type:i,msg:n,close:function(){r(a(this))},isList:l};e.aborting||(e.messages.push(o),void 0!==s&&s>0&&t(o.close,s))}function a(t){return e.messages.indexOf(t)}function r(t){e.messages.splice(t,1)}return e.messages=[],{error:function(e,t,a){i("error",e,t,a)},warning:function(e,t,a){i("warning",e,t,a)},info:function(e,t,a){i("info",e,t,a)},success:function(e,t,a){i("success",e,t,a)}}}])}(angular),function(e){e.module("appMessage").directive("messages",["CONSTS",function(e){return{restrict:"EA",replace:!0,templateUrl:e.pathToModules+"shared/appMessage/views/messages_template.html"}}])}(angular),function(e){"use strict";e.module("priceSlider",[])}(angular),function(e,t){"use strict";e.module("priceSlider").directive("priceSlider",["$timeout",function(e){function i(i,a,r,n){var s=t(a),l=t(i.popoversQuery),o=t(".car_price-bg-line"),c=s.slider({min:i.minCarPrice||0,max:i.maxCarPrice||1e6,step:1e3,slide:function(e,t){n.$setViewValue(1e3*Math.floor(t.value/1e3)),t.handle&&o.css("width",t.handle.style.left)},change:function(t,i){e(function(){i.handle&&o.css("width",i.handle.style.left)},0)},create:function(e,i){t(this).find(".ui-slider-handle").append(l)}});i.$watch(function(){return n.$viewValue},function(e,t){e&&e!==t&&(c.slider("value",e),i.modelCarCost=e)}),i.$watch("minCarPrice",function(e){void 0!==e&&(s.slider("option","min",+(e||0)),c.slider("value",n.$viewValue))}),i.$watch("maxCarPrice",function(e){void 0!==e&&(s.slider("option","max",+(e||0)),c.slider("value",n.$viewValue))}),i.changeModelCarCost=function(){n.$setViewValue(i.modelCarCost)},i.keyupModelCarCost=function(e){13===e.keyCode&&i.changeModelCarCost()},i.$on("$destroy",function(e){s.slider("destroy")})}return{restrict:"EA",require:"ngModel",link:i,scope:{minCarPrice:"=",maxCarPrice:"=",popoversQuery:"="},template:'<div hidden><div class="car_price-popover"><input price-formatter type="text" ng-model="modelCarCost" ng-keyup="keyupModelCarCost($event)" ng-blur="changeModelCarCost()" class="car_price-popover-input"><span class="car_price-popover-triangle"></span></div></div><div class="car_price-bg-line"></div><div class="car_price-min_value">{{(minCarPrice) | priceFormatter}}р.</div><div class="car_price-max_value">{{(maxCarPrice) | priceFormatter}}р.</div>'
}}])}(angular,jQueryApp),function(e){"use strict";e.module("dadata",[])}(angular),function(e,t){"use strict";e.module("dadata").directive("dadata",["$timeout",function(e){function i(i,a,r){function n(e){o.append(t("<div/>").text(e)),o.show()}var s=r.dadataType,l=t(a),o=l.find(".js-dadata-messages");o.hide(),t(a).find("[dadata-target]").suggestions({serviceUrl:"https://dadata.ru/api/v2",token:"840fc8bdabac6c26db9271f4a37906560d23e690",type:s.toUpperCase(),onSelect:function(t){var a=t.data;o.empty(),o.hide(),"address"===s&&(e(function(){i.targetObj.full=t.value},200),i.targetObj.street=a.street_with_type||null,i.targetObj.city=a.region_with_type||null,i.targetObj.kladr=a.kladr_id||null,i.targetObj.house=a.house||null,i.targetObj.housing=a.block||null,i.targetObj.flat=a.flat||null,i.targetObj.postal_index=a.postal_code||null,i.targetObj.house||n("Введите номер дома."),i.targetObj.city||n("Введите название города или области."),i.targetObj.street||n("Введите название улицы."))}})}return{restrict:"A",link:i,scope:{targetObj:"=dadata"}}}])}(angular,jQueryApp),function(e){e.module("mainContent",[])}(angular),function(e){e.module("carFilter",[])}(angular),function(e){"use strict";e.module("carFilter").controller("carFilterCtrl",["$scope","Dictionary","$rootScope","calculatorService","calculatorStepsService","CONSTS","$http","moduleType",function(e,t,i,a,r,n,s,l){function o(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")}function c(){var t=(new Date).getFullYear()-e.calculation.car_manufacturing_year;e.calculationInterParams.mileage=e.calculationInterParams.mileage||2e4*t}function d(t){t&&(e.calculationInterParams.exploitation_area=t.id,e.calculationInterParams.exploitation_area_title=t.title)}var u=new Date,p=i.currentBrand;e.calculatorParams=a.calculatorOtherParams,e.carFilterStep=1,e.selectedCar={},e.calculation=a.calculation,e.carFilterTemplates=r.bigsStepsTepmplates,e.clientParams={client_name:"",client_phone:"",sms_is_visible:!1,client_params_are_disabled:!1},e.showSMSform=function(){e.clientParams.client_params_are_disabled=!0,e.calculation.client_name=e.clientParams.client_name,e.calculation.client_phone=e.clientParams.client_phone,s({url:n.proxyPathC+"smsc/sendcode.php",method:"POST",transformRequest:o,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:{phone_no:e.clientParams.client_phone}}).then(function(t){_.isString(t.data)&&/(отправлен)/.test(t.data)&&(e.clientParams.sms_is_visible=!0),e.clientParams.client_params_are_disabled=!1})},e.calculateKaskoCarFilter=function(){e.$parent.calculateKasko()},e.confirmCode=function(){e.clientParams.sms_button_is_disabled=!0,e.calculatorParams.confirm_code_is_incorrect=!1,s({url:n.proxyPathC+"smsc/verify.php",method:"POST",transformRequest:o,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},data:{code:e.clientParams.sms_code}}).then(function(t){_.isString(t.data)&&/(Код проверки верный)/.test(t.data)?e.calculatorParams.resultsAreVisible=!0:e.calculatorParams.confirm_code_is_incorrect=!0,e.clientParams.sms_button_is_disabled=!1})},e.driversChanging=[{id:1,title:"1 водитель"},{id:2,title:"2 водителя"},{id:3,title:"3 водителя"},{id:4,title:"4 водителя"},{id:0,title:"Без ограничений"}],e.bigSteps=r.bigSteps,e.mainRegions=[],e.calculationInterParams=r.calculationInterParams,e.carFilterParams={brandSteps:r.brandSteps,allSteps:r.getAllSteps(),ownerRegistrationViewIsFull:!1,selectedResult:function(){return a.getSelectedResult()},was_clicked:!1,setIsEarlierInsurance:function(t){e.calculationInterParams.is_earlier_insurance=!!t,e.toNextStep("is_earlier_insurance")},setIsCredit:function(t){e.calculationInterParams.is_credit=!!t,e.toNextStep("is_credit")}},e.calcTypes=[{id:"simple",title:"Примерный"},{id:"full",title:"Точный (с данными КБМ водителей)"}],e.onKeypressDecorator=function(e,t){if(13==e.keyCode&&"function"==typeof t)return t},e.setCalculationType=function(t){e.calculationInterParams.calculation_type=t},e.goNextDriver=function(t){var i=t+1;return e.calculationInterParams.driverIsEditing?(e.calculationInterParams.currentDriverIndex=e.calculationInterParams.lastDriverIndex,void(e.calculationInterParams.driverIsEditing=!1)):(e.calculation.driver_set[t]=e.calculationInterParams.drivers[t],void(e.calculationInterParams.drivers_count&&e.calculationInterParams.drivers_count.id===i?e.toNextStep("drivers"):(e.calculationInterParams.currentDriverIndex=i,e.calculationInterParams.lastDriverIndex=i)))},e.toEditDriver=function(t){var i=e.calculationInterParams.currentDriverIndex;e.calculationInterParams.currentDriverIndex=t,e.calculationInterParams.driverIsEditing=!0,e.calculationInterParams.lastDriverIndex=i},e.getActiveButtonClass=function(e){return e&&"active"||""},e.getCurrentStepObject=function(t){return t=r.getStepObjectByItem(t),e.carFilterParams.allSteps[t]},e.getCurrentStepIndex=r.getCurrentStepIndex,e.getIndexByStep=r.getIndexByStep,e.changeDriversCount=function(t){e.calculationInterParams.drivers_count=t,e.calculation.drivers_count=t.id,e.calculationInterParams.drivers.length=0,e.calculation.driver_set.length=0,e.calculation.is_multidrive=!e.calculation.drivers_count,t.id&&(_.times(t.id,function(){e.calculationInterParams.drivers.push(r.getDefaultDriver())}),e.calculationInterParams.currentDriverIndex=0),e.toNextStep("drivers_count")},e.toNextStep=function(t){var i=r.getNextStep(),a=r.getCurrentStep(),n=e.bigSteps.getBigStep().name;return e.carFilterParams.allSteps[a].toNextStep(),!i&&"second"==n&&"kasko"===l||"calc"===i?(e.calculateKaskoCarFilter(),r.toNextSmallStep("calc")):void r.toNextSmallStep(t)},e.isEarlierInsuranceNext=function(){e.calculation.is_earlier_insurance=e.calculationInterParams.is_earlier_insurance,e.setActiveStep("is_earlier_insurance")},e.activeStep={},e.getActiveStep=function(){return e.activeStep=r.getActiveStep(),e.activeStep},e.getActiveStepSecond=function(){return e.activeStepSecond=r.getActiveStepSecond(),e.activeStepSecond},e.setActiveStep=r.setActiveStep,e.toggleOwnerRegistrationView=function(){e.carFilterParams.ownerRegistrationViewIsFull=!e.carFilterParams.ownerRegistrationViewIsFull},e.selectExploitationArea=function(t){t=t||e.calculationInterParams.exploitation_area,e.exploitationArea.then(function(i){var a=_.find(i,function(e){return e.id==t});d(a),e.toNextStep("exploitation_area")})},e.selectOwnerRegistration=function(t){t=t||e.calculationInterParams.owner_registration,e.ownerRegistration.then(function(i){var a=_.find(i,function(e){return e.id==t});d(a),e.toNextStep("owner_registration")})},e.selectIsEarlierInsurance=function(t){e.calculationInterParams.is_earlier_insurance=t,e.isEarlierInsuranceNext()},e.driversDateChanged=function(e){var t=new Date(e.birth_date),i=new Date(e.driving_experience_started),a=(new Date).setFullYear((new Date).getFullYear()-77),r=i<a,n=5679936e5;t.setDate(t.getDate()+1),e.dateIsInvalid=i-t<n||r},e.getYearRange=function(e,t){var i,a,r=new Date;return e=e||0,t=void 0===t?90:t,a=r.getFullYear()-t,i=r.getFullYear()-e,a+":"+i},e.exploitationArea=t.getItems("exploitationArea").then(function(t){t=t.results?t.results:t;var a;return e.calculation.exploitation_area&&(a=_.find(t,function(t){return t.id==e.calculation.exploitation_area}),d(a)),e.mainRegions=_.map(p.exploitation_areas,function(e){return _.find(t,function(t){return t.id===e})}),"tumen"===i.currentBrandName&&_.forEach(e.mainRegions,function(e){e.id===i.currentBrand.exploitation_areas[0]&&(e.title="Тюменская область")}),t}),e.ownerRegistration=t.getItems("ownerRegistration").then(function(t){t=t.results?t.results:t;var i;return e.calculation.owner_registration&&(i=_.find(t,function(t){return t.id==e.calculation.owner_registration}),d(i)),e.mainOwnerRegistrations=_.map(p.owner_registrations,function(e){return _.find(t,function(t){return t.id===e})}),t}),t.getItems("transmission").then(function(t){e.carFilterParams.transmission=t}),t.getItems("driveOfCar").then(function(t){e.carFilterParams.driveOfCar=t}),t.getItems("contributoryScheme").then(function(t){t=t.results||t,e.carFilterParams.contributoryScheme=_.map(i.currentBrand.contributory_schemas,function(e){return _.find(t,function(t){return t.id===e})})}),t.getItems("yesNo").then(function(t){e.carFilterParams.yesNo=t}),e.isInit=!1,e.carSearch={title:""},e.allSelected=r.carAllSelected,e.setCarFilterStep=function(t){e.carFilterStep=t},e.monYears=_.range(u.getFullYear(),u.getFullYear()-55,-1),e.selectMonYear=function(t){_.isNil(t)||(e.calculation.car_manufacturing_year=e.monYears[t]),c(),r.toNextSmallStep("year")},e.$watch("carModel",function(t){t&&(e.monYearAction=e.carModel)},!0)}])}(angular),function(e){"use strict";e.module("carFilter").directive("carFilter",["CONSTS",function(e){return{restrict:"EA",require:"ngModel",scope:{modelCarMark:"=cfModelCarMark",modelCarModel:"=cfModelCarModel",modelCarModelGroup:"=cfModelCarModelGroup",modelCarCost:"=cfModelCarCost",isInvalid:"="},controller:"carFilterCtrl",templateUrl:e.pathToModules+"shared/carFilter/views/car_filter.html"}}])}(angular),function(e){"use strict";e.module("carFilter").directive("carGroupModelsList",["CONSTS","Dictionary","carFilter","calculatorStepsService",function(e,t,i,a){function r(e,i,r,n){e.carModelGroups=[],e.$watch("carMarkId",function(i){i&&(e.carModelGroups=[],t.getItems("carModelGroups",{car_mark:i}).then(function(t){t=t.results?t.results:t,e.$parent.modelGroups=t,e.carModelGroups=t}))}),e.selectCarModelGroup=function(t,i){if(t)return n.$setViewValue(t.id),e.$parent.$parent.allSelected.carModelGroup=t,i||a.toNextSmallStep("car_model_group"),!1},e.$watch(function(){return n.$viewValue},function(i,a){i&&t.getItems("carModelGroups",{car_mark:e.carMarkId}).then(function(t){var a;t=t.results?t.results:t,a=_.find(t,function(e){return e.id===i}),e.selectCarModelGroup(a,!0)})})}var n=i.getDefaults();return{restrict:"EA",require:"ngModel",scope:{orderBy:"@",columns:"@",carMarkId:"=",isInvalid:"=",carManufacturingYear:"="},templateUrl:e.pathToModules+"shared/carFilter/views/car_filter.car_group_models_list.html",compile:function(e,t){return void 0===t.columns&&(t.columns=n.columns),void 0===t.orderBy&&(t.orderBy=n.orderBy),r}}}])}(angular),function(e){"use strict";e.module("carFilter").directive("carManufacturingYears",["CONSTS","carFilter",function(e,t){return{restrict:"EA",require:"ngModel",templateUrl:e.pathToModules+"shared/carFilter/views/car_filter.car_manufacturing_years.html"}}])}(angular),function(e){"use strict";e.module("carFilter").directive("carMarksList",["CONSTS","Dictionary","carFilter","calculatorStepsService",function(t,i,a,r){function n(t,a,n,l){t.carMarks=[],t.maxCarMarksLimit=9999,t.carMarksLimit=t.limit||s.popularCarMarks.length||s.limit,i.getItems("carMarks").then(function(e){e=e.results?e.results:e,t.carMarks=e,t.maxCarMarksLimit=e.length}),t.toggleAllMarks=function(){t.carMarksLimit=t.carMarksLimit===t.limit?t.maxCarMarksLimit:t.limit},t.selectCarMark=function(e,i){if(e)return l.$setViewValue(e.id),t.$parent.allSelected.carMark=e,i||r.toNextSmallStep("car_mark"),!1},!s.popularCarMarks||e.isArray(s.popularCarMarks)&&0===s.popularCarMarks.length?t.filterByPopularity=function(){return!0}:t.filterByPopularity=function(e){return!!(t.carMarksLimit!==t.limit||t.$parent.carSearch&&t.$parent.carSearch.title)||s.popularCarMarks.indexOf(e.id)!==-1},t.$watch(function(){return l.$viewValue},function(e,a){e!=a&&i.findItem("carMarks",e).then(function(e){t.selectCarMark(e,!0)})})}var s=a.getDefaults();return{restrict:"EA",require:"ngModel",scope:{orderBy:"@",limit:"@",columns:"@",carMarkSelected:"=ngModel",selectHandler:"=",isInvalid:"="},templateUrl:t.pathToModules+"shared/carFilter/views/car_filter.car_marks_list.html",compile:function(e,t){return void 0===t.limit&&(t.limit=s.popularCarMarks.length||s.limit),void 0===t.columns&&(t.columns=s.columns),void 0===t.orderBy&&(t.orderBy=s.orderBy),n}}}])}(angular),function(e){"use strict";e.module("carFilter").directive("carModelsList",["CONSTS","Dictionary","carFilter","calculatorStepsService",function(e,t,i,a){function r(e,i,r,n){e.carModels=[],e.selectedModelId={},e.$watch("carModelGroupId",function(i){i&&(e.carModels=[],t.getItems("carModelsByGroup",{car_mark:e.carMarkId,car_model_group:i}).then(function(t){t=t.results?t.results:t,e.$parent.carModel=t,e.carModels=t}))}),e.selectCarModel=function(t,i){if(t)return i&&(a.toNextSmallStep("car_model"),e.$parent.$parent.isInit=!0),n.$setViewValue(t.id),e.selectedModelId=t.id,e.$parent.$parent.allSelected.carModel=t,!1},e.$watch(function(){return n.$viewValue},function(i,a){i&&t.getItems("carModelsByGroup",{car_mark:e.carMarkId,car_model_group:e.carModelGroupId}).then(function(t){t=t.results?t.results:t;var a;a=_.find(t,function(e){return e.id===i}),e.selectCarModel(a)})})}var n=i.getDefaults();return{restrict:"EA",require:"ngModel",scope:{orderBy:"@",columns:"@",carMarkId:"=",carModelGroupId:"=",isInvalid:"=",carManufacturingYear:"="},templateUrl:e.pathToModules+"shared/carFilter/views/car_filter.car_models_list.html",compile:function(e,t){return void 0===t.columns&&(t.columns=n.columns),void 0===t.orderBy&&(t.orderBy=n.orderBy),r}}}])}(angular),function(e){"use strict";e.module("carFilter").provider("carFilter",[function(){var t={popularCarMarks:[4740,291,294,4737,297,303,3763,456,312,315,318,324,40612,330,333,336,339,3908,342,35526,345,348,351,354,357,360,363,366,372,375,3911,585,381,384,390,393,396,399,402,411,414,30590,426,429,432,435,438,441,444,447,450,552,33327,555,564,558],limit:72,columns:6,orderBy:"title"};this.setDefaults=function(i){e.extend(t,i)},this.$get=function(){return{getDefaults:function(){return t}}}}])}(angular),function(e){"use strict";e.module("carFilter").filter("carFilterYears",function(){return function(e,t){var i=[];e=e||[];for(var a=0,r=e.length;r>a;a++){var n=e[a].start_manufacturing_year,s=e[a].stop_manufacturing_year;t>=n&&t<=s&&i.push(e[a])}return i}})}(angular),function(e){e.module("preCalculator",[])}(angular),function(e){"use strict";e.module("preCalculator").controller("preCalculatorCtrl",["$scope","$state",function(e,t){e.typesToSelect={first:{title:"Планируете приобрести авто в РОЛЬФ",name:"first"},second:{title:"Планируете приобрести авто у другого Дилера",name:"second"}},e.preCalculatorParams={selectedType:null,is_second_step:!1,currentStep:"first",toNextStep:function(){"first"===e.preCalculatorParams.selectedType?t.go("index.postCalculator"):t.go("index.calculator.kasko")}}}])}(angular),function(e){e.module("postCalculator",[])}(angular),function(e){"use strict";e.module("postCalculator").controller("postCalculatorCtrl",["$scope","addingDocumentsService","Messages",function(e,t,i){e.postCalculatorParams={client_name:"",client_phone:"",message:""},e.preSendToManager=function(){var a=new FormData,r="",n=e.postCalculatorParams.client_name,s=e.postCalculatorParams.client_phone,l=e.postCalculatorParams.message;r+="Клиент просит ему перезвонить.\n\n",r+="Имя клиента: "+n+"\n",r+="Телефон клиента: "+s+"\n\n",r+="Сообщение: "+l+"\n\n",a.append("message",r),t.send(a).then(function(){e.postCalculatorParams.button_is_disabled=!0,e.postCalculatorParams.is_visible=!0,i.success("Ваш запрос принят. Мы свяжемся с вами в ближайшее время.",6e3)},function(){e.postCalculatorParams.button_is_disabled=!0,i.error("Не удалось отправить запрос.",6e3)})}}])}(angular),function(e){"use strict";e.module("postCalculator").controller("postCalculatorCtrl",["$scope","addingDocumentsService","Messages",function(e,t,i){e.postCalculatorParams={client_name:"",client_phone:"",message:"",carMark:!1},e.setCarMark=function(t){e.postCalculatorParams.carMark=t},e.preSendToManager=function(){var a=new FormData,r="",n=e.postCalculatorParams.client_name,s=e.postCalculatorParams.client_phone,l=e.postCalculatorParams.carMark;r+="Клиент просит ему перезвонить.\n\n",r+="Имя клиента: "+n+"\n",r+="Телефон клиента: "+s+"\n\n",r+="Марка: "+l+"\n\n",a.append("message",r),a.append("addressType",l),t.send(a).then(function(){e.postCalculatorParams.button_is_disabled=!0,e.postCalculatorParams.is_visible=!0,i.success("Ваш запрос принят. Мы свяжемся с вами в ближайшее время.",6e3)},function(){e.postCalculatorParams.button_is_disabled=!0,i.error("Не удалось отправить запрос.",6e3)})}}])}(angular),function(e){e.module("calculatorSteps",[])}(angular),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.kasko/calculatorC/views/calculation.form.html",'<div ui-view="step_2" ng-if="[\'first\', \'second\'].indexOf(bigSteps.getBigStep().name) !== -1"></div><div ui-view="step_3"></div><div ui-view="step_4" ng-if="getCurrentCalcType() === \'full\'"></div><div ui-view="step_5" ng-if="getCurrentCalcType() === \'simple\'"></div><div ui-view="step_6" ng-show="getCurrentCalcType()"></div><div ng-include="templates.program_list" class="js-kasko-result" ng-show="params.resultsAreVisible && bigSteps.getBigStep().name === \'third\'"></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.kasko/calculatorC/views/calculation.program_list.html",'<div ng-include="templates.program_list_manager" class="mt60"></div><div class="c-tac b-content-loading mt40" ng-if="!calculationResult.length"><i class="spinner loading icon big grey" tabindex="0" style="font-size: 40px;"></i></div><div class="ui form b-full-width-bg_white mt70 pos-rel" ng-if="calculationResult.length"><div move-to-step=""></div><div class="p20"><div class="b-results"><div class="ui grid five column stackable"><div class="b-result-kasko column pb80 pt20" align="center" ng-repeat="result in calculationResult | limitTo:5" ng-class="\'b-result-kasko--index-\' + $index"><div><div class="b-result-kasko_best-price"><span>Лучшая цена!</span></div><div class="b-result-kasko_head" title="{{result.insurance_company.title}}"><div class="b-result-kasko_insurance_company-logo mb5"><img ng-src="{{result.company_logo}}" alt=""></div><div class="b-result-kasko_insurance_company-title mb20 mt15"><h3><span ng-bind="result.insurance_company.title"></span></h3></div></div><div class="b-result-kasko_sum mt10 mb20 nowrap"><h3><span><span ng-bind="result.program.sum | priceFormatter:0:\'\':false"></span>. <small ng-bind="result.program.sum | fractionalFormatter:2"></small> руб.</span></h3></div><div class="b-result-kasko_option_set"><div ng-repeat="option in result.program.option_set | filter:{\'is_active\': true}"><span ng-bind="option.title"></span></div></div><div class="b-result-kasko_actions" align="center"><button class="ui button green small" title="Перейти к заказу" ng-click="selectResult(result.id)" type="button">Выбрать</button></div></div></div></div></div></div></div><div class="p20 mt30" ng-if="root.messages.length"><div class="ui error message"><ul class="list"><li ng-repeat="message in root.messages"><span ng-bind="message"></span></li></ul><i class="close icon" ng-click="root.messages.length = 0;"></i></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.kasko/calculatorC/views/kasko/calculation.step_2.html",'<div class="ui form b-full-width-bg_white css-small-sized-fields"><div class="p20"><div class="ui doubling stackable grid four column bottom aligned"><div class="column"><div class="field" align="left"><label for="id_is_legal_entity">Тип страхователя:</label><div class="ui search selection dropdown" id="id_is_legal_entity" sem-dropdown="" ng-model="calculation.is_legal_entity" sem-dropdown-items="dicts.isLegalEntity"></div></div></div><div class="column"><div class="field"><label>Срок страхования:</label><div class="ui search selection dropdown" id="id_insurance_duration" sem-dropdown="" ng-model="calculation.insurance_duration" sem-dropdown-items="dicts.insuranceDuration"></div></div></div><div class="column"><div class="field"><label for="id_calculation_at_date">Дата начала действия договора:</label><div class="ui icon input"><input type="text" jdatepicker="" jdatepicker-year-range="{{getYearRange(-1, 0)}}" jdatepicker-only-future="true" placeholder="__.__.____" id="id_calculation_at_date" required="" ng-model="calculation.calculation_at_date"> <i class="icon calendar circular branded inverted"></i></div></div></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.kasko/calculatorC/views/kasko/calculation.step_3.html",'<div class="css-cars-filter b-full-width-bg m0 mt30" ng-class="\'css-cars-filter--step-\' + bigSteps.getBigStep().name" style="font-size: 15px;" ng-show="!params.resultsAreVisible || bigSteps.getBigStep().name !== \'third\'"><div class="p20"><car-filter cf-model-car-mark="calculation.car_mark" cf-model-car-model="calculation.car_model" cf-model-car-model-group="calculation.car_model_group" cf-model-car-cost="calculation.car_cost"></car-filter></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.kasko/calculatorC/views/kasko/calculation.step_6.html",'<div class="ui form b-full-width-bg_white"><div class="p20"><div class="ui grid stackable four column bottom aligned"><div class="row"><div class="twelve wide column">&nbsp;</div><div class="column" align="right"><div class="field"><button class="button ui green" style="margin-right: 0;" ng-click="calculateKasko()" ng-class="{loading: params.isCalculationProgress}" ng-disabled="calculation_form.$invalid || disabledSubmitButton()" type="button">Рассчитать</button></div></div></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.kasko/calculatorStepsC/views/second_big_step.html",'<div><div class="ui large labels" ng-class="$root.currentBrand.steps_buttons_color"><div class="ui label basic mb10" ng-repeat="item in carFilterParams.brandSteps.second" ng-show="getCurrentStepObject(item).getLabelTitle()"><span ng-bind="getCurrentStepObject(item).getLabelTitle()"></span> <i class="icon delete" ng-click="setActiveStep(getCurrentStepObject(item).name)" ng-keydown="$event.keyCode == 13 && setActiveStep(getCurrentStepObject(item).name)" tabindex="0"></i></div></div><div class="p20" ng-show="getActiveStepSecond().name !== carFilterParams.brandSteps.second[0]"><div class="ui divider" style="border-top-style: dashed;"></div></div><div ng-repeat="item in carFilterParams.brandSteps.second" ng-show="getCurrentStepObject(item).name === getActiveStepSecond().name" ng-class="\'show-active-\' + getCurrentStepObject(item).name" ng-include="getCurrentStepObject(item).templateUrl"></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/calculatorO/views/calculation.form.html",'<div ui-view="step_2" ng-show="bigSteps.getBigStep().name === \'first\'"></div><div ui-view="step_3"></div><div ng-show="bigSteps.getBigStep().name === \'first\'"><div ui-view="step_4" ng-if="getCurrentCalcType() === \'full\'"></div><div ui-view="step_5" ng-if="getCurrentCalcType() === \'simple\'"></div><div ui-view="step_6" ng-show="getCurrentCalcType()"></div><div class="js-kasko-result" ng-include="templates.program_list" ng-show="getCurrentCalcType()"></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/calculatorO/views/osago/calculation.program_list.html",'<div ng-show="params.resultsAreCreated && !calculationResult.length"><h2 class="b-content_title c-tac mb40">К сожалению, мы не можем оформить ОСАГО на данный автомобиль</h2></div><div class="ui form b-full-width-bg_white" ng-if="calculationResult.length"><div class="p20"><div><table class="b-kasko-result ui very basic table"><tr><td><h4 ng-show="getResultWithKbm().variables.KBM.length || getResultWithKbm().variables.kbm">КБМ:</h4></td><td class="c-tar"></td></tr><tr><td><h3 class="b-content_title mt5" ng-repeat="kbm in getResultWithKbm().variables.KBM track by $index"><span ng-bind="cachedDrivers[$index].last_name"></span> <span ng-bind="cachedDrivers[$index].first_name"></span> <span ng-if="cachedDrivers[$index].last_name">—</span> <span ng-bind="kbm"></span></h3><div ng-if="!cachedDrivers.length"><span ng-bind="getResultWithKbm().variables.kbm"></span></div></td><td></td></tr></table></div><div class="css-divider-tilde ui divider horizontal header">~</div><div><h1 class="b-content_title c-tac">Выберите компанию для оформления договора:</h1><div class="ui grid three column mt30"><div class="b-result column" align="center" tabindex="0" ng-repeat="result in calculationResult" ng-if="result.program.sum && result.program.sum != 0" ng-mousedown="selectResult(result.id)" ng-keypress="$event.keyCode == 13 && selectResult(result.id)" ng-class="{\'b-result--selected\': result.id === root.selectedResult.id}"><div><img ng-src="{{result.company_logo}}" alt=""><div class="b-result_select"><i class="icon checkmark"></i></div><div class="b-result_sum c-tac mt5"><span ng-bind="setSumWithOtherKbm(result) | priceFormatter:0:\'\':false"></span>.<small ng-bind="setSumWithOtherKbm(result) | fractionalFormatter:2"></small> руб.</div></div></div></div><div class="mt55 c-tac"><button class="m0 ui button" ng-class="[params.isCalculationProgress ? \'loading\' : \'\', ($root.currentBrand.download_documents_button || $root.currentBrand.main_buttons_color)]" ng-disabled="disabledFormationPolicyButton() || calculation_form.$invalid || !calculationResult.length || !root.selectedResult" ng-click="bigSteps.setBigStep(\'second\')" type="button"><span></span> Загрузить<br><strong>документы</strong></button></div></div></div></div><div class="p20 mt30" ng-if="root.messages.length"><div class="ui error message"><ul class="list"><li ng-repeat="message in root.messages"><span ng-bind="message"></span></li></ul><i class="close icon" ng-click="root.messages.length = 0;"></i></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/calculatorO/views/osago/calculation.step_2.html",'<div class="ui form b-full-width-bg_white css-small-sized-fields"><div class="p20"><div class="ui stackable grid four column bottom aligned"><div class="column"><div class="field" align="left"><label for="id_is_legal_entity">Тип собственника:</label><div class="ui search selection dropdown" id="id_is_legal_entity" sem-dropdown="" ng-change="fieldChanged(\'is_legal_entity\')" ng-model="calculation.is_legal_entity" sem-dropdown-items="dicts.isLegalEntity"></div></div></div><div class="column"><div class="field"><label>Срок страхования:</label><div class="ui search selection dropdown" id="id_insurance_duration" sem-dropdown="" ng-model="calculation.insurance_duration" sem-dropdown-items="dicts.insuranceDuration"></div></div></div><div class="column"><div class="field"><label for="id_calculation_at_date">Дата начала действия договора:</label><div class="ui icon input"><input type="text" jdatepicker="" jdatepicker-year-range="{{getYearRange(-1, 0)}}" jdatepicker-only-future="true" placeholder="__.__.____" id="id_calculation_at_date" required="" ng-model="calculation.calculation_at_date"> <i class="icon calendar circular branded inverted"></i></div></div></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/calculatorO/views/osago/calculation.step_3.html",'<div class="css-cars-filter b-full-width-bg m0 mt30" style="font-size: 15px;"><div class="p20"><car-filter cf-model-car-mark="calculation.car_mark" cf-model-car-model="calculation.car_model" cf-model-car-model-group="calculation.car_model_group" cf-model-car-cost="calculation.car_cost"></car-filter></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/calculatorO/views/osago/calculation.step_4.html",'<div class="ui form b-full-width-bg pt55 m0 mt10"><div class="p20"><div class="nowrap css-show-errors ui grid stackable relaxed"><div class="row"><div class="four wide column"><div class="field mt15" align="left"><label for="id_drivers_count">Количество водителей:</label><div class="ui search selection dropdown" id="id_drivers_count" sem-dropdown="" ng-model="params.drivers_count_full" ng-class="{disabled: calculation.is_legal_entity}" ng-change="driversCountChanged()" sem-dropdown-items="dicts.driversCountOsagoFull"></div></div></div><div class="twelve wide column b-drivers_osago"><h3 class="b-drivers_osago_person-type b-content_title" ng-if="drivers.length"><i class="icon" ng-class="\'user\' + (drivers.length > 1 ? \'s\' : \'\')"></i> Водители:</h3><div ng-repeat="driver in drivers" ng-form="driver_form" ng-model="driver" class="is-form"><div class="ui grid three column stackable"><div class="row"><div class="column"><div class="field"><label for="id_driver_osago_last_name_{{$index}}">Фамилия:</label> <input type="text" required="" ng-pattern="params.name_pattern" id="id_driver_osago_last_name_{{$index}}" ng-model="driver.last_name"></div></div><div class="column"><div class="field"><label for="id_driver_osago_first_name_{{$index}}">Имя:</label> <input type="text" required="" ng-pattern="params.name_pattern" id="id_driver_osago_first_name_{{$index}}" ng-model="driver.first_name"></div></div><div class="column"><div class="field"><label for="id_driver_osago_patronymic_{{$index}}">Отчество:</label> <input type="text" ng-pattern="params.name_pattern" id="id_driver_osago_patronymic_{{$index}}" ng-model="driver.patronymic"></div></div></div><div class="row"><div class="column"><div class="field"><label for="id_driver_license_series">Водительское удостоверение:</label><div class="ui fields"><div class="seven wide field"><input type="text" required="" maxlength="4" minlength="4" placeholder="Серия" id="id_driver_license_series" ng-model="driver.driver_license.series"></div><div class="nine wide field"><input type="text" required="" input-integer="" maxlength="6" minlength="6" placeholder="Номер" id="id_driver_license_number" ng-model="driver.driver_license.number"></div></div></div></div><div class="column"><div class="field" ng-class="{error: driver.dateIsInvalid}"><label for="id_driving_experience_started_{{$index}}">Дата начала стажа:</label><div class="ui icon input"><input type="text" jdatepicker="" jdatepicker-year-range="{{ getYearRange(0, 73) }}" jdatepicker-only-past="true" ng-change="driversDateChanged(driver)" placeholder="__.__.____" id="id_driving_experience_started_{{$index}}" required="" ng-model="driver.driving_experience_started"> <i class="icon calendar circular branded inverted"></i></div></div></div><div class="column"><div class="field" ng-class="{error: driver.dateIsInvalid}"><label for="id_driver_birth_date_{{$index}}">Дата рождения:</label><div class="ui icon input"><input type="text" jdatepicker="" jdatepicker-year-range="{{ getYearRange(18, 91) }}" jdatepicker-only-past="true" ng-change="driversDateChanged(driver);" placeholder="__.__.____" id="id_driver_birth_date_{{$index}}" required="" ng-model="driver.birth_date"> <i class="icon calendar circular branded inverted"></i></div></div></div></div></div><div class="ui divider mt30 mb15" ng-if="drivers.length > 1 && (drivers.length - 1) !== $index"></div></div><div ng-repeat="person in persons" ng-form="person_form" ng-model="person" class="is-form"><div class="ui loader"></div><h3 class="b-drivers_osago_person-type b-content_title">Собственник:</h3><div class="ui grid four column stackable" ng-if="!calculation.is_legal_entity"><div class="row"><div class="column"><div class="field"><label for="id_person_osago_last_name_{{$index}}">Фамилия:</label> <input type="text" required="" ng-pattern="params.name_pattern" id="id_person_osago_last_name_{{$index}}" ng-model="person.last_name"></div></div><div class="column"><div class="field"><label for="id_person_osago_first_name_{{$index}}">Имя:</label> <input type="text" required="" ng-pattern="params.name_pattern" id="id_person_osago_first_name_{{$index}}" ng-model="person.first_name"></div></div><div class="column"><div class="field"><label for="id_person_osago_patronymic_{{$index}}">Отчество:</label> <input type="text" ng-pattern="params.name_pattern" id="id_person_osago_patronymic_{{$index}}" ng-model="person.patronymic"></div></div><div class="column"><div class="field"><label for="id_person_birth_date_{{$index}}">Дата рождения:</label><div class="ui icon input"><input type="text" jdatepicker="" jdatepicker-year-range="{{getYearRange(0, 90)}}" placeholder="__.__.____" id="id_person_birth_date_{{$index}}" required="" ng-model="person.birth_date"> <i class="icon calendar circular branded inverted"></i></div></div></div></div><div class="row"><div class="six wide column"><div class="field"><label for="id_person_passport">Паспорт:</label><div class="ui fields"><div class="seven wide field"><input type="text" required="" input-integer="" maxlength="4" minlength="4" placeholder="Серия" id="id_person_passport" ng-model="person.passport.series"></div><div class="nine wide field"><input type="text" required="" input-integer="" maxlength="6" minlength="6" placeholder="Номер" ng-model="person.passport.number"></div></div></div></div><div class="four wide column"><div class="field"><label for="id_person_passport_issue_date_{{$index}}">Дата выдачи:</label><div class="ui icon input"><input type="text" jdatepicker="" jdatepicker-year-range="{{getYearRange(0, 26)}}" placeholder="__.__.____" id="id_person_passport_issue_date_{{$index}}" required="" ng-model="person.passport.issue_date"> <i class="icon calendar circular branded inverted"></i></div></div></div><div class="six wide column" ng-if="isVisible(\'vin_number\')"><div class="field"><label for="id_vin_number_np">VIN:</label> <input type="text" ng-model="osagoParams.vin_number" input-vin-number="" minlength="17" maxlength="17" required="" id="id_vin_number_np"><div class="ui label pointing basic top grey c-vin-error-label css-can-wrap" ng-show="osagoParams.vin_number.length === 17">Не совпадает контрольная сумма VIN</div></div></div></div></div><div class="ui grid three column stackable" ng-if="calculation.is_legal_entity"><div class="row"><div class="column" ng-if="isVisible(\'vin_number\')"><div class="field"><label for="id_vin_number">VIN:</label> <input type="text" ng-model="osagoParams.vin_number" input-vin-number="" minlength="17" maxlength="17" required="" id="id_vin_number"><div class="ui label pointing basic top grey c-vin-error-label css-can-wrap" ng-show="osagoParams.vin_number.length === 17">Не совпадает контрольная сумма VIN</div></div></div><div class="column"><div class="field"><label for="id_legal_person_inn">ИНН:</label> <input type="text" required="" input-integer="" id="id_legal_person_inn" ng-model="osagoParams.legal_person.inn"></div></div><div class="column"><div class="field"><label for="id_legal_person_title">Наименование юр. лица:</label> <input type="text" required="" id="id_legal_person_title" ng-model="osagoParams.legal_person.title"></div></div></div></div></div></div></div></div></div></div>');
}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/calculatorO/views/osago/calculation.step_5.html",'<div class="ui form b-full-width-bg pt35 m0 mt10"><div class="p20"><div class="nowrap css-show-errors ui grid stackable relaxed"><div class="four wide column"><div class="field"><label>Количество водителей:</label><div class="ui search selection dropdown" sem-dropdown="" ng-click="params.field_was_clicked = true;" ng-focus="params.field_was_clicked = true;" ng-class="{disabled: calculation.is_legal_entity}" ng-change="params.field_was_clicked && driversCountChangedSimple()" ng-model="params.drivers_count" sem-dropdown-items="dicts.driversCountOsagoSimple"></div></div></div><div class="five wide column"><div class="field" ng-repeat="driver in calculation.driver_set"><label>Возраст и стаж водителя:</label><div class="ui fields"><div class="eight wide field" ng-class="{\'error\': driver.age < 18 || driver.age > 87}"><input type="text" ng-model="driver.age" input-integer="" required=""></div><div class="eight wide field" ng-class="{\'error\': driver.age - driver.expirience < 18}"><input type="text" ng-model="driver.expirience" input-integer="" required=""></div></div></div></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/calculatorO/views/osago/calculation.step_6.html",'<div class="ui form b-full-width-bg_white"><div class="p20"><div class="ui grid stackable four column bottom aligned"><div class="row"><div class="twelve wide column">&nbsp;</div><div class="column" align="right"><div class="field"><button class="ui button" ng-click="calculateOsago()" ng-class="[params.isCalculationProgress ? \'loading\' : \'\', ($root.currentBrand.perform_the_calculation_button || $root.currentBrand.main_buttons_color)]" ng-disabled="calculation_form.$invalid || disabledSubmitButton()" type="button"><span></span> Рассчитать</button></div></div></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/AddingDocuments/views/adding_documents.uploader.html",'<div class="p20 mt10"><div ng-class="{\'b-disabled-block\': isNotUpload}"><div class="ui grid stackable"><div class="row"><div class="six wide column"><ul class="uploader-queue" nv-file-drop="" nv-file-over="" uploader="uploader" over-class="uploader-queue_over"><li ng-if="!uploader.queue.length">Для оформления полиса нужно загрузить файлы.</li><li ng-repeat="item in uploader.queue" class="list-item animation-fade"><div ng-if="item._file.type.indexOf(\'image/\') !== -1"><div ng-thumb="{ file: item._file, height: 70 }"></div></div><div ng-if="item._file.type === \'application/pdf\'"><a href="{{item.file_url}}" target="_blank"><img ng-src="{{params.images_path}}pdf.png" alt="{{item.description}}" height="70"></a></div><div ng-if="item._file.type === \'application/msword\' || isDocument(item._file.type)"><a href="{{item.file_url}}" target="_blank"><img ng-src="{{params.images_path}}doc_icon.png" alt="{{item.description}}" height="70"></a></div><div class="uploader-queue-actions"><button type="button" ng-click="item.remove()" class="button button-wrong">Удалить</button></div></li></ul><div class="control-row mt15"><input type="file" nv-file-select="" class="ui button" name="file" style="width: 100%;" uploader="uploader" multiple=""><h4>Выбрано: {{uploader.queue.length}}</h4></div></div><div class="ten wide column"><h2 class="b-content_title m0">Подтверждаю загрузку минимального пакета документов</h2><div class="b-full-width-bg" style="padding: 15px 0;margin-left: -15px;"><div class="p20">Для заполнения полиса добавьте сканы или фотографии ваших документов. Мы внесем эти данные и проверим их самостоятельно.</div></div><div class="b-uploader_confirmation-list"><div class="list-item mb5"><sem-checkbox ng-model="confirmationList.id_is_1" sem-label="Копия паспорта Страхователя (1 лист и лист с пропиской)" required="required" id="id_is_1" name="is_1"></sem-checkbox></div><div class="list-item mb5"><sem-checkbox ng-model="confirmationList.id_is_2" sem-label="Копия паспорта Собственника (1 лист и лист с пропиской)" required="required" id="id_is_2" name="is_2"></sem-checkbox></div><div class="list-item mb5"><sem-checkbox ng-model="confirmationList.id_is_4" sem-label="Копия ПТС или свидетельство о регистрации (с двух сторон)" required="required" id="id_is_4" name="is_4"></sem-checkbox></div><div class="list-item mb5"><sem-checkbox ng-model="confirmationList.id_is_7" sem-label="Копия вод. удостоверений с обеих сторон всех водителей" required="required" id="id_is_7" name="is_7"></sem-checkbox></div></div></div></div></div></div><div class="mt20 c-tar"><a href="" ng-click="bigSteps.setBigStep(\'fourth\')" ng-class="[ isSaveDataProgress && \'loading\' || \'\', (f_policy_step_3_form.$invalid || !uploader.queue.length) && \'disabled\', ($root.currentBrand.save_the_data_button || $root.currentBrand.main_buttons_color)]" class="ui button"><span></span> Сохранить<br><strong>данные</strong></a></div><div class="mt40" ng-if="errors.length"><div class="ui error message"><ul class="list"><li ng-repeat="error in errors" ng-if="errors.length > 0"><span ng-bind="error"></span></li></ul><i class="close icon" ng-click="errors.length = 0;"></i></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/personalData/views/personal_data.address_registration.html",'<div dadata="person.address_registration" dadata-type="address"><div class="fields"><div class="twelve field wide"><label for="id_address_registration_postal_full">Введите полный адрес:</label><div class="ui transparent input"><input type="text" required="" dadata-target="" ng-blur="fieldBlurred()" class="ui transparent input" ng-class="{\'css-error-input\': !addressIsValid(person.address_registration)}" id="id_address_registration_postal_full" ng-model="person.address_registration.full" name="address_registration_postal_full"></div></div><div class="two field wide"><label>Корпус:</label><div class="ui transparent input"><input type="text" title="Корпус" ng-blur="fieldBlurred()" ng-model="person.address_registration.housing" name="address_registration_housing"></div></div><div class="two field wide"><label>Кв./офис:</label><div class="ui transparent input"><input type="text" title="Квартира" ng-blur="fieldBlurred()" ng-model="person.address_registration.flat" name="address_registration_flat"></div></div></div><div class="js-dadata-messages ui pointing red basic label"></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/personalData/views/personal_data.address_residential.html",'<div dadata="person.address_residential" dadata-type="address"><div class="fields"><div class="twelve field wide"><label for="id_address_residential_postal_full">Введите полный адрес:</label><div class="ui transparent input"><input type="text" required="" dadata-target="" ng-change="addressIsValid(person.address_residential)" ng-blur="fieldBlurred()" class="ui transparent input" ng-class="{\'css-error-input\': !addressIsValid(person.address_residential)}" id="id_address_residential_postal_full" ng-model="person.address_residential.full" name="address_residential_postal_full"></div></div><div class="two field wide"><label>Корпус:</label><div class="ui transparent input"><input type="text" title="Корпус" ng-change="addressIsValid(person.address_residential)" ng-blur="fieldBlurred()" ng-model="person.address_residential.housing" name="address_residential_housing"></div></div><div class="two field wide"><label>Кв./офис:</label><div class="ui transparent input"><input type="text" title="Квартира" ng-change="addressIsValid(person.address_residential)" ng-blur="fieldBlurred()" ng-model="person.address_residential.flat" name="address_residential_flat"></div></div></div><div class="js-dadata-messages ui pointing red basic label"></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/personalData/views/personal_data.addresses_block.html",'<div class="b-addresses"><div class="b-address ui stackable grid"><div class="row"><div class="b-address_line column"><div class="p20"><div class="field" ng-class="{disabled: isDisabledForm}"><div class="b-addresses_checkboxes mb15"><strong>Адрес регистрации:</strong><sem-checkbox sem-label="Совпадает с фактическим" ng-model="person.is_same_address"></sem-checkbox></div><div ng-include="templates.address_registration"></div></div><div class="field" ng-class="{disabled: isDisabledForm}" style="padding-top: 10px;" ng-if="!person.is_same_address"><label class="mb15">Адрес проживания:</label><div ng-include="templates.address_residential"></div></div></div></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/personalData/views/personal_data.form.car.html",'<div class="ui form b-car-form"><div class="p20"><h3 class="ui horizontal divider header"><i class="icon car"></i><span></span></h3><div class="ui grid stackable four column b-full-width-bg is-form" ng-form="car_form" check-in-rsa="params" check-in-rsa-send="{{car_form.$valid}}" ng-model="car"><div class="ui loader" ng-class="{active: rsaParams.is_sending}"></div><div class="row"><div class="sixteen wide column"><h2 class="b-content_title m0 mb15">Автомобиль <strong ng-if="params.car_mark" class="vam"><span ng-bind="params.car_mark"></span> — <span ng-bind="params.car_model_group"></span> — <span ng-bind="params.car_model"></span> \'<span ng-repeat="char in calculation.car_manufacturing_year | limitTo: -2 track by $index" ng-bind="char"></span></strong></h2></div></div><div class="row bottom aligned"><div class="column"><div class="field" ng-class="{disabled: isDisabledForm}"><div align="center" style="margin-top: -2em;"><sem-checkbox ng-model="params.number_type" sem-label="VIN" sem-type="radio" name="number_type" value="vin_number"></sem-checkbox><sem-checkbox ng-model="params.number_type" sem-label="Номер кузова" sem-type="radio" class="ml10" name="number_type" value="car_body_number"></sem-checkbox><sem-checkbox ng-model="params.number_type" sem-label="Номер шасси" sem-type="radio" name="number_type" style="margin: 0.5em 0;" value="chassis_number"></sem-checkbox></div><div class="ui input" ng-if="params.number_type === \'vin_number\'"><input type="text" input-vin-number="" required="" maxlength="17" ng-minlength="17" ng-blur="fieldBlurred()" placeholder="Введите VIN-номер автомобиля" id="id_vin_number" name="vin_number" ng-model="car.vin_number"></div><div class="ui label pointing basic top grey c-vin-error-label" ng-show="car.vin_number.length === 17 && params.number_type === \'vin_number\'">Не совпадает контрольная сумма VIN</div><div class="ui input" ng-if="params.number_type === \'car_body_number\'"><input type="text" required="" ng-blur="fieldBlurred()" name="car_body_number" placeholder="Введите номер кузова автомобиля" ng-model="car.car_body_number"></div><div class="ui input" ng-if="params.number_type === \'chassis_number\'"><input type="text" required="" name="chassis_number" ng-blur="fieldBlurred()" placeholder="Введите номер шасси автомобиля" ng-model="car.chassis_number"></div></div></div><div class="column"><div class="field" ng-class="{disabled: isDisabledForm}"><label for="id_number_plate">Гос. рег. знак:</label> <input type="text" input-capitalize="" ng-blur="fieldBlurred()" maxlength="10" required="" id="id_number_plate" name="number_plate" ng-model="car.number_plate"></div></div><div class="column"><div class="field" ng-class="{disabled: isDisabledForm}"><label for="id_mileage">Пробег:</label> <input type="text" maxlength="8" input-integer="" input-float="" id="id_mileage" ng-blur="fieldBlurred()" name="mileage" ng-model="car.mileage"></div></div><div class="column"><div class="field" ng-class="{disabled: isDisabledForm}"><label for="id_engine_power_kilowatt">Мощность в кВт:</label> <input type="text" input-float="" ng-max="735" max-precision="2" maxlength="6" id="id_engine_power_kilowatt" name="engine_power_kilowatt" ng-blur="fieldBlurred()" ng-model="car.engine_power_kilowatt"></div></div></div><div class="row"><div class="column"><div class="field" ng-class="{disabled: isDisabledForm}"><div><sem-checkbox ng-model="params.car_document_type" sem-label="ПТС" sem-type="radio" name="car_document_type" value="vehicle_registration"></sem-checkbox><sem-checkbox ng-model="params.car_document_type" sem-label="СТС" sem-type="radio" class="ml10" name="car_document_type" value="vehicle_certificate"></sem-checkbox></div><div class="ui fields" ng-if="params.car_document_type === \'vehicle_registration\'"><div class="seven field wide mb10"><input type="text" name="vehicle_registration_series" required="" input-only="[А-Яа-я0-9]+" maxlength="4" ng-minlength="4" ng-blur="fieldBlurred()" placeholder="Серия" id="id_vehicle_registration_series" ng-model="car.vehicle_registration.series"></div><div class="nine field wide"><input type="text" name="vehicle_registration_number" placeholder="Номер" required="" input-integer="" ng-blur="fieldBlurred()" maxlength="6" ng-model="car.vehicle_registration.number"></div></div><div class="ui fields" ng-if="params.car_document_type === \'vehicle_certificate\'"><div class="seven field wide mb10"><input type="text" name="vehicle_certificate_series" required="" input-only="[А-Яа-я0-9]+" ng-blur="fieldBlurred()" maxlength="4" ng-minlength="4" placeholder="Серия" id="id_vehicle_certificate_series" ng-model="car.vehicle_certificate.series"></div><div class="nine field wide"><input type="text" name="vehicle_certificate_number" placeholder="Номер" required="" ng-blur="fieldBlurred()" input-integer="" maxlength="6" ng-model="car.vehicle_certificate.number"></div></div></div></div><div class="column"><div class="field" ng-class="{disabled: isDisabledForm}"><label for="id_document_issue_date">Дата получения:</label><div class="ui icon input"><input type="text" jdatepicker="" jdatepicker-year-range="{{getYearRange(0, 20)}}" jdatepicker-only-past="true" name="document_issue_date" ng-change="fieldBlurred()" placeholder="__.__.____" id="id_document_issue_date" required="" ng-model="car.document_issue_date"> <i class="icon calendar circular blue inverted"></i></div></div></div><div class="column"><div class="field" ng-class="{disabled: isDisabledForm}"><label for="id_engine_displacement">Объем двигателя:</label> <input type="text" input-float="" ng-blur="fieldBlurred()" ng-max="100" id="id_engine_displacement" name="engine_displacement" ng-model="car.engine_displacement"></div></div></div><div class="js-check-in-rsa_message ui message" ng-class="rsaParams.message_type" ng-bind="rsaParams.message"></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/personalData/views/personal_data.form.person_block.html",'<div class="ui form"><div class="p20"><div ng-include="templates.person_roles"></div><div ng-if="!person.isDriver && person.personType === \'natural_person\' || person.showFioFields"><div class="ui grid stackable four column"><div class="row"><div class="column"><div class="field" ng-class="{disabled: isDisabledForm}"><label>Фамилия</label> <input type="text" required="" name="last_name" ng-blur="fieldBlurred()" ng-pattern="params.name_pattern" placeholder="Иван" ng-model="person.last_name"></div></div><div class="column"><div class="field" ng-class="{disabled: isDisabledForm}"><label>Имя</label> <input type="text" placeholder="Петров" required="" ng-blur="fieldBlurred()" name="first_name" ng-pattern="params.name_pattern" ng-model="person.first_name"></div></div><div class="column"><div class="field" ng-class="{disabled: isDisabledForm}"><label>Отчество</label> <input type="text" name="patronymic" ng-blur="fieldBlurred()" ng-pattern="params.name_pattern" placeholder="Александрович" ng-model="person.patronymic"></div></div><div class="column" ng-if="person.hasRole()"><div class="field" ng-class="{disabled: isDisabledForm}"><label for="id_person_birth_date_{{$index}}">Дата рождания</label><div class="ui icon input"><input type="text" jdatepicker="" ng-blur="fieldBlurred()" jdatepicker-year-range="{{person.birthDateRange.yearRange}}" jdatepicker-max-date="{{person.birthDateRange.max}}" jdatepicker-min-date="{{person.birthDateRange.min}}" name="birth_date" placeholder="__.__.____" id="id_person_birth_date_{{$index}}" required="" ng-model="person.birth_date"> <i class="icon calendar circular blue inverted"></i></div></div></div></div></div></div><div ng-if="person.hasRole()"><div class="ui grid stackable four column"><div class="row"><div class="column"><div class="field" ng-class="{disabled: isDisabledForm}"><label for="id_person_passport_series_{{$index}}">Серия и номер паспорта</label><div class="ui fields"><div class="seven field wide mb10"><input type="text" name="person_passport_series" class="focusing-first" required="" ng-blur="fieldBlurred()" input-integer="" maxlength="4" minlength="4" placeholder="Серия" id="id_person_passport_series_{{$index}}" ng-model="person.passport.series"></div><div class="nine field wide"><input type="text" name="person_passport_number" placeholder="Номер" ng-blur="fieldBlurred()" required="" input-integer="" maxlength="6" minlength="6" ng-model="person.passport.number"></div></div></div></div><div class="column"><div class="field" ng-class="{disabled: isDisabledForm}"><label for="id_person_passport_issue_date_{{$index}}">Дата выдачи</label><div class="ui icon input"><input type="text" jdatepicker="" jdatepicker-year-range="{{getYearRange(0, 20)}}" jdatepicker-only-past="true" name="passport_issue_date" placeholder="__.__.____" ng-change="fieldBlurred()" id="id_person_passport_issue_date_{{$index}}" required="" ng-model="person.passport.issue_date"> <i class="icon calendar circular blue inverted"></i></div></div></div><div class="eight wide column"><div class="field" ng-class="{disabled: isDisabledForm}"><label for="id_passport_issue_point">Кем выдан</label> <input type="text" name="passport_issue_point" required="" ng-blur="fieldBlurred()" id="id_passport_issue_point" placeholder="Отделением УФМС по Санкт-Петербургу" ng-model="person.passport.issue_point"></div></div></div></div><div class="row-margin"><div ng-include="templates.addresses_block" ng-if="person.hasRole() || person.isDriver"></div></div></div><div class="js-check-in-rsa_message ui message" ng-class="rsaParams.message_type" ng-bind="rsaParams.message"></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/personalData/views/personal_data.form.person_block_legal.html",'<div class="ui form"><div class="p20"><div ng-include="templates.person_roles"></div><div class="ui grid stackable"><div class="row"><div class="four wide column"><div class="field" ng-class="{disabled: isDisabledForm}"><label for="id_title_{{$index}}">Название:</label> <input type="text" required="" id="id_title_{{$index}}" name="legal_person_title" ng-model="person.title"></div></div><div class="four wide column"><div class="field" ng-class="{disabled: isDisabledForm}"><label for="id_inn_{{$index}}">ИНН:</label> <input type="text" required="" id="id_inn_{{$index}}" input-integer="" minlength="10" maxlength="10" name="legal_person_inn" ng-model="person.inn"></div></div><div class="four wide column"><div class="field" ng-class="{disabled: isDisabledForm}"><label for="id_ogrn_{{$index}}">ОГРН:</label> <input type="text" id="id_ogrn_{{$index}}" name="legal_person_ogrn" input-integer="" minlength="13" maxlength="13" ng-model="person.ogrn"></div></div></div></div></div><div class="b-addresses" ng-if="person.hasRole()"><div class="b-address ui stackable grid"><div class="row"><div class="b-address_line column"><div class="p20"><div class="field" ng-class="{disabled: isDisabledForm}"><label class="mb15">Юридический адрес:</label><div ng-include="templates.address_registration"></div></div></div></div></div></div></div><div align="right" class="mt15" ng-if="person.hasRole() && currentUser.is_legal_person"><a href="" user-to-person="" ng-model="person">Заполнить данными из профиля</a></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/personalData/views/personal_data.form.person_roles.html",'<div class="ui grid stackable"><div class="row"><div class="five wide column"><h2 class="b-content_title"><strong ng-if="person.isDriver && !person.showFioFields" ng-bind="person | fioFormatter:\'full\'"></strong> <strong ng-if="person.showFioFields">Водитель</strong> <strong ng-if="!person.isDriver">Участник договора (<span ng-bind="person.personType === \'legal_person\' ? \'Юр. лицо\' : \'Физ. лицо\'"></span>)</strong></h2></div><div class="seven wide column"><div class="three fields"><div class="field"><sem-checkbox ng-model="person.isDriver" disabled="disabled" sem-label="Водитель"></sem-checkbox></div><div class="field" ng-class="{disabled: isDisabledForm, error: !personCheckUsed().isOwner}"><sem-checkbox ng-model="person.isOwner" sem-label="Собственник" ng-change="setPersonType(person, \'isOwner\')" name="person_is_owner"></sem-checkbox></div><div class="field" ng-class="{disabled: isDisabledForm, error: !personCheckUsed().isInsurant}"><sem-checkbox ng-model="person.isInsurant" sem-label="Страхователь" ng-change="setPersonType(person, \'isInsurant\')" name="person_is_insurant"></sem-checkbox></div></div></div><div class="four wide column"><div class="field without-dropdown-placeholder" style="min-width: 140px;" ng-class="{disabled: isDisabledForm}"><div ng-if="!$index"><div class="ui floating blue dropdown button small" ng-model="params.person_type" sem-dropdown="" ng-class="{disabled: isDisabledForm}" ng-change="addPerson({}, params.person_type)" sem-dropdown-action="select" sem-dropdown-items="insurantTypes" sem-dropdown-placeholder="Добавить участника договора"></div></div><h3 ng-if="$index"><i ng-class="{disabled: isDisabledForm}" class="icon remove red" ng-click="removePerson(person)"></i></h3></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/personalData/views/personal_data.form.persons.html",'<div class="b-full-width-bg_white b-f-policy_person ui form is-form" ng-repeat="person in persons" ng-form="person_form" ng-model="person"><div class="ui loader"></div><div ng-if="person.personType === \'natural_person\'" ng-include="templates.person_block"></div><div ng-if="person.personType === \'legal_person\'" ng-include="templates.person_block_legal"></div><div class="p20"><h3 ng-if="persons.length > 1 && (persons.length - 1) !== $index" class="ui horizontal divider header"><i class="icon users"></i><span></span></h3></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/personalData/views/personal_data.html",'<div ng-include="templates.persons"></div><div ng-include="templates.car"></div><div class="mt40 c-tar"><button class="ui button" ng-disabled="f_policy_step_3_form.$invalid" ng-class="[params.isCalculationProgress ? \'loading\' : \'\', ($root.currentBrand.save_the_data_button || $root.currentBrand.main_buttons_color)]" type="button" ng-click="savePersonalData()"><span></span> Сохранить<br><strong>данные</strong></button></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.osago/calculatorStepsO/views/second_big_step.html",'<div ng-controller="AddingDocumentsCtrl"><div class="p20 mb40 c-tac" ng-show="$root.currentBrand.show_personal_data"><div class="ui basic buttons"><button class="ui button" tabindex="0" ng-click="addingDocumentsTemplates.selectTemplate(\'uploader\')" ng-class="{active: addingDocumentsTemplates.currentTemplate === \'uploader\'}" type="button">Загрузить фото документов</button> <button class="ui button" tabindex="0" ng-click="addingDocumentsTemplates.selectTemplate(\'form\')" ng-class="{active: addingDocumentsTemplates.currentTemplate === \'form\'}" type="button">Заполнить личные данные</button></div></div><div ng-form="f_policy_step_3_form" class="f_policy_step_3-form is-form css-hide-errors"><div ng-if="addingDocumentsTemplates.currentTemplate === \'uploader\'" ng-include="addingDocumentsTemplates.uploader"></div><div ng-if="addingDocumentsTemplates.currentTemplate === \'form\'"><div ng-controller="personalDataCtrl" ng-include="addingDocumentsTemplates.form" class="css-show-errors"></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculator/views/calculator.html",'<div ng-include="templates.navigation"></div><div class="calculator-block main-content-body template-{{$root.calcType}}"><form name="calculation_form" autocomplete="off" ng-class="{\'calculation-form_error\': params.show_empty_fields}" class="calculation-form"><div ui-view=""></div></form></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculator/views/document_uploader.html",'<ul class="uploader-queue" nv-file-drop="" nv-file-over="" uploader="uploader" over-class="uploader-queue_over"><li ng-if="!uploadedFiles.length && !uploader.queue.length">Загрузка файлов</li><li ng-repeat="file in uploadedFiles" class="list-item animation-fade"><div ng-if="file.mime_type.indexOf(\'image/\') !== -1"><a ng-href="{{file.file_url}}" target="_blank"><img ng-src="{{file.file_url}}" alt="{{file.description}}" height="70"></a></div><div ng-if="file.mime_type === \'application/pdf\'"><a ng-href="{{file.file_url}}" target="_blank"><img ng-src="{{params.images_path}}pdf.png" alt="{{file.description}}" height="70"></a></div><div ng-if="file.mime_type === \'application/msword\' || isDocument(file.mime_type)"><a ng-href="{{file.file_url}}" target="_blank"><img ng-src="{{params.images_path}}doc_icon.png" alt="{{file.description}}" height="70"></a></div><div class="uploader-queue-actions"><button type="button" ng-click="removeUploadedImage(file)" class="ui button red mini">Удалить</button></div></li><li ng-repeat="item in uploader.queue" class="list-item animation-fade"><div ng-if="item._file.type.indexOf(\'image/\') !== -1"><div ng-thumb="{ file: item._file, height: 70 }"></div></div><div ng-if="item._file.type === \'application/pdf\'"><a href="{{item.file_url}}" target="_blank"><img ng-src="{{params.images_path}}pdf.png" alt="{{item.description}}" height="70"></a></div><div ng-if="item._file.type === \'application/msword\' || isDocument(item._file.type)"><a href="{{item.file_url}}" target="_blank"><img ng-src="{{params.images_path}}doc_icon.png" alt="{{item.description}}" height="70"></a></div><div class="uploader-queue-actions"><button type="button" ng-click="item.remove()" class="ui button red mini">Удалить</button></div></li></ul>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculator/views/navigation.html",'<div class="b-steps"><div class="ui steps" ng-controller="calculatorNavigationCtrl"><div class="step" ng-repeat="navItem in navigation track by $index" ng-click="navItem.onClick()" ng-hide="navItem.isHidden()" ng-class="{ active: navItem.active(), disabled: navItem.condition_disabled() }"><i class="icon" ng-class="navItem.icon"></i><div class="content"><div class="title" ng-bind-html="navItem.title"></div></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/person/views/person.html",'<h1 class="main-content-header">Данные профиля</h1><div class="main-content-body"><form name="person_form" class="person_edit-form" ng-submit="savePerson()"><div class="control-row"><div class="f_policy-driver-last_name-block"><label for="id_last_name" class="fp-label">Фамилия:</label> <input type="text" ng-model="person.last_name" class="input-text input-sub_medium" id="id_last_name" name="last_name" required=""></div><div class="f_policy-driver-first_name-block"><label for="id_first_name" class="fp-label">Имя:</label> <input type="text" ng-model="person.first_name" class="input-text input-sub_medium" id="id_first_name" name="first_name" required=""></div><div class="f_policy-driver-patronymic-block"><label for="id_patronymic" class="fp-label">Отчество:</label> <input type="text" ng-model="person.patronymic" class="input-text input-sub_medium" id="id_patronymic" name="patronymic"></div></div><div class="control-row"><div class="f_policy-driver-driver_license-block"><label for="id_driver_license_series" class="fp-label">Водительское удостоверение:</label> <input type="text" ng-model="person.driver_license.series" class="input-text input-nano" maxlength="4" id="id_driver_license_series" name="driver_license_series" required=""> <input type="text" ng-model="person.driver_license.number" class="input-text input-small" maxlength="6" id="id_driver_license_number" name="driver_license_number" required=""></div><div class="f_policy-driver-driver_license_date-block"><label for="id_driver_license_date_{{$index}}" class="fp-label">Дата получения прав:</label> <span class="input-date-wrap"><input type="text" jdatepicker="" jdatepicker-year-count="90" ng-model="person.driver_license.issue_date" class="input-date input-mini" id="id_driver_license_date_{{$index}}" name="driver_license_date" required=""> <i class="icon-calendar"></i></span></div><div class="f_policy-driver-birth_date-block"><label for="id_birth_date_{{$index}}" class="fp-label">Дата рождения:</label> <span class="input-date-wrap"><input type="text" jdatepicker="" jdatepicker-year-count="90" ng-model="person.birth_date" class="input-date input-mini" id="id_birth_date_{{$index}}" name="birth_date" required=""> <i class="icon-calendar"></i></span></div></div><div class="control-row"><div class="f_policy-driver-passport-block"><label for="id_passport_series" class="fp-label">Серия, номер паспорта:</label> <input type="text" input-integer="" ng-model="person.passport.series" class="input-text input-nano" maxlength="4" id="id_passport_series" name="passport_series" required=""> <input type="text" input-integer="" ng-model="person.passport.number" class="input-text input-small" maxlength="6" id="id_passport_number" name="passport_number" required=""></div><div class="f_policy-driver-passport_point-block"><label for="id_passport_point" class="fp-label">Кем выдан:</label> <input type="text" ng-model="person.passport.issue_point" class="input-text input-big" id="id_passport_point" name="passport_point"></div><div class="f_policy-driver-passport_date-block"><label for="id_passport_date_{{$index}}" class="fp-label">Дата выдачи:</label> <span class="input-date-wrap"><input type="text" jdatepicker="" jdatepicker-year-count="90" ng-model="person.passport.issue_date" class="input-date input-mini" id="id_passport_date_{{$index}}" name="passport_date" required=""> <i class="icon-calendar"></i></span></div></div><div class="control-row"><div class="f_policy-driver-address-block"><div class="f_policy-driver-address_registration-block"><label for="id_address_registration_postal_index" class="fp-label">Адрес регистрации:</label><div class="input-wrapper"><input type="text" ng-model="person.address_registration.postal_index" class="input-text input-mini" placeholder="индекс" maxlength="6" id="id_address_registration_postal_index" name="address_registration_postal_index"> <input type="text" ng-model="person.address_registration.city" class="input-text input-mini" placeholder="город" id="id_address_registration_city" name="address_registration_city"> <input type="text" ng-model="person.address_registration.street" class="input-text input-mini" placeholder="улица" id="id_address_registration_street" name="address_registration_street"> <input type="text" ng-model="person.address_registration.house" class="input-text input-nano" placeholder="дом" id="id_address_registration_house" name="address_registration_house"> <input type="text" ng-model="person.address_registration.housing" class="input-text input-nano" placeholder="корп." id="id_address_registration_housing" name="address_registration_housing"> <input type="text" ng-model="person.address_registration.flat" class="input-text input-nano" placeholder="кв." id="id_address_registration_flat" name="address_registration_flat"></div></div><div class="f_policy-driver-address_residential-block" ng-if="!person.is_same_address"><label for="id_address_residential_postal_index" class="fp-label">Адрес проживания:</label><div class="input-wrapper"><input type="text" ng-model="person.address_residential.postal_index" class="input-text input-mini" placeholder="индекс" maxlength="6" id="id_address_residential_postal_index" name="address_residential_postal_index"> <input type="text" ng-model="person.address_residential.city" class="input-text input-mini" placeholder="город" id="id_address_residential_city" name="address_residential_city"> <input type="text" ng-model="person.address_residential.street" class="input-text input-mini" placeholder="улица" id="id_address_residential_street" name="address_residential_street"> <input type="text" ng-model="person.address_residential.house" class="input-text input-nano" placeholder="дом" id="id_address_residential_house" name="address_residential_house"> <input type="text" ng-model="person.address_residential.housing" class="input-text input-nano" placeholder="корп." id="id_address_residential_housing" name="address_residential_housing"> <input type="text" ng-model="person.address_residential.flat" class="input-text input-nano" placeholder="кв." id="id_address_residential_flat" name="address_residential_flat"></div></div></div><div class="f_policy-driver-is_same_address-block"><div class="sub-block"><input type="checkbox" ng-model="person.is_same_address" class="checkbox" id="id_is_same_address" name="is_same_address"> <label for="id_is_same_address">Совпадает с фактическим</label></div></div></div><div class="form-actions"><button type="submit" ng-disabled="isSavePersonProgress" class="button person-submit">Сохранить <i class="icon-done"></i></button><div loading-spinner="isSavePersonProgress" class="calc-loading"></div></div></form></div>');
}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/person/views/person.save_message.success.html",'<form name="person_message_success" class="formation_policy_message-form ngdialog-form" ng-submit="closeThisDialog()"><div class="ngdialog-message">Персона сохранена</div><div class="form-actions"><button type="submit" class="button person_message_success-submit-button">Ок</button></div></form>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/appMessage/views/messages_template.html",'<div class="b-messages"><div ng-repeat="message in $root.messages" ng-class="message.type" class="b-messages_item ui message"><i class="icon close" ng-click="message.close()"></i><div ng-if="!message.isList" compile="message.msg"></div><ul class="list" ng-if="message.isList"><li ng-repeat="msg in message.msg"><span ng-bind-html="msg"></span></li></ul></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/mainContent/views/main_content.html",'<div ui-view=""></div><div align="right" class="mt20 mr15" ng-if="!$root.currentBrand.watermark_is_hidden">Разработка и поддержка <a href="http://b2bpolis.ru" target="_blank">Умный полис</a></div><div call-to-manager=""></div><messages></messages>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/carFilter/views/car_filter.car_group_models_list.html",'<div class="c-tac b-content-loading" ng-if="!carModelGroups || !carModelGroups.length"><i class="spinner loading icon big grey" tabindex="0"></i></div><div class="ui five column doubling grid"><div class="row"><div class="column ui list" ng-repeat="column in carModelGroups | carFilterYears: carManufacturingYear | orderBy:\'rank\':reverse | orderBy:orderBy | multiColumn:{columns: 5}"><div ng-repeat="carModelGroup in column" class="item css-car-item" tabindex="0" ng-click="selectCarModelGroup(carModelGroup)" ng-keypress="$event.keyCode == 13 && selectCarModelGroup(carModelGroup)" title="{{carModelGroup.title}}"><span ng-bind="carModelGroup.title"></span></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/carFilter/views/car_filter.car_manufacturing_years.html",'<div class="ui labels"><button class="ui large label basic" type="button" ng-repeat="year in monYears | limitTo: 10" tabindex="0" ng-class="[ year == calculation.car_manufacturing_year ? \'blue\' : \'\', $root.currentBrand.year_of_the_car_color ]" ng-click="selectMonYear($index)"><span ng-bind="year"></span></button><div style="display: inline-block;" class="nowrap"><label class="ml15" style="display: inline-block;">Другой:</label><div style="display: inline-block;"><div class="ui form"><div class="field" style="width: 90px;"><div sem-dropdown-items="monYears" class="ui compact selection dropdown" sem-dropdown="" ng-focus="carFilterParams.was_clicked = true;" ng-click="carFilterParams.was_clicked = true;" ng-change="carFilterParams.was_clicked && selectMonYear()" sem-dropdown-placeholder="2016" ng-class="$root.currentBrand.year_of_the_car_color" sem-dropdown-simple="true" ng-model="calculation.car_manufacturing_year"></div></div></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/carFilter/views/car_filter.car_marks_list.html",'<div class="c-tac b-content-loading" ng-if="!carMarks || !carMarks.length"><i class="spinner loading icon big grey" tabindex="0"></i></div><div class="ui six column doubling grid"><div class="row"><div class="column ui list" ng-repeat="column in carMarks | filter:$parent.carSearch | filter:filterByPopularity | limitTo:carMarksLimit | orderBy:orderBy | multiColumn:{columns: 6}"><div ng-repeat="carMark in column" class="item css-car-item" title="{{carMark.title}}" tabindex="0" ng-class="{ \'css-item-selected\': carMarkSelected === carMark }" ng-keypress="$event.keyCode == 13 && selectCarMark(carMark)" ng-click="selectCarMark(carMark)"><span ng-bind="::carMark.title"></span></div></div></div></div><div style="position: relative;z-index: 2;" class="c-tar"><a href="" class="car_filter-car_marks-all_marks_link p20" ng-click="toggleAllMarks()"><span ng-if="carMarksLimit === limit">Все марки</span> <span ng-if="carMarksLimit !== limit">Закрыть</span></a></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/carFilter/views/car_filter.car_models_list.html",'<div class="c-tac b-content-loading" ng-if="!carModels || !carModels.length"><i class="spinner loading icon big grey" tabindex="0"></i></div><div class="ui five column doubling grid"><div class="row"><div class="column ui list" ng-repeat="column in carModels | carFilterYears:carManufacturingYear | orderBy:\'rank\':reverse | orderBy:orderBy | multiColumn:{columns: 5}"><div ng-repeat="carModel in column" class="item css-car-item" tabindex="0" ng-keypress="$event.keyCode == 13 && selectCarModel(carModel, true)" ng-click="selectCarModel(carModel, true)" ng-class="{ \'css-item-selected\': selectedModelId === carModel.id }" title="{{carModel.title}}"><span ng-bind="carModel.title"></span></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/carFilter/views/car_filter.html",'<style>\n    i.icon.delete:focus {\n        color: #fff;\n        opacity: 1 !important;\n        outline: none;\n    }\n</style><div class="ui form b-calc-step pos-rel" ng-class="[\'b-calc-step--\' + getActiveStep().name, \'b-calc-step-second--\' + getActiveStepSecond().name]"><div move-to-step="" ng-show="getActiveStep().name !== carFilterParams.brandSteps.first[0]"></div><div ng-repeat="template in carFilterTemplates" ng-if="bigSteps.getBigStep().name === template.name" ng-include="template.templateUrl"></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/carFilter/views/fourth_big_step.html",'<div ng-controller="policyOrderingCtrl" ng-form="ordering_form" class="is-form"><div class="b-ordering m0"><div class="ui grid stackable"><div class="row"><div class="eleven wide column"><div class="b-ordering-block b-full-width-bg b-full-width-bg--green p30" style="height: 100%" ng-if="carInfo.carMark"><h3 class="b-content_title m0">Автомобиль</h3><h3 class="b-content_title p20 mt10"><strong><span ng-bind="carInfo.carMark.title"></span> <span ng-bind="carInfo.carModelGroup.title"></span> <span ng-bind="carInfo.carModel.title"></span> — <span ng-bind="calculation.car_manufacturing_year"></span> г. выпуска, <span ng-bind="calculation.engine_power"></span> л.с.</strong></h3><h3 class="b-content_title mt30">Водители:</h3><h3 class="b-content_title p20 mt10" ng-show="!calculation.is_multidrive"><div ng-repeat="driver in calculation.driver_set"><strong>Возраст - <span ng-bind="driver.age"></span>, стаж - <span ng-bind="driver.expirience"></span></strong></div></h3><h3 class="b-content_title p20 mt10" ng-show="calculation.is_multidrive"><div><strong>Минимальный возраст - <span ng-bind="calculation.drivers_minimal_age"></span>, минимальный стаж - <span ng-bind="calculation.drivers_minimal_experience"></span></strong></div></h3><div class="b-ordering-block_icon"><i class="icon info"></i></div></div></div><div class="five wide column"><div class="b-full-width-bg b-ordering-block b-full-width-bg--red" style="height: 100%" ng-if="carFilterParams.selectedResult()"><h3 class="b-content_title m0">Выбранный страховой продукт:</h3><h3 class="b-content_title c-tar m0 mt10"><div class="b-ordering_ins-company"><strong ng-bind="carFilterParams.selectedResult().insurance_company.title"></strong></div><div class="mt5 b-ordering_price"><strong><span ng-bind="carFilterParams.selectedResult().program.sum | priceFormatter:0:\'\':false"></span>.<small ng-bind="carFilterParams.selectedResult().program.sum | fractionalFormatter:2"></small> р.</strong></div></h3><div class="b-ordering-block_icon"><i class="icon calculator"></i></div></div></div></div><div class="row"><div class="eleven wide column"><div class="b-full-width-bg b-ordering-block b-ordering-block--form"><h3 class="b-content_title m0 mb20">Введите данные для оформления заказа:</h3><form name="ordering_form"><div class="ui form"><div class="ui grid stackable two column"><div class="row" ng-if="!currentBrand.with_sms"><div class="column"><div class="field"><label>Ваше имя:</label> <input type="text" ng-model="formFields.client_name" required=""></div></div><div class="column"><div class="field"><label>Ваш телефон:</label> <input type="text" ui-mask="+7 (999) 999-9999" required="" placeholder="+7 (___) ___-____" ng-model="formFields.client_phone"></div></div></div><div class="row"><div class="column"><div class="field"><label>Способ оплаты:</label><div class="ui search selection dropdown" id="id_owner_registration" sem-dropdown="" ng-model="formFields.payment_type" sem-dropdown-simple="true" sem-dropdown-items="paymentType"></div></div></div></div><div class="row one column"><div class="column"><div class="mt10"><sem-checkbox ng-model="formFields.receipt_type" sem-label="Бесплатная доставка в течение 2-х дней" sem-type="radio" class="mr25" name="receipt_type" value="delivery"></sem-checkbox><sem-checkbox ng-model="formFields.receipt_type" sem-label="Оформление в офисе" sem-type="radio" name="receipt_type" value="office"></sem-checkbox></div></div></div></div><div class="ui grid" ng-if="formFields.receipt_type === \'delivery\'"><div class="row one column pt0"><div class="column"><div class="field"><label for="id_delivery_address">Адрес доставки:</label> <input type="text" required="" id="id_delivery_address" ng-model="formFields.delivery_address"></div></div></div><div class="row two column pt0"><div class="column"><div class="field" ng-class="{error: formFields.delivery_date && ordering_form.delivery_date.$invalid}"><label for="id_delivery_date">Дата доставки:</label><div class="ui icon input"><input type="text" jdatepicker="" jdatepicker-year-range="{{getYearRange(0, 0)}}" jdatepicker-only-future="true" name="delivery_date" placeholder="__.__.____" id="id_delivery_date" required="" ng-model="formFields.delivery_date"> <i class="icon calendar circular branded inverted"></i></div></div></div><div class="column"><div class="field"><label for="id_delivery_time">Время доставки:</label> <input type="text" required="" ng-model="formFields.delivery_time" id="id_delivery_time"></div></div></div></div><div class="ui grid" ng-if="formFields.receipt_type === \'office\'"><div class="row two column pt0"><div class="column"><div class="field" ng-class="{error: formFields.arrival_date && ordering_form.arrival_date.$invalid}"><label for="id_arrival_date">Дата оформления:</label><div class="ui icon input"><input type="text" jdatepicker="" jdatepicker-year-range="{{getYearRange(0, 0)}}" jdatepicker-only-future="true" name="arrival_date" placeholder="__.__.____" id="id_arrival_date" required="" ng-model="formFields.arrival_date"> <i class="icon calendar circular branded inverted"></i></div></div></div><div class="column" ng-if="!$root.currentBrand.arrival_time_is_hidden"><div class="field"><label for="id_arrival_time">Время оформления:</label> <input type="text" required="" ng-model="formFields.arrival_time" id="id_arrival_time"></div></div></div></div></div></form><div class="b-ordering-block_icon"><i class="icon write"></i></div></div></div><div class="five wide column"><div class="b-ordering-block_submit b-full-width-bg b-ordering-block b-full-width-bg--grey"><button type="button" ng-click="sendPolicyOrdering()" ng-disabled="ordering_form.$invalid || policyOrderingInProgress" ng-class="[policyOrderingInProgress ? \'loading\' : \'\', ($root.currentBrand.order_the_policy_button || $root.currentBrand.main_buttons_color)]" class="ui button">Заказать полис</button></div></div></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/carFilter/views/program_list.manager.html",'<div class="b-post-calculate" ng-show="postCalculateParams.is_visible"><div align="center"><div class="b-post-calculate_pre" ng-show="!postCalculateParams.second && !postCalculateParams.third"><div ng-show="!postCalculateParams.first"><div class="b-post-calculate_pre-title"><i class="icon info circle"></i> КАСКО можно сделать дешевле! Попробуем?</div><div class="b-post-calculate_pre-actions mt20"><button class="ui button green small" ng-click="postCalculateParams.first = true;" type="button">Да, конечно</button> <button class="ui button orange small ml10" ng-click="postCalculateParams.is_visible = false;" type="button">Нет, спасибо</button></div></div><div ng-show="postCalculateParams.first"><div class="b-post-calculate_pre-title"><i class="icon info circle"></i> Самостоятельно на сайте или с помощью менеджера?</div><div class="b-post-calculate_pre-actions mt20"><button class="ui button green small" ng-click="postCalculateParams.second = true;" type="button">Я сам</button> <button class="ui button olive small ml10" ng-click="toManager()" type="button">Пусть позвонит менеджер</button></div></div></div></div><div class="b-post-calculate_manager" ng-show="postCalculateParams.third"><div class="ui form"><div class="ui grid two column stackable"><div class="row"><div class="column"><div class="field"><label for="id_manager__client_name">Как к вам обращаться?</label> <input type="text" id="id_manager__client_name" ng-model="postCalculateParams.manager__client_name"></div></div><div class="column"><div class="field"><label for="id_manager__client_phone">Номер телефона:</label> <input type="text" ui-mask="+7 (999) 999-9999" placeholder="+7 (___) ___-____" ng-model="clientParams.manager__client_phone" id="id_manager__client_phone"></div></div></div><div class="row"><div class="column"></div><div class="column"><button class="ui button green fluid" ng-click="sendToManager()" ng-disabled="!postCalculateParams.manager__client_name || !clientParams.manager__client_phone || postCalculateParams.button_is_disabled" type="button">Отправить заявку на звонок</button></div></div></div></div></div><div class="b-post-calculate_fields css-bigger-labels" ng-show="postCalculateParams.second"><div class="ui form"><div class="ui grid two column stackable doubling"><div class="row"><div class="column"><div class="field"><label for="id_deductible_value">Франшиза:</label> <input type="text" id="id_deductible_value" class="input-has-slider" name="deductible_value" ng-model="params.deductible_value"><div input-slider="" is-sum="true" default-min="0" slider-step="500" default-max="50000" ng-model="params.deductible_value"></div></div></div><div class="column" align="center"><p class="pt10"><i class="icon help circle grey"></i>Франшиза — это та часть ущерба, которую вы возмещаете за свой счет, если наступил страховой случай.</p></div></div><div class="row"><div class="sixteen wide column"><div class="field pt10"><label>Рассрочка оплаты на год:</label><div class="ui buttons mt5" style="border: none;"><button class="ui teal button" ng-repeat="item in params.contributoryScheme" type="button" ng-class="{basic: item.id !== params.contributory_scheme}" ng-click="params.contributory_scheme = item.id"><span ng-bind="item.title"></span></button></div></div></div></div><div class="row" ng-hide="$root.currentBrand.payment_form_is_hidden"><div class="sixteen wide column"><div class="field"><label>Ремонт:</label><div class="four ui buttons mt5" style="border: none;"><button class="ui teal button" ng-repeat="item in paymentForm" type="button" ng-class="{basic: item.id !== params.payment_form}" ng-click="params.payment_form = item.id"><span ng-bind="item.title"></span></button></div></div></div></div><div class="row"><div class="sixteen wide column"><div class="mt15" align="right"><button class="ui button green m0" style="width: 50%;" ng-disabled="params.recalculateButtonIsDisabled" ng-click="calculateKasko()" ng-class="{loading: params.recalculateButtonIsDisabled}" type="button">Обновить тарифы</button></div></div></div></div></div></div></div><style>\n    .b-post-calculate_pre {\n        padding: 15px 20px;\n        background-color: #fff;\n        display: inline-block;\n        color: #e24646;\n        border: 2px solid #ff9a9a;\n        border-radius: 4px;\n    }\n\n    .b-post-calculate_pre-title {\n        font-size: 16px;\n    }\n\n    .b-post-calculate_pre-title i.icon {\n        font-size: 1.2em;\n    }\n\n    .b-post-calculate_fields,\n    .b-post-calculate_manager {\n        padding: 25px 30px;\n        border: 1px solid #d8f0fe;\n        width: 96%;\n        max-width: 580px;\n        margin: 0 auto;\n        border-radius: 4px;\n        background-color: rgba(235, 243, 249, 0.23);\n    }\n</style>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/carFilter/views/second_big_step.html",'<div><div class="ui large labels" ng-class="$root.currentBrand.steps_buttons_color"><div class="ui label basic mb10" ng-repeat="item in carFilterParams.brandSteps.second" ng-show="getCurrentStepObject(item).getLabelTitle()"><span ng-bind="getCurrentStepObject(item).getLabelTitle()"></span> <i class="icon delete" ng-click="setActiveStep(getCurrentStepObject(item).name)" ng-keydown="$event.keyCode == 13 && setActiveStep(getCurrentStepObject(item).name)" tabindex="0"></i></div></div><div class="p20" ng-show="getActiveStepSecond().name !== carFilterParams.brandSteps.second[0]"><div class="ui divider" style="border-top-style: dashed;"></div></div><div ng-repeat="item in carFilterParams.brandSteps.second" class="c-hidden" ng-class="\'show-active-\' + getCurrentStepObject(item).name" ng-include="getCurrentStepObject(item).templateUrl"></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/carFilter/views/third_big_step.html",'<div class="ui grid three column doubling stackable css-bigger-labels"><div class="row"><div class="column"><div class="field"><label for="id_client_name">Как к вам обращаться?</label> <input type="text" ng-disabled="clientParams.client_params_are_disabled || clientParams.sms_is_visible" ng-model="clientParams.client_name" placeholder="Имя" id="id_client_name"></div></div><div class="column"><div class="field"><label for="id_client_phone">Номер телефона:</label> <input type="text" ui-mask="+7 (999) 999-9999" ng-disabled="clientParams.client_params_are_disabled || clientParams.sms_is_visible" placeholder="+7 (___) ___-____" model-view-value="true" ng-model="clientParams.client_phone" id="id_client_phone"></div></div><div class="column"><div class="field"><label>&nbsp;</label> <button class="ui button teal fluid" ng-disabled="!clientParams.client_phone || !clientParams.client_name || clientParams.client_params_are_disabled || clientParams.sms_is_visible" ng-click="showSMSform();calculateKaskoCarFilter()" type="button">Показать тарифы</button></div></div></div><div class="row" ng-if="clientParams.sms_is_visible"><div class="column"><a href="" class="css-bottom-dashed pt30" style="font-size: 15px;" ng-click="clientParams.sms_is_visible = false;">Изменить номер телефона</a></div><div class="column"><div class="field" ng-class="{error: !clientParams.sms_code}"><label for="id_sms_code">Код из СМС:</label> <input type="text" ng-model="clientParams.sms_code" placeholder="1234" maxlength="4" input-integer="" id="id_sms_code"></div></div><div class="column"><div class="field"><label>&nbsp;</label> <button class="ui button green fluid" ng-disabled="!clientParams.sms_code || clientParams.sms_button_is_disabled" ng-click="confirmCode()" type="button">Подтвердить</button></div></div></div><div class="row" ng-show="calculatorParams.confirm_code_is_incorrect"><div class="sixteen wide column"><div class="ui message error visible">Код СМС не совпал с отправленным.</div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/preCalculator/views/pre_calculator.other.html","")}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/preCalculator/views/pre_calculator.rolf.html",'<div class="b-full-width-bg mt10 p20 pt20"><div class="ui grid stackable"><div class="two wide column"></div><div class="six wide column"><button type="button" ng-if="!preCalculatorParams.is_second_step" ng-click="preCalculatorParams.is_second_step = true;" class="ui button fluid big branded" style="height: 100%;">КАСКО на новый автомобиль</button></div><div class="six wide column"><a ui-sref="index.calculator.kasko" ng-if="!preCalculatorParams.is_second_step" type="button" class="ui button fluid big blue">КАСКО на авто с пробегом для новых клиентов</a></div><div class="two wide column"></div></div><div ng-if="preCalculatorParams.is_second_step"><div class="ui grid stackable"><div class="row"><div class="column wide"><h2 class="b-content_title m0 mb30">Укажите нужный вариант</h2><div class="mt15"><sem-checkbox ng-model="preCalculatorParams.selectedType" sem-label="{{ typesToSelect.first.title }}" sem-type="radio" class="" name="selected_type" value="first"></sem-checkbox></div><div class="mt15"><sem-checkbox ng-model="preCalculatorParams.selectedType" sem-label="{{ typesToSelect.second.title }}" sem-type="radio" class="" name="selected_type" value="second"></sem-checkbox></div><button type="button" ng-disabled="!preCalculatorParams.selectedType" ng-click="preCalculatorParams.toNextStep()" ng-class="$root.currentBrand.main_buttons_color" class="ui button right floated">Далее</button></div></div></div></div></div><style>\n    .ui.button {\n        font-weight: 400;\n    }\n</style>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/postCalculator/views/post_calculator.rolf-previous.html",'<div class="b-full-width-bg mt30 p20 pt20 pb20"><h3>Для того, чтобы получить максимально выгодное предложение свяжитесь с нами по телефону 8&nbsp;800&nbsp;123&#045;67&#045;89 или напишите нам.</h3><div class="ui form"><div class="ui grid two column stackable"><div class="row three column"><div class="column"><div class="field"><label for="id_manager__client_name">Имя</label> <input type="text" id="id_manager__client_name" ng-disabled="postCalculatorParams.is_visible" ng-model="postCalculatorParams.client_name"></div></div><div class="column"><div class="field"><label for="id_manager__client_phone">Телефон</label> <input type="text" ng-disabled="postCalculatorParams.is_visible" ui-mask="+7 (999) 999-9999" placeholder="+7 (___) ___-____" ng-model="postCalculatorParams.client_phone" id="id_manager__client_phone"></div></div></div></div><div class="ui grid stackable"><div class="row"><div class="wide column"><div class="field"><label></label> <textarea rows="4" placeholder="Текст сообщения" ng-disabled="postCalculatorParams.is_visible" ng-model="postCalculatorParams.message">\n            </textarea></div></div></div><div class="row"><div class="column"><button class="ui button green" ng-click="preSendToManager()" ng-disabled="!postCalculatorParams.client_name || !postCalculatorParams.client_phone || !postCalculatorParams.message || postCalculatorParams.button_is_disabled" type="button">Отправить</button></div></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/postCalculator/views/post_calculator.rolf.html",'<div class="b-full-width-bg mt30 p20 pt20 pb20"><h3>Для того, чтобы получить максимально выгодное предложение свяжитесь с нами по телефону 8&nbsp;800&nbsp;123&#045;67&#045;89 или напишите нам.</h3><div class="ui form"><div class="ui grid stackable"><div class="row three column"><div class="column"><div class="field"><label for="id_manager__client_name">Имя</label> <input type="text" id="id_manager__client_name" ng-disabled="postCalculatorParams.is_visible" ng-model="postCalculatorParams.client_name"></div></div><div class="column"><div class="field"><label for="id_manager__client_phone">Телефон</label> <input type="text" ng-disabled="postCalculatorParams.is_visible" ui-mask="+7 (999) 999-9999" placeholder="+7 (___) ___-____" ng-model="postCalculatorParams.client_phone" id="id_manager__client_phone"></div></div></div></div><div class="ui grid stackable"><div class="row"><div class="column"><h3 class="b-content_title">Выберите марку:</h3><div class="ui basic four buttons"><button type="button" ng-click="setCarMark(\'Mitsubishi\')" ng-class="{\'active\': postCalculatorParams.carMark === \'Mitsubishi\'}" class="ui button">Mitsubishi</button> <button type="button" ng-click="setCarMark(\'Ford\')" ng-class="{\'active\': postCalculatorParams.carMark === \'Ford\'}" class="ui button">Ford</button> <button type="button" ng-click="setCarMark(\'Mazda\')" ng-class="{\'active\': postCalculatorParams.carMark === \'Mazda\'}" class="ui button">Mazda</button> <button type="button" ng-click="setCarMark(\'Hyundai\')" ng-class="{\'active\': postCalculatorParams.carMark === \'Hyundai\'}" class="ui button">Hyundai</button></div></div></div><div class="row"><div class="column"><button class="ui button green" ng-click="preSendToManager()" ng-disabled="!postCalculatorParams.client_name || !postCalculatorParams.client_phone || !postCalculatorParams.carMark || postCalculatorParams.button_is_disabled" type="button">Отправить</button></div></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/first_big_step.html",'<div><div class="ui large labels" ng-class="$root.currentBrand.steps_buttons_color"><div class="ui label basic mb10" ng-repeat="item in carFilterParams.brandSteps.first" ng-show="getCurrentStepObject(item).getLabelTitle()"><span ng-bind="getCurrentStepObject(item).getLabelTitle()"></span> <i class="icon delete" ng-click="setActiveStep(getCurrentStepObject(item).name)" ng-keydown="$event.keyCode == 13 && setActiveStep(getCurrentStepObject(item).name)" tabindex="0"></i></div></div><div class="p20" ng-show="getActiveStep().name !== carFilterParams.brandSteps.first[0]"><div class="ui divider" style="border-top-style: dashed;"></div></div><div ng-repeat="item in carFilterParams.brandSteps.first" ng-show="getCurrentStepObject(item).name === getActiveStep().name" ng-class="\'show-active-\' + getCurrentStepObject(item).name" ng-include="getCurrentStepObject(item).templateUrl"></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.calculation_type.html",'<div><h3 class="b-content_title mb30 mt30">Тип расчета ОСАГО:</h3><div class="p20 mb25" ng-show="$root.currentBrand.show_user_agreement && !carFilterParams.calculation_type"><sem-checkbox ng-model="personalData.user_agreement" sem-label="Согласен на обработку моих персональных данных" id="personal_data" name="personal_data"></sem-checkbox></div><div ng-class="{\'css-disabled-links\': !personalData.user_agreement}"><h3 class="b-content_title p20 m0"><a href="" ng-repeat="item in calcTypes" ng-click="setCalculationType(item.id)" ng-bind="item.title" ng-class="{\'css-bottom-dashed--active\': item.id == calculationInterParams.calculation_type}" class="mr25 css-bottom-dashed"></a></h3></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.car_cost.html",'<div class="fields"><div class="five wide field nowrap"><label for="id_car_cost">Укажите стоимость автомобиля в руб.:</label> <input type="text" ng-model="calculationInterParams.car_cost" price-formatter="2" class="input-has-slider" required="" no-empty="" id="id_car_cost"><div input-slider="" is-sum="true" default-min="100000" slider-step="5000" default-max="3000000" ng-model="calculationInterParams.car_cost"></div></div><div class="eleven wide field c-tar"><label>&nbsp;</label> <button type="button" ng-click="toNextStep(\'car_cost\')" ng-class="$root.currentBrand.main_buttons_color" ng-disabled="!calculationInterParams.car_cost" class="ui button">Далее</button></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.car_mark.html",'<div class="calculator-caption calculator-caption-model mb15"><div class="pos-rel mb15"><b>Выберите марку:</b> <label class="b-car-search"><div class="ui icon input transparent"><input type="text" placeholder="Найти" ng-model="carSearch.title"> <i class="icon search"></i></div></label></div><div car-marks-list="" style="clear: both;" ng-model="calculation.car_mark" limit="56"></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.car_model.html",'<div class="calculator-caption calculator-caption-model mb15"><div class="pos-rel mb15"><b>Выберите модификацию —</b> {{ allSelected.carMark.title }} <span ng-if="!allSelected.carModel.title">{{ allSelected.carModelGroup.title }}</span> <span ng-if="allSelected.carModel.title">{{ allSelected.carModel.title }}</span>:</div><div car-models-list="" style="clear: both;" ng-model="calculation.car_model" car-mark-id="modelCarMark" car-manufacturing-year="calculation.car_manufacturing_year" car-model-group-id="calculation.car_model_group"></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.car_model_group.html",'<div class="calculator-caption calculator-caption-model mb15"><div class="pos-rel mb15"><b>Выберите модель —</b> {{allSelected.carMark.title}} <span ng-if="!allSelected.carModel.title">{{allSelected.carModelGroup.title}}</span> <span ng-if="allSelected.carModel.title">{{allSelected.carModel.title}}</span>:</div><div car-group-models-list="" style="clear: both;" ng-model="calculation.car_model_group" car-manufacturing-year="calculation.car_manufacturing_year" car-mark-id="modelCarMark"></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.car_settings.tumen.html",'<div class="ui form is-form" ng-form="car_settings_tumen_form"><div class="ui grid"><div class="row three column bottom aligned"><div class="column"><div class="field"><label for="id_car_cost">Укажите стоимость автомобиля в руб.:</label> <input type="text" ng-model="calculationInterParams.car_cost" price-formatter="2" class="input-has-slider" required="" no-empty="" id="id_car_cost"><div input-slider="" is-sum="true" default-min="100000" slider-step="5000" default-max="3000000" ng-model="calculationInterParams.car_cost"></div></div></div><div class="column"><div class="field"><label for="id_mileage">Укажите пробег автомобиля в км:</label> <input type="text" ng-model="calculationInterParams.mileage" price-formatter="2" class="input-has-slider" id="id_mileage"><div input-slider="" is-sum="true" default-min="0" slider-step="500" default-max="200000" ng-model="calculationInterParams.mileage"></div></div></div><div class="column"><div class="field"><label for="id_engine_power">Выберите мощность двигателя, л.с.:</label> <input type="text" ng-class="{\'is-invalid-calc\': calculationInterParams.engine_power < 10 || calculationInterParams.engine_power > 999}" ng-model="calculationInterParams.engine_power" input-only="[0-9]{1,3}" placeholder="0" class="input-has-slider" required="" id="id_engine_power"><div input-slider="" default-min="70" slider-step="1" default-max="500" ng-model="calculationInterParams.engine_power"></div></div></div></div><div class="row three column"><div class="column nowrap"><div class="field"><label for="id_car_displacement">Укажите объем двигателя:</label> <input type="text" ng-model="calculationInterParams.engine_displacement" price-formatter="2" ng-min="0.1" ng-max="10" required="" id="id_car_displacement"></div></div></div><div class="row two column"><div class="column"><div class="field"><label>Укажите коробку передач:</label><div class="ui two basic buttons"><button class="ui button" ng-repeat="item in carFilterParams.transmission" ng-click="calculationInterParams.params.transmission = item.id;" ng-class="[getActiveButtonClass(item.id === calculationInterParams.params.transmission), $root.currentBrand.united_buttons_color]" type="button"><span ng-bind="item.title"></span></button></div></div></div><div class="column"><div class="field"><label>Укажите привод:</label><div class="ui basic buttons three"><button class="ui button" ng-repeat="item in carFilterParams.driveOfCar" ng-click="calculationInterParams.params.drive_of_car = item.id;" ng-class="[getActiveButtonClass(item.id === calculationInterParams.params.drive_of_car), $root.currentBrand.united_buttons_color]" type="button"><span ng-bind="item.title"></span></button></div></div></div></div><div class="row one column"><div class="column" align="right"><button type="button" ng-click="toNextStep(\'car_settings.tumen\')" ng-disabled="!calculationInterParams.engine_power || car_settings_tumen_form.$invalid" ng-class="$root.currentBrand.main_buttons_color" class="ui button">Далее</button></div></div></div></div>');
}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.drivers.html",'<div ng-form="all_drivers_form" class="css-bigger-labels css-bigger-slider is-form"><div ng-repeat="item in calculationInterParams.drivers track by $index" ng-form="driver_kasko_form"><h2 class="b-content_title mb20 mt30" ng-if="calculationInterParams.currentDriverIndex === $index"><span ng-bind="$index + 1"></span>-й водитель:</h2><h3 class="b-content_title mb20 mt30" ng-if="calculationInterParams.lastDriverIndex > $index && calculationInterParams.currentDriverIndex !== $index"><span><span ng-bind="$index + 1"></span>-й водитель: <span ng-bind="item.gender === \'M\' ? \'Муж.\' : \'Жен.\'"></span> <span ng-bind="item.age + \'/\' + item.expirience"></span> <i class="icon write ml10" ng-if="all_drivers_form.$valid && !calculationInterParams.driverIsEditing" ng-click="toEditDriver($index)"></i></span></h3><div class="ui grid three column mt20 doubling stackable" ng-if="calculationInterParams.currentDriverIndex === $index"><div class="row"><div class="column"><div class="field" ng-class="{\'error\': item.age < 18 || item.age > 90}"><label for="id_driver_age_{{$index}}">Возраст:</label> <input type="text" id="id_driver_age_{{$index}}" class="input-has-slider" price-formatter="" name="age" required="" ng-model="item.age"><div input-slider="" default-min="18" slider-step="1" default-max="90" ng-model="item.age"></div></div></div><div class="column"><div class="field" ng-class="{\'error\': item.age - item.expirience < 18}"><label for="id_driver_expirience_{{$index}}">Стаж:</label> <input type="text" id="id_driver_expirience_{{$index}}" required="" class="input-has-slider" name="expirience" price-formatter="" ng-model="item.expirience"><div input-slider="" default-min="0" slider-step="1" default-max="72" ng-model="item.expirience"></div></div></div><div class="column"><div class="field"><label>Пол:</label><div class="ui basic two buttons"><button class="ui button" ng-click="item.gender = \'M\'" ng-class="getActiveButtonClass(item.gender === \'M\')" type="button">Мужской</button> <button class="ui button" ng-click="item.gender = \'F\'" ng-class="getActiveButtonClass(item.gender === \'F\')" type="button"><span class="h-button-expander"></span> Женский</button></div></div></div></div><div class="row mt10"><div class="column"><div class="field"><label>В браке:</label><div class="ui basic two buttons"><button class="ui button" ng-click="item.is_married = true" ng-class="getActiveButtonClass(item.is_married)" type="button">Да</button> <button class="ui button" ng-click="item.is_married = false" ng-class="getActiveButtonClass(!item.is_married)" type="button">Нет</button></div></div></div><div class="column"><div class="field"><label>Дети:</label><div class="ui basic two buttons"><button class="ui button" ng-click="item.has_children = true" ng-class="getActiveButtonClass(item.has_children)" type="button">Да</button> <button class="ui button" ng-click="item.has_children = false" ng-class="getActiveButtonClass(!item.has_children)" type="button">Нет</button></div></div></div></div><div class="row"><div class="column"></div><div class="column"></div><div class="column"><div class="field" align="right"><label>&nbsp;</label> <button class="fluid ui button" ng-class="$root.currentBrand.main_buttons_color" ng-disabled="driver_kasko_form.$invalid || item.age > 90 || item.age < 18 || item.age - item.expirience < 18" ng-click="goNextDriver($index)" type="button">Далее</button></div></div></div></div></div><div align="right" ng-class="$root.currentBrand.main_buttons_color" ng-if="calculationInterParams.currentDriverIndex === calculationInterParams.drivers.length"><button class="ui button green" type="button">Далее</button></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.drivers_count.html",'<div><h2 class="b-content_title mb20">Выберите количество водителей:</h2><div class="five ui basic buttons"><button class="ui button" ng-repeat="item in driversChanging" ng-click="changeDriversCount(item)" ng-class="$root.currentBrand.united_buttons_color" type="button"><span ng-bind="item.title"></span></button></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.engine_power.html",'<div class="fields"><div class="five wide field nowrap"><label for="id_engine_power">Выберите мощность двигателя, л.с.:</label> <input type="text" ng-class="{\'is-invalid-calc\': calculationInterParams.engine_power < 10 || calculationInterParams.engine_power > 999}" ng-model="calculationInterParams.engine_power" input-only="[0-9]{1,3}" placeholder="0" class="input-has-slider" required="" id="id_engine_power"><div input-slider="" default-min="70" slider-step="1" default-max="500" ng-model="calculationInterParams.engine_power"></div></div><div class="eleven wide field c-tar"><label>&nbsp;</label> <button type="button" ng-click="toNextStep(\'engine_power\')" ng-disabled="!calculationInterParams.engine_power" ng-class="$root.currentBrand.main_buttons_color" class="ui button">Далее</button></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.exploitation_area.html",'<div><h3 class="b-content_title mb20 mt30">Выберите регион эксплуатации автомобиля:</h3><div class="ui grid stackable"><div class="twelve wide column" ng-show="!carFilterParams.ownerRegistrationViewIsFull"><h3 class="b-content_title p20 m0"><a href="" ng-repeat="item in mainRegions" ng-click="selectExploitationArea(item.id)" ng-bind="item.title" ng-class="{\'css-bottom-dashed--active\': item.id == calculationInterParams.exploitation_area}" class="mr25 css-bottom-dashed mb10"></a> <a href="" ng-click="toggleOwnerRegistrationView()" ng-if="!$root.currentBrand.exploitation_area_all_are_hidden">другой</a></h3></div><div class="five wide column" ng-show="carFilterParams.ownerRegistrationViewIsFull"><div class="p20 field"><div class="ui search selection dropdown" id="id_exploitation_area" ng-focus="carFilterParams.was_clicked = true;" ng-click="carFilterParams.was_clicked = true;" sem-dropdown="" sem-dropdown-placeholder="Не выбран" ng-model="calculationInterParams.exploitation_area" ng-change="carFilterParams.was_clicked && selectExploitationArea()" sem-dropdown-items="ownerRegistration"></div></div></div><div class="seven wide column" ng-show="carFilterParams.ownerRegistrationViewIsFull">&nbsp;</div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.is_credit.html",'<div><h3 class="b-content_title mb20 mt30">Куплен в кредит?</h3><div class="ui grid three column doubling stackable"><div class="row"><div class="column"><div class="ui basic buttons" ng-class="$root.currentBrand.united_buttons_color" style="width: 100%"><button class="ui button" ng-click="carFilterParams.setIsCredit(false)" type="button">Нет</button> <button class="ui button" ng-click="carFilterParams.setIsCredit(true)" type="button">Да</button></div></div><div class="column"></div><div class="column"></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.is_earlier_insurance.html",'<div><h3 class="b-content_title mb20 mt30">Страхование в прошлом году</h3><div class="ui grid"><div class="row"><div class="eight wide column"><div class="field" align="left"><button class="ui button" style="min-width: 100px;" ng-click="carFilterParams.setIsEarlierInsurance(false)" type="button">Нет</button></div></div><div class="eight wide column"><div class="field" align="right"><button class="ui button" ng-click="carFilterParams.setIsEarlierInsurance(true)" style="min-width: 100px;" type="button">Да</button></div></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.is_multidrive.html",'<div class="ui grid three column mt20 doubling stackable" ng-form="multidrive_form"><div class="row"><div class="column"><div class="field" ng-class="{\'error\': item.age < 18 || item.age > 90}"><label for="id_drivers_minimal_age">Минимальный возраст:</label> <input type="text" id="id_drivers_minimal_age" class="input-has-slider" price-formatter="" name="drivers_minimal_age" required="" ng-model="calculationInterParams.drivers_minimal_age"><div input-slider="" default-min="18" slider-step="1" default-max="90" ng-model="calculationInterParams.drivers_minimal_age"></div></div></div><div class="column"><div class="field" ng-class="{\'error\': calculationInterParams.drivers_minimal_age - calculationInterParams.drivers_minimal_experience < 18}"><label for="id_drivers_minimal_experience">Минимальный стаж:</label> <input type="text" id="id_drivers_minimal_experience" required="" class="input-has-slider" name="drivers_minimal_experience" price-formatter="" ng-model="calculationInterParams.drivers_minimal_experience"><div input-slider="" default-min="0" slider-step="1" default-max="72" ng-model="calculationInterParams.drivers_minimal_experience"></div></div></div></div><div class="row"><div class="column"></div><div class="column"></div><div class="column"><div class="field" align="right"><label>&nbsp;</label> <button class="fluid ui button" ng-disabled="multidrive_form.$invalid || calculationInterParams.drivers_minimal_age > 90 || calculationInterParams.drivers_minimal_age < 18 || calculationInterParams.drivers_minimal_age - calculationInterParams.drivers_minimal_experience < 18" ng-click="toNextStep(\'is_multidrive\')" ng-class="$root.currentBrand.main_buttons_color" type="button">Далее</button></div></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.mileage.html",'<div class="fields"><div class="five wide field nowrap"><label for="id_mileage">Укажите пробег автомобиля в км:</label> <input type="text" ng-model="calculationInterParams.mileage" price-formatter="2" class="input-has-slider" id="id_mileage"><div input-slider="" is-sum="true" default-min="0" slider-step="500" default-max="200000" ng-model="calculationInterParams.mileage"></div></div><div class="eleven wide field c-tar"><label>&nbsp;</label> <button type="button" ng-click="toNextStep(\'mileage\')" ng-class="$root.currentBrand.main_buttons_color" class="ui button">Далее</button></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.owner_registration.html",'<div><h3 class="b-content_title mb20 mt30">Выберите регион регистрации собственника:</h3><div class="ui grid stackable"><div class="twelve wide column" ng-show="!carFilterParams.ownerRegistrationViewIsFull"><h3 class="b-content_title p20 m0"><a href="" ng-repeat="item in mainOwnerRegistrations" ng-click="selectOwnerRegistration(item.id)" ng-bind="item.title" ng-class="{\'css-bottom-dashed--active\': item.id == carFilterParams.owner_registration}" class="mr25 css-bottom-dashed mb10"></a> <a href="" ng-click="toggleOwnerRegistrationView()" ng-if="!$root.currentBrand.owner_registration_all_are_hidden">другой</a></h3></div><div class="five wide column" ng-show="carFilterParams.ownerRegistrationViewIsFull"><div class="p20 field"><div class="ui search selection dropdown" id="id_owner_registration" ng-focus="carFilterParams.was_clicked = true;" ng-click="carFilterParams.was_clicked = true;" sem-dropdown="" sem-dropdown-placeholder="Не выбран" ng-model="carFilterParams.owner_registration" ng-change="carFilterParams.was_clicked && selectOwnerRegistration()" sem-dropdown-items="ownerRegistration"></div></div></div><div class="seven wide column" ng-show="carFilterParams.ownerRegistrationViewIsFull">&nbsp;</div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.policy_settings.tumen.html",'<div class="ui form is-form" ng-form="policy_settings_tumen_form"><div class="ui grid"><div class="row two column bottom aligned"><div class="column"><div class="field"><label>Оплата:</label><div class="ui basic two buttons"><button class="ui button" type="button" ng-repeat="item in calculatorParams.contributoryScheme" ng-click="calculationInterParams.contributory_scheme = item.id" ng-class="[getActiveButtonClass(item.id === calculationInterParams.contributory_scheme), $root.currentBrand.united_buttons_color]"><span ng-bind="item.title"></span></button></div></div></div><div class="column"><div class="field"><label>Автомобиль на гарантии:</label><div class="ui basic two buttons"><button class="ui button" type="button" ng-repeat="item in carFilterParams.yesNo" ng-click="calculationInterParams.is_under_warranty = item.id" ng-class="[getActiveButtonClass(item.id === calculationInterParams.is_under_warranty), $root.currentBrand.united_buttons_color]"><span ng-bind="item.title"></span></button></div></div></div></div><div class="row two column bottom aligned"><div class="column"><div class="field"><label>Новое ТС:</label><div class="ui basic two buttons"><button class="ui button" type="button" ng-repeat="item in carFilterParams.yesNo" ng-click="calculationInterParams.is_new_car = item.id" ng-class="[getActiveButtonClass(item.id === calculationInterParams.is_new_car), $root.currentBrand.united_buttons_color]"><span ng-bind="item.title"></span></button></div></div></div><div class="column"><div class="field"><label>Выбор СТОА:</label><div class="ui basic two buttons"><button class="ui button" type="button" ng-repeat="item in $root.currentBrand.payment_forms" ng-click="calculationInterParams.payment_form = item.id" ng-class="[getActiveButtonClass(item.id === calculationInterParams.payment_form), $root.currentBrand.united_buttons_color]"><span ng-bind="item.title"></span></button></div></div></div></div></div><div class="row one column"><div class="column" align="right"><button type="button" ng-click="toNextStep(\'policy_settings.tumen\')" ng-disabled="policy_settings_tumen_form.$invalid" ng-class="$root.currentBrand.main_buttons_color" class="ui button mt20">Далее</button></div></div></div>')}]),angular.module("kaskoTemplates").run(["$templateCache",function(e){e.put("/js/modules.shared/calculatorSteps/views/step.year.html",'<div><div class="mb10"><strong>Год выпуска автомобиля:</strong></div><car-manufacturing-years></car-manufacturing-years></div>')}]),function(e){e.module("brandingConfigs",[]).service("brandingConfigs",["$stateParams","moduleType",function(e,t){var i={kasko:{exploitation_area_all_are_hidden:!0,watermark_is_hidden:!0,with_sms:!1,payment_form_is_hidden:!0,arrival_time_is_hidden:!0,steps_buttons_color:"red",link_to_registration_in_email:!0,main_buttons_color:"blue",united_buttons_color:"",exploitation_areas:[30261],payment_forms:[{id:107,title:"У официального дилера"},{id:105,title:"Не официальные СТОА"}],templates:{}},osago:{owner_registration_all_are_hidden:!0,owner_registrations:[104,29871],watermark_is_hidden:!0,show_personal_data:!0,show_user_agreement:!0,link_to_registration_in_email:!0,steps_buttons_color:"red",main_buttons_color:"blue",templates:{}}};return i[t]}]).service("stepsService",["moduleType",function(e){var t={kasko:{stepsHacks:{},steps:{first:["year","car_mark","car_model_group","car_model","engine_power","exploitation_area","car_cost","mileage"],second:["drivers_count",function(e){return e.is_multidrive?"is_multidrive":"drivers"},"is_credit","calc"]}},osago:{stepsHacks:{},steps:{first:["year","car_mark","car_model_group","car_model","is_credit","engine_power","owner_registration","calculation_type"],second:["drivers_count"]}}};return t[e]}])}(angular),function(e){!function(){var t={kasko:!1,osago:!1},i=e(".js-choose--post"),a=e(".js-choose--pre");i.hide();var r={Kasko:e("#KaskoApp"),Osago:e("#OsagoApp")},n=e(".js-calc-type");e(".js-show-choosing-calc").click(function(t){return e(".b-app-modal").removeClass("b-app-modal--is-hidden"),a.show(),i.hide(),!1}),e(".js-calc-panel-item").click(function(){return e(this).hasClass("js-calc-panel-item--kasko")?(t.kasko||(window.location.hash="#!/pre",angular.bootstrap(r.Kasko,["KaskoApp"]),t.kasko=!0),n.text("КАСКО"),r.Osago.hide(),r.Kasko.show()):(t.osago||(window.location.hash="#!/osago/",angular.bootstrap(r.Osago,["OsagoApp"]),t.osago=!0),n.text("ОСАГО"),r.Osago.show(),r.Kasko.hide()),i.show(),a.hide(),!1}),e(".js-app-modal-close").click(function(){e(".b-app-modal").addClass("b-app-modal--is-hidden")})}()}(jQueryApp);